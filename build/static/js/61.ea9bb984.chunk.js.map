{"version":3,"file":"static/js/61.ea9bb984.chunk.js","mappings":"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","sources":["../../node_modules/jsonform/lib/jsonform.js","../../node_modules/underscore/modules/_setup.js","../../node_modules/underscore/modules/restArguments.js","../../node_modules/underscore/modules/isObject.js","../../node_modules/underscore/modules/isNull.js","../../node_modules/underscore/modules/isUndefined.js","../../node_modules/underscore/modules/isBoolean.js","../../node_modules/underscore/modules/isElement.js","../../node_modules/underscore/modules/_tagTester.js","../../node_modules/underscore/modules/isString.js","../../node_modules/underscore/modules/isNumber.js","../../node_modules/underscore/modules/isDate.js","../../node_modules/underscore/modules/isRegExp.js","../../node_modules/underscore/modules/isError.js","../../node_modules/underscore/modules/isSymbol.js","../../node_modules/underscore/modules/isArrayBuffer.js","../../node_modules/underscore/modules/isFunction.js","../../node_modules/underscore/modules/_hasObjectTag.js","../../node_modules/underscore/modules/_stringTagBug.js","../../node_modules/underscore/modules/isDataView.js","../../node_modules/underscore/modules/isArray.js","../../node_modules/underscore/modules/_has.js","../../node_modules/underscore/modules/isArguments.js","../../node_modules/underscore/modules/isFinite.js","../../node_modules/underscore/modules/isNaN.js","../../node_modules/underscore/modules/constant.js","../../node_modules/underscore/modules/_createSizePropertyCheck.js","../../node_modules/underscore/modules/_shallowProperty.js","../../node_modules/underscore/modules/_getByteLength.js","../../node_modules/underscore/modules/_isBufferLike.js","../../node_modules/underscore/modules/isTypedArray.js","../../node_modules/underscore/modules/_getLength.js","../../node_modules/underscore/modules/_collectNonEnumProps.js","../../node_modules/underscore/modules/keys.js","../../node_modules/underscore/modules/isEmpty.js","../../node_modules/underscore/modules/isMatch.js","../../node_modules/underscore/modules/underscore.js","../../node_modules/underscore/modules/_toBufferView.js","../../node_modules/underscore/modules/isEqual.js","../../node_modules/underscore/modules/allKeys.js","../../node_modules/underscore/modules/_methodFingerprint.js","../../node_modules/underscore/modules/isMap.js","../../node_modules/underscore/modules/isWeakMap.js","../../node_modules/underscore/modules/isSet.js","../../node_modules/underscore/modules/isWeakSet.js","../../node_modules/underscore/modules/values.js","../../node_modules/underscore/modules/pairs.js","../../node_modules/underscore/modules/invert.js","../../node_modules/underscore/modules/functions.js","../../node_modules/underscore/modules/_createAssigner.js","../../node_modules/underscore/modules/extend.js","../../node_modules/underscore/modules/extendOwn.js","../../node_modules/underscore/modules/defaults.js","../../node_modules/underscore/modules/_baseCreate.js","../../node_modules/underscore/modules/create.js","../../node_modules/underscore/modules/clone.js","../../node_modules/underscore/modules/tap.js","../../node_modules/underscore/modules/toPath.js","../../node_modules/underscore/modules/_toPath.js","../../node_modules/underscore/modules/_deepGet.js","../../node_modules/underscore/modules/get.js","../../node_modules/underscore/modules/has.js","../../node_modules/underscore/modules/identity.js","../../node_modules/underscore/modules/matcher.js","../../node_modules/underscore/modules/property.js","../../node_modules/underscore/modules/_optimizeCb.js","../../node_modules/underscore/modules/_baseIteratee.js","../../node_modules/underscore/modules/iteratee.js","../../node_modules/underscore/modules/_cb.js","../../node_modules/underscore/modules/mapObject.js","../../node_modules/underscore/modules/noop.js","../../node_modules/underscore/modules/propertyOf.js","../../node_modules/underscore/modules/times.js","../../node_modules/underscore/modules/random.js","../../node_modules/underscore/modules/now.js","../../node_modules/underscore/modules/_createEscaper.js","../../node_modules/underscore/modules/_escapeMap.js","../../node_modules/underscore/modules/escape.js","../../node_modules/underscore/modules/unescape.js","../../node_modules/underscore/modules/_unescapeMap.js","../../node_modules/underscore/modules/templateSettings.js","../../node_modules/underscore/modules/template.js","../../node_modules/underscore/modules/result.js","../../node_modules/underscore/modules/uniqueId.js","../../node_modules/underscore/modules/chain.js","../../node_modules/underscore/modules/_executeBound.js","../../node_modules/underscore/modules/partial.js","../../node_modules/underscore/modules/bind.js","../../node_modules/underscore/modules/_isArrayLike.js","../../node_modules/underscore/modules/_flatten.js","../../node_modules/underscore/modules/bindAll.js","../../node_modules/underscore/modules/memoize.js","../../node_modules/underscore/modules/delay.js","../../node_modules/underscore/modules/defer.js","../../node_modules/underscore/modules/throttle.js","../../node_modules/underscore/modules/debounce.js","../../node_modules/underscore/modules/wrap.js","../../node_modules/underscore/modules/negate.js","../../node_modules/underscore/modules/compose.js","../../node_modules/underscore/modules/after.js","../../node_modules/underscore/modules/before.js","../../node_modules/underscore/modules/once.js","../../node_modules/underscore/modules/findKey.js","../../node_modules/underscore/modules/_createPredicateIndexFinder.js","../../node_modules/underscore/modules/findIndex.js","../../node_modules/underscore/modules/findLastIndex.js","../../node_modules/underscore/modules/sortedIndex.js","../../node_modules/underscore/modules/_createIndexFinder.js","../../node_modules/underscore/modules/indexOf.js","../../node_modules/underscore/modules/lastIndexOf.js","../../node_modules/underscore/modules/find.js","../../node_modules/underscore/modules/findWhere.js","../../node_modules/underscore/modules/each.js","../../node_modules/underscore/modules/map.js","../../node_modules/underscore/modules/_createReduce.js","../../node_modules/underscore/modules/reduce.js","../../node_modules/underscore/modules/reduceRight.js","../../node_modules/underscore/modules/filter.js","../../node_modules/underscore/modules/reject.js","../../node_modules/underscore/modules/every.js","../../node_modules/underscore/modules/some.js","../../node_modules/underscore/modules/contains.js","../../node_modules/underscore/modules/invoke.js","../../node_modules/underscore/modules/pluck.js","../../node_modules/underscore/modules/where.js","../../node_modules/underscore/modules/max.js","../../node_modules/underscore/modules/min.js","../../node_modules/underscore/modules/sample.js","../../node_modules/underscore/modules/shuffle.js","../../node_modules/underscore/modules/sortBy.js","../../node_modules/underscore/modules/_group.js","../../node_modules/underscore/modules/groupBy.js","../../node_modules/underscore/modules/indexBy.js","../../node_modules/underscore/modules/countBy.js","../../node_modules/underscore/modules/partition.js","../../node_modules/underscore/modules/toArray.js","../../node_modules/underscore/modules/size.js","../../node_modules/underscore/modules/_keyInObj.js","../../node_modules/underscore/modules/pick.js","../../node_modules/underscore/modules/omit.js","../../node_modules/underscore/modules/initial.js","../../node_modules/underscore/modules/first.js","../../node_modules/underscore/modules/rest.js","../../node_modules/underscore/modules/last.js","../../node_modules/underscore/modules/compact.js","../../node_modules/underscore/modules/flatten.js","../../node_modules/underscore/modules/difference.js","../../node_modules/underscore/modules/without.js","../../node_modules/underscore/modules/uniq.js","../../node_modules/underscore/modules/union.js","../../node_modules/underscore/modules/intersection.js","../../node_modules/underscore/modules/unzip.js","../../node_modules/underscore/modules/zip.js","../../node_modules/underscore/modules/object.js","../../node_modules/underscore/modules/range.js","../../node_modules/underscore/modules/chunk.js","../../node_modules/underscore/modules/_chainResult.js","../../node_modules/underscore/modules/mixin.js","../../node_modules/underscore/modules/underscore-array-methods.js","../../node_modules/underscore/modules/index-default.js"],"sourcesContent":["/* Copyright (c) 2012 Joshfire - MIT license */\n/**\n * @fileoverview Core of the JSON Form client-side library.\n *\n * Generates an HTML form from a structured data model and a layout description.\n *\n * The library may also validate inputs entered by the user against the data model\n * upon form submission and create the structured data object initialized with the\n * values that were submitted.\n *\n * The library depends on:\n *  - jQuery\n *  - the underscore library\n *  - a JSON parser/serializer. Nothing to worry about in modern browsers.\n *  - the JSONFormValidation library (in jsv.js) for validation purpose\n *\n * See documentation at:\n * http://developer.joshfire.com/doc/dev/ref/jsonform\n *\n * The library creates and maintains an internal data tree along with the DOM.\n * That structure is necessary to handle arrays (and nested arrays!) that are\n * dynamic by essence.\n */\n\n /*global window*/\n \n(function(serverside, global, $, _, JSON) {\n  console.log($);\n  console.log(serverside);\n  console.log(global);\n  \n  if (serverside && !_) {\n    _ = require('underscore');\n  }\n\n  /**\n   * Regular expressions used to extract array indexes in input field names\n   */\n  var reArray = /\\[([0-9]*)\\](?=\\[|\\.|$)/g;\n\n  /**\n   * Template settings for form views\n   */\n  var fieldTemplateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g\n  };\n\n  /**\n   * Template settings for value replacement\n   */\n  var valueTemplateSettings = {\n    evaluate    : /\\{\\[([\\s\\S]+?)\\]\\}/g,\n    interpolate : /\\{\\{([\\s\\S]+?)\\}\\}/g\n  };\n\n  /**\n   * Returns true if given value is neither \"undefined\" nor null\n   */\n  var isSet = function (value) {\n    return !(_.isUndefined(value) || _.isNull(value));\n  };\n\n  /**\n   * Returns true if given property is directly property of an object\n   */\n  var hasOwnProperty = function (obj, prop) {\n    return typeof obj === 'object' && obj.hasOwnProperty(prop);\n  }\n\n  /**\n   * The jsonform object whose methods will be exposed to the window object\n   */\n  var jsonform = {util:{}};\n\n\n  // From backbonejs\n  var escapeHTML = function (string) {\n    if (!isSet(string)) {\n      return '';\n    }\n    string = '' + string;\n    if (!string) {\n      return '';\n    }\n    return string\n      .replace(/&(?!\\w+;|#\\d+;|#x[\\da-f]+;)/gi, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#x27;')\n      .replace(/\\//g, '&#x2F;');\n  };\n\n/**\n * Escapes selector name for use with jQuery\n *\n * All meta-characters listed in jQuery doc are escaped:\n * http://api.jquery.com/category/selectors/\n *\n * @function\n * @param {String} selector The jQuery selector to escape\n * @return {String} The escaped selector.\n */\nvar escapeSelector = function (selector) {\n  return selector.replace(/([ \\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;<\\=\\>\\?\\@\\[\\\\\\]\\^\\`\\{\\|\\}\\~])/g, '\\\\$1');\n};\n\n/**\n *\n * Slugifies a string by replacing spaces with _. Used to create\n * valid classnames and ids for the form.\n *\n * @function\n * @param {String} str The string to slugify\n * @return {String} The slugified string.\n */\nvar slugify = function(str) {\n  return str.replace(/\\ /g, '_');\n}\n\n/**\n * Initializes tabular sections in forms. Such sections are generated by the\n * 'selectfieldset' type of elements in JSON Form.\n *\n * Input fields that are not visible are automatically disabled\n * not to appear in the submitted form. That's on purpose, as tabs\n * are meant to convey an alternative (and not a sequence of steps).\n *\n * The tabs menu is not rendered as tabs but rather as a select field because\n * it's easier to grasp that it's an alternative.\n *\n * Code based on bootstrap-tabs.js, updated to:\n * - react to option selection instead of tab click\n * - disable input fields in non visible tabs\n * - disable the possibility to have dropdown menus (no meaning here)\n * - act as a regular function instead of as a jQuery plug-in.\n *\n * @function\n * @param {Object} tabs jQuery object that contains the tabular sections\n *  to initialize. The object may reference more than one element.\n */\nvar initializeTabs = function (tabs) {\n  var activate = function (element, container) {\n    container\n      .find('> .active')\n      .removeClass('active');\n    element.addClass('active');\n  };\n\n  var enableFields = function ($target, targetIndex) {\n    // Enable all fields in the targeted tab\n    $target.find('input, textarea, select').removeAttr('disabled');\n\n    // Disable all fields in other tabs\n    $target.parent()\n      .children(':not([data-idx=' + targetIndex + '])')\n      .find('input, textarea, select')\n      .attr('disabled', 'disabled');\n  };\n\n  var optionSelected = function (e) {\n    var $option = $(\"option:selected\", $(this)),\n      $select = $(this),\n      // do not use .attr() as it sometimes unexplicably fails\n      targetIdx = $option.get(0).getAttribute('data-idx') || $option.attr('value'),\n      $target;\n\n    e.preventDefault();\n    if ($option.hasClass('active')) {\n      return;\n    }\n\n    $target = $(this).parents('.tabbable').eq(0).find('> .tab-content > [data-idx=' + targetIdx + ']');\n\n    activate($option, $select);\n    activate($target, $target.parent());\n    enableFields($target, targetIdx);\n  };\n\n  var tabClicked = function (e) {\n    var $a = $('a', $(this));\n    var $content = $(this).parents('.tabbable').first()\n      .find('.tab-content').first();\n    var targetIdx = $(this).index();\n    // The `>` here is to prevent activating selectfieldsets inside a tabarray\n    var $target = $content.find('> [data-idx=' + targetIdx + ']');\n\n    e.preventDefault();\n    activate($(this), $(this).parent());\n    activate($target, $target.parent());\n    if ($(this).parent().hasClass('jsonform-alternative')) {\n      enableFields($target, targetIdx);\n    }\n  };\n\n  tabs.each(function () {\n    $(this).delegate('select.nav', 'change', optionSelected);\n    $(this).find('select.nav').each(function () {\n      $(this).val($(this).find('.active').attr('value'));\n      // do not use .attr() as it sometimes unexplicably fails\n      var targetIdx = $(this).find('option:selected').get(0).getAttribute('data-idx') ||\n        $(this).find('option:selected').attr('value');\n      var $target = $(this).parents('.tabbable').eq(0).find('> .tab-content > [data-idx=' + targetIdx + ']');\n      enableFields($target, targetIdx);\n    });\n\n    $(this).delegate('ul.nav li', 'click', tabClicked);\n    $(this).find('ul.nav li.active').click();\n  });\n};\n\n\n// Twitter bootstrap-friendly HTML boilerplate for standard inputs\njsonform.fieldTemplate = function(inner) {\n  return '<div ' +\n    '<% for(var key in elt.htmlMetaData) {%>' +\n      '<%= key %>=\"<%= elt.htmlMetaData[key] %>\" ' +\n    '<% }%>' +\n    'class=\"form-group jsonform-error-<%= keydash %>' +\n    '<%= elt.htmlClass ? \" \" + elt.htmlClass : \"\" %>' +\n    '<%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== \"boolean\") ? \" jsonform-required\" : \"\") %>' +\n    '<%= (node.readOnly ? \" jsonform-readonly\" : \"\") %>' +\n    '<%= (node.disabled ? \" jsonform-disabled\" : \"\") %>' +\n    '\">' +\n    '<% if (!elt.notitle) { %>' +\n      '<label for=\"<%= node.id %>\"><%= node.title ? node.title : node.name %></label>' +\n    '<% } %>' +\n    '<div class=\"controls\">' +\n      '<% if (node.prepend || node.append) { %>' +\n      '<div class=\"<% if (node.prepend) { %>input-group<% } %>' +\n        '<% if (node.append) { %> input-group<% } %>\">' +\n        '<% if (node.prepend) { %>' +\n          '<span class=\"input-group-addon\"><%= node.prepend %></span>' +\n        '<% } %>' +\n      '<% } %>' +\n      inner +\n      '<% if (node.append) { %>' +\n        '<span class=\"input-group-addon\"><%= node.append %></span>' +\n      '<% } %>' +\n      '<% if (node.prepend || node.append) { %>' +\n        '</div>' +\n      '<% } %>' +\n      '<% if (node.description) { %>' +\n        '<span class=\"help-block\"><%= node.description %></span>' +\n      '<% } %>' +\n      '<span class=\"help-block jsonform-errortext\" style=\"display:none;\"></span>' +\n    '</div></div>';\n};\n\nvar fileDisplayTemplate = '<div class=\"_jsonform-preview\">' +\n  '<% if (value.type==\"image\") { %>' +\n  '<img class=\"jsonform-preview\" id=\"jsonformpreview-<%= id %>\" src=\"<%= value.url %>\" />' +\n  '<% } else { %>' +\n  '<a href=\"<%= value.url %>\"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)' +\n  '<% } %>' +\n  '</div>' +\n  '<a href=\"#\" class=\"btn btn-default _jsonform-delete\"><i class=\"glyphicon glyphicon-remove\" title=\"Remove\"></i></a> ';\n\nvar inputFieldTemplate = function (type) {\n  return {\n    'template': '<input type=\"' + type + '\" ' +\n      'class=\\'form-control<%= (fieldHtmlClass ? \" \" + fieldHtmlClass : \"\") %>\\'' +\n      'name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" id=\"<%= id %>\"' +\n      ' aria-label=\"<%= node.title ? escape(node.title) : node.name %>\"' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.readOnly ? \" readonly=\\'readonly\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && (node.schemaElement.step > 0 || node.schemaElement.step == \"any\") ? \" step=\\'\" + node.schemaElement.step + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.minLength ? \" minlength=\\'\" + node.schemaElement.minLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.maxLength ? \" maxlength=\\'\" + node.schemaElement.maxLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== \"boolean\") ? \" required=\\'required\\'\" : \"\") %>' +\n      '<%= (node.placeholder? \" placeholder=\" + \\'\"\\' + escape(node.placeholder) + \\'\"\\' : \"\")%>' +\n      ' />',\n    'fieldtemplate': true,\n    'inputfield': true\n  }\n};\n\njsonform.elementTypes = {\n  'none': {\n    'template': ''\n  },\n  'root': {\n    'template': '<div><%= children %></div>'\n  },\n  'text': inputFieldTemplate('text'),\n  'password': inputFieldTemplate('password'),\n  'date': inputFieldTemplate('date'),\n  'datetime': inputFieldTemplate('datetime'),\n  'datetime-local': inputFieldTemplate('datetime-local'),\n  'email': inputFieldTemplate('email'),\n  'month': inputFieldTemplate('month'),\n  'number': inputFieldTemplate('number'),\n  'search': inputFieldTemplate('search'),\n  'tel': inputFieldTemplate('tel'),\n  'time': inputFieldTemplate('time'),\n  'url': inputFieldTemplate('url'),\n  'week': inputFieldTemplate('week'),\n  'range': {\n    'template': '<div class=\"range\"><input type=\"range\" ' +\n      '<%= (fieldHtmlClass ? \"class=\\'\" + fieldHtmlClass + \"\\' \" : \"\") %>' +\n      'name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" id=\"<%= id %>\"' +\n      ' aria-label=\"<%= node.title ? escape(node.title) : node.name %>\"' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      ' min=<%= range.min %>' +\n      ' max=<%= range.max %>' +\n      ' step=<%= range.step %>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      ' /><% if (range.indicator) { %><span class=\"range-value\" rel=\"<%= id %>\"><%= escape(value) %></span><% } %></div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onInput': function(evt, elt) {\n      const valueIndicator = document.querySelector('span.range-value[rel=\"' + elt.id + '\"]');\n      if (valueIndicator) {\n        valueIndicator.innerText = evt.target.value;\n      }\n    },\n    'onBeforeRender': function (data, node) {\n      data.range = {\n        min: 1,\n        max: 100,\n        step: 1,\n        indicator: false\n      };\n      if (!node || !node.schemaElement) return;\n      if (node.formElement && node.formElement.step) {\n        data.range.step = node.formElement.step;\n      }\n      if (node.formElement && node.formElement.indicator) {\n        data.range.indicator = node.formElement.indicator;\n      }\n      if (typeof node.schemaElement.minimum !== 'undefined') {\n        if (node.schemaElement.exclusiveMinimum) {\n          data.range.min = node.schemaElement.minimum + data.range.step;\n        }\n        else {\n          data.range.min = node.schemaElement.minimum;\n        }\n      }\n      if (typeof node.schemaElement.maximum !== 'undefined') {\n        if (node.schemaElement.exclusiveMaximum) {\n          data.range.max = node.schemaElement.maximum - data.range.step;\n        }\n        else {\n          data.range.max = node.schemaElement.maximum;\n        }\n      }\n    }\n  },\n  'color':{\n    'template':'<input type=\"text\" ' +\n      '<%= (fieldHtmlClass ? \"class=\\'\" + fieldHtmlClass + \"\\' \" : \"\") %>' +\n      'name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" id=\"<%= id %>\"' +\n      ' aria-label=\"<%= node.title ? escape(node.title) : node.name %>\"' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      ' />',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onInsert': function(evt, node) {\n      $(node.el).find('#' + escapeSelector(node.id)).spectrum({\n        preferredFormat: \"hex\",\n        showInput: true\n      });\n    }\n  },\n  'textarea':{\n    'template':'<textarea id=\"<%= id %>\" name=\"<%= node.name %>\" ' +\n      '<%= (fieldHtmlClass ? \"class=\\'\" + fieldHtmlClass + \"\\' \" : \"\") %>' +\n      'style=\"height:<%= elt.height || \"150px\" %>;width:<%= elt.width || \"100%\" %>;\"' +\n      ' aria-label=\"<%= node.title ? escape(node.title) : node.name %>\"' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.readOnly ? \" readonly=\\'readonly\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.minLength ? \" minlength=\\'\" + node.schemaElement.minLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.maxLength ? \" maxlength=\\'\" + node.schemaElement.maxLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      '<%= (node.placeholder? \" placeholder=\" + \\'\"\\' + escape(node.placeholder) + \\'\"\\' : \"\")%>' +\n      '><%= value %></textarea>',\n    'fieldtemplate': true,\n    'inputfield': true\n  },\n  'wysihtml5':{\n    'template':'<textarea id=\"<%= id %>\" name=\"<%= node.name %>\" style=\"height:<%= elt.height || \"300px\" %>;width:<%= elt.width || \"100%\" %>;\"' +\n      ' aria-label=\"<%= node.title ? escape(node.title) : node.name %>\"' +\n      '<%= (fieldHtmlClass ? \"class=\\'\" + fieldHtmlClass + \"\\' \" : \"\") %>' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.readOnly ? \" readonly=\\'readonly\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.minLength ? \" minlength=\\'\" + node.schemaElement.minLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.maxLength ? \" maxlength=\\'\" + node.schemaElement.maxLength + \"\\'\" : \"\") %>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      '<%= (node.placeholder? \" placeholder=\" + \\'\"\\' + escape(node.placeholder) + \\'\"\\' : \"\")%>' +\n      '><%= value %></textarea>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onInsert': function (evt, node) {\n      var setup = function () {\n        //protect from double init\n        if ($(node.el).data(\"wysihtml5\")) return;\n        $(node.el).data(\"wysihtml5_loaded\",true);\n\n        $(node.el).find('#' + escapeSelector(node.id)).wysihtml5({\n          \"html\": true,\n          \"link\": true,\n          \"font-styles\":true,\n          \"image\": false,\n          \"events\": {\n            \"load\": function () {\n              // In chrome, if an element is required and hidden, it leads to\n              // the error 'An invalid form control with name='' is not focusable'\n              // See http://stackoverflow.com/questions/7168645/invalid-form-control-only-in-google-chrome\n              $(this.textareaElement).removeAttr('required');\n            }\n          }\n        });\n      };\n\n      // Is there a setup hook?\n      if (window.jsonform_wysihtml5_setup) {\n        window.jsonform_wysihtml5_setup(setup);\n        return;\n      }\n\n      // Wait until wysihtml5 is loaded\n      var itv = window.setInterval(function() {\n        if (window.wysihtml5) {\n          window.clearInterval(itv);\n          setup();\n        }\n      },1000);\n    }\n  },\n  'ace':{\n    'template':'<div id=\"<%= id %>\" style=\"position:relative;height:<%= elt.height || \"300px\" %>;\"><div id=\"<%= id %>__ace\" style=\"width:<%= elt.width || \"100%\" %>;height:<%= elt.height || \"300px\" %>;\"></div><input type=\"hidden\" name=\"<%= node.name %>\" id=\"<%= id %>__hidden\" value=\"<%= escape(value) %>\"/></div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onInsert': function (evt, node) {\n      var setup = function () {\n        var formElement = node.formElement || {};\n        var ace = window.ace;\n        var editor = ace.edit($(node.el).find('#' + escapeSelector(node.id) + '__ace').get(0));\n        var idSelector = '#' + escapeSelector(node.id) + '__hidden';\n        // Force editor to use \"\\n\" for new lines, not to bump into ACE \"\\r\" conversion issue\n        // (ACE is ok with \"\\r\" on pasting but fails to return \"\\r\" when value is extracted)\n        editor.getSession().setNewLineMode('unix');\n        editor.renderer.setShowPrintMargin(false);\n        editor.setTheme(\"ace/theme/\"+(formElement.aceTheme||\"twilight\"));\n\n        if (formElement.aceMode) {\n          editor.getSession().setMode(\"ace/mode/\"+formElement.aceMode);\n        }\n        editor.getSession().setTabSize(2);\n\n        // Set the contents of the initial manifest file\n        editor.getSession().setValue(node.value||\"\");\n\n        //TODO: this is clearly sub-optimal\n        // 'Lazily' bind to the onchange 'ace' event to give\n        // priority to user edits\n        var lazyChanged = _.debounce(function () {\n          $(node.el).find(idSelector).val(editor.getSession().getValue());\n          $(node.el).find(idSelector).change();\n        }, 600);\n        editor.getSession().on('change', lazyChanged);\n\n        editor.on('blur', function() {\n          $(node.el).find(idSelector).change();\n          $(node.el).find(idSelector).trigger(\"blur\");\n        });\n        editor.on('focus', function() {\n          $(node.el).find(idSelector).trigger(\"focus\");\n        });\n      };\n\n      // Is there a setup hook?\n      if (window.jsonform_ace_setup) {\n        window.jsonform_ace_setup(setup);\n        return;\n      }\n\n      // Wait until ACE is loaded\n      var itv = window.setInterval(function() {\n        if (window.ace) {\n          window.clearInterval(itv);\n          setup();\n        }\n      },1000);\n    }\n  },\n  'checkbox':{\n    'template': '<div class=\"checkbox\"><label><input type=\"checkbox\" id=\"<%= id %>\" ' +\n      '<%= (fieldHtmlClass ? \" class=\\'\" + fieldHtmlClass + \"\\'\": \"\") %>' +\n      'name=\"<%= node.name %>\" value=\"1\" <% if (value) {%>checked<% } %>' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== \"boolean\") ? \" required=\\'required\\'\" : \"\") %>' +\n      ' /><%= node.inlinetitle || \"\" %>' +\n      '</label></div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    }\n  },\n  'file':{\n    'template':'<input class=\"input-file\" id=\"<%= id %>\" name=\"<%= node.name %>\" type=\"file\" ' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      '<%= (node.formElement && node.formElement.accept ? (\" accept=\\'\" + node.formElement.accept + \"\\'\") : \"\") %>' +\n      '/>',\n    'fieldtemplate': true,\n    'inputfield': true\n  },\n  'file-hosted-public':{\n    'template':'<span><% if (value && (value.type||value.url)) { %>'+fileDisplayTemplate+'<% } %><input class=\"input-file\" id=\"_transloadit_<%= id %>\" type=\"file\" name=\"<%= transloaditname %>\" /><input data-transloadit-name=\"_transloadit_<%= transloaditname %>\" type=\"hidden\" id=\"<%= id %>\" name=\"<%= node.name %>\" value=\\'<%= escape(JSON.stringify(node.value)) %>\\' /></span>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onBeforeRender': function (data, node) {\n\n      if (!node.ownerTree._transloadit_generic_public_index) {\n        node.ownerTree._transloadit_generic_public_index=1;\n      } else {\n        node.ownerTree._transloadit_generic_public_index++;\n      }\n\n      data.transloaditname = \"_transloadit_jsonform_genericupload_public_\"+node.ownerTree._transloadit_generic_public_index;\n\n      if (!node.ownerTree._transloadit_generic_elts) node.ownerTree._transloadit_generic_elts = {};\n      node.ownerTree._transloadit_generic_elts[data.transloaditname] = node;\n    },\n    'onChange': function(evt,elt) {\n      // The \"transloadit\" function should be called only once to enable\n      // the service when the form is submitted. Has it already been done?\n      if (elt.ownerTree._transloadit_bound) {\n        return false;\n      }\n      elt.ownerTree._transloadit_bound = true;\n\n      // Call the \"transloadit\" function on the form element\n      var formElt = $(elt.ownerTree.domRoot);\n      formElt.transloadit({\n        autoSubmit: false,\n        wait: true,\n        onSuccess: function (assembly) {\n          // Image has been uploaded. Check the \"results\" property that\n          // contains the list of files that Transloadit produced. There\n          // should be one image per file input in the form at most.\n          var results = _.values(assembly.results);\n          results = _.flatten(results);\n          _.each(results, function (result) {\n            // Save the assembly result in the right hidden input field\n            var id = elt.ownerTree._transloadit_generic_elts[result.field].id;\n            var input = formElt.find('#' + escapeSelector(id));\n            var nonEmptyKeys = _.filter(_.keys(result.meta), function (key) {\n              return !!isSet(result.meta[key]);\n            });\n            result.meta = _.pick(result.meta, nonEmptyKeys);\n            input.val(JSON.stringify(result));\n          });\n\n          // Unbind transloadit from the form\n          elt.ownerTree._transloadit_bound = false;\n          formElt.unbind('submit.transloadit');\n\n          // Submit the form on next tick\n          _.delay(function () {\n            elt.ownerTree.submit();\n          }, 10);\n        },\n        onError: function (assembly) {\n          // TODO: report the error to the user\n          console.log('assembly error', assembly);\n        }\n      });\n    },\n    'onInsert': function (evt, node) {\n      $(node.el).find('a._jsonform-delete').on('click', function (evt) {\n        $(node.el).find('._jsonform-preview').remove();\n        $(node.el).find('a._jsonform-delete').remove();\n        $(node.el).find('#' + escapeSelector(node.id)).val('');\n        evt.preventDefault();\n        return false;\n      });\n    },\n    'onSubmit':function(evt, elt) {\n      if (elt.ownerTree._transloadit_bound) {\n        return false;\n      }\n      return true;\n    }\n\n  },\n  'file-transloadit': {\n    'template': '<span><% if (value && (value.type||value.url)) { %>'+fileDisplayTemplate+'<% } %><input class=\"input-file\" id=\"_transloadit_<%= id %>\" type=\"file\" name=\"_transloadit_<%= node.name %>\" /><input type=\"hidden\" id=\"<%= id %>\" name=\"<%= node.name %>\" value=\\'<%= escape(JSON.stringify(node.value)) %>\\' /></span>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onChange': function (evt, elt) {\n      // The \"transloadit\" function should be called only once to enable\n      // the service when the form is submitted. Has it already been done?\n      if (elt.ownerTree._transloadit_bound) {\n        return false;\n      }\n      elt.ownerTree._transloadit_bound = true;\n\n      // Call the \"transloadit\" function on the form element\n      var formElt = $(elt.ownerTree.domRoot);\n      formElt.transloadit({\n        autoSubmit: false,\n        wait: true,\n        onSuccess: function (assembly) {\n          // Image has been uploaded. Check the \"results\" property that\n          // contains the list of files that Transloadit produced. Note\n          // JSONForm only supports 1-to-1 associations, meaning it\n          // expects the \"results\" property to contain only one image\n          // per file input in the form.\n          var results = _.values(assembly.results);\n          results = _.flatten(results);\n          _.each(results, function (result) {\n            // Save the assembly result in the right hidden input field\n            var input = formElt.find('input[name=\"' +\n              result.field.replace(/^_transloadit_/, '') +\n              '\"]');\n            var nonEmptyKeys = _.filter(_.keys(result.meta), function (key) {\n              return !!isSet(result.meta[key]);\n            });\n            result.meta = _.pick(result.meta, nonEmptyKeys);\n            input.val(JSON.stringify(result));\n          });\n\n          // Unbind transloadit from the form\n          elt.ownerTree._transloadit_bound = false;\n          formElt.unbind('submit.transloadit');\n\n          // Submit the form on next tick\n          _.delay(function () {\n            elt.ownerTree.submit();\n          }, 10);\n        },\n        onError: function (assembly) {\n          // TODO: report the error to the user\n          console.log('assembly error', assembly);\n        }\n      });\n    },\n    'onInsert': function (evt, node) {\n      $(node.el).find('a._jsonform-delete').on('click', function (evt) {\n        $(node.el).find('._jsonform-preview').remove();\n        $(node.el).find('a._jsonform-delete').remove();\n        $(node.el).find('#' + escapeSelector(node.id)).val('');\n        evt.preventDefault();\n        return false;\n      });\n    },\n    'onSubmit': function (evt, elt) {\n      if (elt.ownerTree._transloadit_bound) {\n        return false;\n      }\n      return true;\n    }\n  },\n  'select':{\n    'template':'<select name=\"<%= node.name %>\" id=\"<%= id %>\"' +\n      'class=\\'form-control<%= (fieldHtmlClass ? \" \" + fieldHtmlClass : \"\") %>\\'' +\n      '<%= (node.schemaElement && node.schemaElement.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      '> ' +\n      '<% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value=\"<%= key.value %>\"><%= key.title %></option> <% } else { %> <option value=\"<%= key.value %>\"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value=\"<%= key %>\"><%= key %></option> <% } else { %><option value=\"<%= key %>\"><%= key %></option> <% }}}); %> ' +\n      '</select>',\n    'fieldtemplate': true,\n    'inputfield': true\n  },\n  'imageselect': {\n    'template': '<div>' +\n      '<input type=\"hidden\" name=\"<%= node.name %>\" id=\"<%= node.id %>\" value=\"<%= value %>\" />' +\n      '<div class=\"dropdown\">' +\n      '<a class=\"btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } else { %> btn-default<% } %>\" data-toggle=\"dropdown\" href=\"#\"<% if (node.value) { %> style=\"max-width:<%= width %>px;max-height:<%= height %>px\"<% } %>>' +\n        '<% if (node.value) { %><img src=\"<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>\" alt=\"\" /><% } else { %><%= buttonTitle %><% } %>' +\n      '</a>' +\n      '<div class=\"dropdown-menu navbar\" id=\"<%= node.id %>_dropdown\">' +\n        '<div>' +\n        '<% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class=\"btn<% if (buttonClass) { %> <%= buttonClass %><% } else { %> btn-default<% } %>\" style=\"max-width:<%= width %>px;max-height:<%= height %>px\"><% if (key instanceof Object) { %><img src=\"<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>\" alt=\"<%= key.title %>\" /></a><% } else { %><img src=\"<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>\" alt=\"\" /><% } %></a> <% }); %>' +\n        '</div>' +\n        '<div class=\"pagination-right\"><a class=\"btn btn-default\">Reset</a></div>' +\n      '</div>' +\n      '</div>' +\n      '</div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onBeforeRender': function (data, node) {\n      var elt = node.formElement || {};\n      var nbRows = null;\n      var maxColumns = elt.imageSelectorColumns || 5;\n      data.buttonTitle = elt.imageSelectorTitle || 'Select...';\n      data.prefix = elt.imagePrefix || '';\n      data.suffix = elt.imageSuffix || '';\n      data.width = elt.imageWidth || 32;\n      data.height = elt.imageHeight || 32;\n      data.buttonClass = elt.imageButtonClass || false;\n      if (node.options.length > maxColumns) {\n        nbRows = Math.ceil(node.options.length / maxColumns);\n        data.columns = Math.ceil(node.options.length / nbRows);\n      }\n      else {\n        data.columns = maxColumns;\n      }\n    },\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onInsert': function (evt, node) {\n      $(node.el).on('click', '.dropdown-menu a', function (evt) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        var img = (evt.target.nodeName.toLowerCase() === 'img') ?\n          $(evt.target) :\n          $(evt.target).find('img');\n        var value = img.attr('src');\n        var elt = node.formElement || {};\n        var prefix = elt.imagePrefix || '';\n        var suffix = elt.imageSuffix || '';\n        var width = elt.imageWidth || 32;\n        var height = elt.imageHeight || 32;\n        if (value) {\n          if (value.indexOf(prefix) === 0) {\n            value = value.substring(prefix.length);\n          }\n          value = value.substring(0, value.length - suffix.length);\n          $(node.el).find('input').attr('value', value);\n          $(node.el).find('a[data-toggle=\"dropdown\"]')\n            .addClass(elt.imageButtonClass)\n            .attr('style', 'max-width:' + width + 'px;max-height:' + height + 'px')\n            .html('<img src=\"' + (!value.match(/^https?:/) ? prefix : '') + value + suffix + '\" alt=\"\" />');\n        }\n        else {\n          $(node.el).find('input').attr('value', '');\n          $(node.el).find('a[data-toggle=\"dropdown\"]')\n            .removeClass(elt.imageButtonClass)\n            .removeAttr('style')\n            .html(elt.imageSelectorTitle || 'Select...');\n        }\n      });\n    }\n  },\n  'iconselect': {\n    'template': '<div>' +\n      '<input type=\"hidden\" name=\"<%= node.name %>\" id=\"<%= node.id %>\" value=\"<%= value %>\" />' +\n      '<div class=\"dropdown\">' +\n      '<a class=\"btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>\" data-toggle=\"dropdown\" href=\"#\"<% if (node.value) { %> style=\"max-width:<%= width %>px;max-height:<%= height %>px\"<% } %>>' +\n        '<% if (node.value) { %><i class=\"icon-<%= node.value %>\" /><% } else { %><%= buttonTitle %><% } %>' +\n      '</a>' +\n      '<div class=\"dropdown-menu navbar\" id=\"<%= node.id %>_dropdown\">' +\n        '<div>' +\n        '<% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class=\"btn<% if (buttonClass) { %> <%= buttonClass %><% } %>\" ><% if (key instanceof Object) { %><i class=\"icon-<%= key.value %>\" alt=\"<%= key.title %>\" /></a><% } else { %><i class=\"icon-<%= key %>\" alt=\"\" /><% } %></a> <% }); %>' +\n        '</div>' +\n        '<div class=\"pagination-right\"><a class=\"btn\">Reset</a></div>' +\n      '</div>' +\n      '</div>' +\n      '</div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onBeforeRender': function (data, node) {\n      var elt = node.formElement || {};\n      var nbRows = null;\n      var maxColumns = elt.imageSelectorColumns || 5;\n      data.buttonTitle = elt.imageSelectorTitle || 'Select...';\n      data.buttonClass = elt.imageButtonClass || false;\n      if (node.options.length > maxColumns) {\n        nbRows = Math.ceil(node.options.length / maxColumns);\n        data.columns = Math.ceil(node.options.length / nbRows);\n      }\n      else {\n        data.columns = maxColumns;\n      }\n    },\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onInsert': function (evt, node) {\n      $(node.el).on('click', '.dropdown-menu a', function (evt) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        var i = (evt.target.nodeName.toLowerCase() === 'i') ?\n          $(evt.target) :\n          $(evt.target).find('i');\n        var value = i.attr('class');\n        var elt = node.formElement || {};\n        if (value) {\n          value = value;\n          $(node.el).find('input').attr('value', value);\n          $(node.el).find('a[data-toggle=\"dropdown\"]')\n            .addClass(elt.imageButtonClass)\n            .html('<i class=\"'+ value +'\" alt=\"\" />');\n        }\n        else {\n          $(node.el).find('input').attr('value', '');\n          $(node.el).find('a[data-toggle=\"dropdown\"]')\n            .removeClass(elt.imageButtonClass)\n            .html(elt.imageSelectorTitle || 'Select...');\n        }\n      });\n    }\n  },\n  'radios':{\n    'template': '<div id=\"<%= node.id %>\"><% _.each(node.options, function(key, val) { %><div class=\"radio\"><label><input<%= (fieldHtmlClass ? \" class=\\'\" + fieldHtmlClass + \"\\'\": \"\") %> type=\"radio\" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked=\"checked\" <% } %> name=\"<%= node.name %>\" value=\"<%= (key instanceof Object ? key.value : key) %>\"' +\n      '<%= (node.disabled? \" disabled\" : \"\")%>' +\n      '<%= (node.schemaElement && node.schemaElement.required ? \" required=\\'required\\'\" : \"\") %>' +\n      '/><%= (key instanceof Object ? key.title : key) %></label></div> <% }); %></div>',\n    'fieldtemplate': true,\n    'inputfield': true\n  },\n  'radiobuttons': {\n    'template': '<div id=\"<%= node.id %>\">' +\n      '<% _.each(node.options, function(key, val) { %>' +\n        '<label class=\"btn btn-default <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active btn-success<% } %>\">' +\n        '<input<%= (fieldHtmlClass ? \" class=\\'\" + fieldHtmlClass + \"\\'\": \"\") %> type=\"radio\" style=\"position:absolute;left:-9999px;\" ' +\n        '<% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked=\"checked\" <% } %> name=\"<%= node.name %>\" value=\"<%= (key instanceof Object ? key.value : key) %>\" />' +\n        '<span><%= (key instanceof Object ? key.title : key) %></span></label> ' +\n        '<% }); %>' +\n      '</div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onInsert': function (evt, node) {\n      var activeClass = 'active';\n      var elt = node.formElement || {};\n      if (elt.activeClass) {\n        activeClass += ' ' + elt.activeClass;\n      }\n      $(node.el).find('label').on('click', function () {\n        $(this).parent().find('label').removeClass(activeClass);\n        $(this).addClass(activeClass);\n      });\n    }\n  },\n  'checkboxes':{\n    'template': '<div><%= choiceshtml %></div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'onBeforeRender': function (data, node) {\n      // Build up choices from the enumeration list\n      var choices = null;\n      var choiceshtml = null;\n      var template = '<div class=\"checkbox\"><label>' +\n        '<input type=\"checkbox\" <% if (value) { %> checked=\"checked\" <% } %> name=\"<%= name %>\" value=\"1\"' +\n        '<%= (node.disabled? \" disabled\" : \"\")%>' +\n        '/><%= title %></label></div>';\n      if (!node || !node.schemaElement) return;\n\n      if (node.schemaElement.items) {\n        choices =\n          node.schemaElement.items[\"enum\"] ||\n          node.schemaElement.items[0][\"enum\"];\n      } else {\n        choices = node.schemaElement[\"enum\"];\n      }\n      if (!choices) return;\n\n      choiceshtml = '';\n      _.each(choices, function (choice, idx) {\n        choiceshtml += _.template(template, fieldTemplateSettings)({\n          name: node.key + '[' + idx + ']',\n          value: _.include(node.value, choice),\n          title: hasOwnProperty(node.formElement.titleMap, choice) ? node.formElement.titleMap[choice] : choice,\n          node: node\n        });\n      });\n\n      data.choiceshtml = choiceshtml;\n    }\n  },\n  'array': {\n    'template': '<div id=\"<%= id %>\"><ul class=\"_jsonform-array-ul\" style=\"list-style-type:none;\"><%= children %></ul>' +\n      '<span class=\"_jsonform-array-buttons\">' +\n        '<a href=\"#\" class=\"btn btn-default _jsonform-array-addmore\"><i class=\"glyphicon glyphicon-plus-sign\" title=\"Add new\"></i></a> ' +\n        '<a href=\"#\" class=\"btn btn-default _jsonform-array-deletelast\"><i class=\"glyphicon glyphicon-minus-sign\" title=\"Delete last\"></i></a>' +\n      '</span>' +\n      '</div>',\n    'fieldtemplate': true,\n    'array': true,\n    'childTemplate': function (inner, enableDrag) {\n      if ($('').sortable) {\n        // Insert a \"draggable\" icon\n        // floating to the left of the main element\n        return '<li data-idx=\"<%= node.childPos %>\">' +\n          // only allow drag of children if enabled\n          (enableDrag ? '<span class=\"draggable line\"><i class=\"glyphicon glyphicon-list\" title=\"Move item\"></i></span>' : '') +\n          inner +\n          '</li>';\n      }\n      else {\n        return '<li data-idx=\"<%= node.childPos %>\">' +\n          inner +\n          '</li>';\n      }\n    },\n    'onInsert': function (evt, node) {\n      var $nodeid = $(node.el).find('#' + escapeSelector(node.id));\n      var boundaries = node.getArrayBoundaries();\n\n      // Switch two nodes in an array\n      var moveNodeTo = function (fromIdx, toIdx) {\n        // Note \"switchValuesWith\" extracts values from the DOM since field\n        // values are not synchronized with the tree data structure, so calls\n        // to render are needed at each step to force values down to the DOM\n        // before next move.\n        // TODO: synchronize field values and data structure completely and\n        // call render only once to improve efficiency.\n        if (fromIdx === toIdx) return;\n        var incr = (fromIdx < toIdx) ? 1: -1;\n        var i = 0;\n        var parentEl = $('> ul', $nodeid);\n        for (i = fromIdx; i !== toIdx; i += incr) {\n          node.children[i].switchValuesWith(node.children[i + incr]);\n          node.children[i].render(parentEl.get(0));\n          node.children[i + incr].render(parentEl.get(0));\n        }\n\n        // No simple way to prevent DOM reordering with jQuery UI Sortable,\n        // so we're going to need to move sorted DOM elements back to their\n        // origin position in the DOM ourselves (we switched values but not\n        // DOM elements)\n        var fromEl = $(node.children[fromIdx].el);\n        var toEl = $(node.children[toIdx].el);\n        fromEl.detach();\n        toEl.detach();\n        if (fromIdx < toIdx) {\n          if (fromIdx === 0) parentEl.prepend(fromEl);\n          else $(node.children[fromIdx-1].el).after(fromEl);\n          $(node.children[toIdx-1].el).after(toEl);\n        }\n        else {\n          if (toIdx === 0) parentEl.prepend(toEl);\n          else $(node.children[toIdx-1].el).after(toEl);\n          $(node.children[fromIdx-1].el).after(fromEl);\n        }\n      };\n\n      $('> span > a._jsonform-array-addmore', $nodeid).click(function (evt) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        var idx = node.children.length;\n        if (boundaries.maxItems >= 0) {\n          if (node.children.length > boundaries.maxItems - 2) {\n            $nodeid.find('> span > a._jsonform-array-addmore')\n              .addClass('disabled');\n          }\n          if (node.children.length > boundaries.maxItems - 1) {\n            return false;\n          }\n        }\n        node.insertArrayItem(idx, $('> ul', $nodeid).get(0));\n        if ((boundaries.minItems <= 0) ||\n            ((boundaries.minItems > 0) &&\n              (node.children.length > boundaries.minItems - 1))) {\n          $nodeid.find('> span > a._jsonform-array-deletelast')\n            .removeClass('disabled');\n        }\n      });\n\n      //Simulate Users click to setup the form with its minItems\n      var curItems = $('> ul > li', $nodeid).length;\n      if ((boundaries.minItems > 0) &&\n          (curItems < boundaries.minItems)) {\n        for (var i = 0; i < (boundaries.minItems - 1) && ($nodeid.find('> ul > li').length < boundaries.minItems); i++) {\n          node.insertArrayItem(curItems, $nodeid.find('> ul').get(0));\n        }\n      }\n      if ((boundaries.minItems > 0) &&\n          (node.children.length <= boundaries.minItems)) {\n        $nodeid.find('> span > a._jsonform-array-deletelast')\n          .addClass('disabled');\n      }\n\n      $('> span > a._jsonform-array-deletelast', $nodeid).click(function (evt) {\n        var idx = node.children.length - 1;\n        evt.preventDefault();\n        evt.stopPropagation();\n        if (boundaries.minItems > 0) {\n          if (node.children.length < boundaries.minItems + 2) {\n            $nodeid.find('> span > a._jsonform-array-deletelast')\n              .addClass('disabled');\n          }\n          if (node.children.length <= boundaries.minItems) {\n            return false;\n          }\n        }\n        else if (node.children.length === 1) {\n          $nodeid.find('> span > a._jsonform-array-deletelast')\n            .addClass('disabled');\n        }\n        node.deleteArrayItem(idx);\n        if ((boundaries.maxItems >= 0) && (idx <= boundaries.maxItems - 1)) {\n          $nodeid.find('> span > a._jsonform-array-addmore')\n            .removeClass('disabled');\n        }\n      });\n\n      // only allow drag if default or enabled\n      if (!isSet(node.formElement.draggable) || node.formElement.draggable) {\n        if ($(node.el).sortable) {\n          $('> ul', $nodeid).sortable();\n          $('> ul', $nodeid).bind('sortstop', function (event, ui) {\n            var idx = $(ui.item).data('idx');\n            var newIdx = $(ui.item).index();\n            moveNodeTo(idx, newIdx);\n          });\n        }\n      }\n    }\n  },\n  'tabarray': {\n    'template': '<div id=\"<%= id %>\"><div class=\"tabbable tabs-left\">' +\n      '<ul class=\"nav nav-tabs\">' +\n        '<%= tabs %>' +\n      '</ul>' +\n      '<div class=\"tab-content\">' +\n        '<%= children %>' +\n      '</div>' +\n      '</div>' +\n      '<a href=\"#\" class=\"btn btn-default _jsonform-array-addmore\"><i class=\"glyphicon glyphicon-plus-sign\" title=\"Add new\"></i></a> ' +\n      '<a href=\"#\" class=\"btn btn-default _jsonform-array-deleteitem\"><i class=\"glyphicon glyphicon-minus-sign\" title=\"Delete item\"></i></a></div>',\n    'fieldtemplate': true,\n    'array': true,\n    'childTemplate': function (inner) {\n      return '<div data-idx=\"<%= node.childPos %>\" class=\"tab-pane\">' +\n        inner +\n        '</div>';\n    },\n    'onBeforeRender': function (data, node) {\n      // Generate the initial 'tabs' from the children\n      var tabs = '';\n      _.each(node.children, function (child, idx) {\n        var title = child.legend ||\n          child.title ||\n          ('Item ' + (idx+1));\n        tabs += '<li data-idx=\"' + idx + '\"' +\n          ((idx === 0) ? ' class=\"active\"' : '') +\n          '><a class=\"draggable tab\" data-toggle=\"tab\" rel=\"' + escape(title) + '\">' +\n          escapeHTML(title) +\n          '</a></li>';\n      });\n      data.tabs = tabs;\n    },\n    'onInsert': function (evt, node) {\n      var $nodeid = $(node.el).find('#' + escapeSelector(node.id));\n      var boundaries = node.getArrayBoundaries();\n\n      var moveNodeTo = function (fromIdx, toIdx) {\n        // Note \"switchValuesWith\" extracts values from the DOM since field\n        // values are not synchronized with the tree data structure, so calls\n        // to render are needed at each step to force values down to the DOM\n        // before next move.\n        // TODO: synchronize field values and data structure completely and\n        // call render only once to improve efficiency.\n        if (fromIdx === toIdx) return;\n        var incr = (fromIdx < toIdx) ? 1: -1;\n        var i = 0;\n        var tabEl = $('> .tabbable > .tab-content', $nodeid).get(0);\n        for (i = fromIdx; i !== toIdx; i += incr) {\n          node.children[i].switchValuesWith(node.children[i + incr]);\n          node.children[i].render(tabEl);\n          node.children[i + incr].render(tabEl);\n        }\n      };\n\n\n      // Refreshes the list of tabs\n      var updateTabs = function (selIdx) {\n        var tabs = '';\n        var activateFirstTab = false;\n        if (selIdx === undefined) {\n          selIdx = $('> .tabbable > .nav-tabs .active', $nodeid).data('idx');\n          if (selIdx) {\n            selIdx = parseInt(selIdx, 10);\n          }\n          else {\n            activateFirstTab = true;\n            selIdx = 0;\n          }\n        }\n        if (selIdx >= node.children.length) {\n          selIdx = node.children.length - 1;\n        }\n        _.each(node.children, function (child, idx) {\n          $('> .tabbable > .tab-content > [data-idx=\"' + idx + '\"] > fieldset > legend', $nodeid).html(child.legend);\n          var title = child.legend || child.title || ('Item ' + (idx+1));\n          tabs += '<li data-idx=\"' + idx + '\">' +\n                  '<a class=\"draggable tab\" data-toggle=\"tab\" rel=\"' + escape(title) + '\">' +\n                  escapeHTML(title) +\n                  '</a></li>';\n        });\n        $('> .tabbable > .nav-tabs', $nodeid).html(tabs);\n        if (activateFirstTab) {\n          $('> .tabbable > .nav-tabs [data-idx=\"0\"]', $nodeid).addClass('active');\n        }\n        $('> .tabbable > .nav-tabs [data-toggle=\"tab\"]', $nodeid).eq(selIdx).click();\n      };\n\n      $('> a._jsonform-array-deleteitem', $nodeid).click(function (evt) {\n        var idx = $('> .tabbable > .nav-tabs .active', $nodeid).data('idx');\n        evt.preventDefault();\n        evt.stopPropagation();\n        if (boundaries.minItems > 0) {\n          if (node.children.length < boundaries.minItems + 1) {\n            $nodeid.find('> a._jsonform-array-deleteitem')\n              .addClass('disabled');\n          }\n          if (node.children.length <= boundaries.minItems) return false;\n        }\n        node.deleteArrayItem(idx);\n        updateTabs();\n        if ((node.children.length < boundaries.minItems + 1) ||\n            (node.children.length === 0)) {\n          $nodeid.find('> a._jsonform-array-deleteitem').addClass('disabled');\n        }\n        if ((boundaries.maxItems >= 0) &&\n            (node.children.length <= boundaries.maxItems)) {\n          $nodeid.find('> a._jsonform-array-addmore').removeClass('disabled');\n        }\n      });\n\n      $('> a._jsonform-array-addmore', $nodeid).click(function (evt) {\n        var idx = node.children.length;\n        if (boundaries.maxItems>=0) {\n          if (node.children.length>boundaries.maxItems-2) {\n            $('> a._jsonform-array-addmore', $nodeid).addClass(\"disabled\");\n          }\n          if (node.children.length > boundaries.maxItems - 1) {\n            return false;\n          }\n        }\n        evt.preventDefault();\n        evt.stopPropagation();\n        node.insertArrayItem(idx,\n          $nodeid.find('> .tabbable > .tab-content').get(0));\n        updateTabs(idx);\n        if ((boundaries.minItems <= 0) ||\n            ((boundaries.minItems > 0) && (idx > boundaries.minItems - 1))) {\n          $nodeid.find('> a._jsonform-array-deleteitem').removeClass('disabled');\n        }\n      });\n\n      $(node.el).on('legendUpdated', function (evt) {\n        updateTabs();\n        evt.preventDefault();\n        evt.stopPropagation();\n      });\n\n      // only allow drag if default or enabled\n      if (!isSet(node.formElement.draggable) || node.formElement.draggable) {\n        if ($(node.el).sortable) {\n          $('> .tabbable > .nav-tabs', $nodeid).sortable({\n            containment: node.el,\n            tolerance: 'pointer'\n          });\n          $('> .tabbable > .nav-tabs', $nodeid).bind('sortstop', function (event, ui) {\n            var idx = $(ui.item).data('idx');\n            var newIdx = $(ui.item).index();\n            moveNodeTo(idx, newIdx);\n            updateTabs(newIdx);\n          });\n        }\n      }\n\n      // Simulate User's click to setup the form with its minItems\n      if ((boundaries.minItems >= 0)  &&\n          (node.children.length <= boundaries.minItems)) {\n        for (var i = 0; i < (boundaries.minItems - 1); i++) {\n          $nodeid.find('> a._jsonform-array-addmore').click();\n        }\n        $nodeid.find('> a._jsonform-array-deleteitem').addClass('disabled');\n        updateTabs();\n      }\n\n      if ((boundaries.maxItems >= 0) &&\n          (node.children.length >= boundaries.maxItems)) {\n        $nodeid.find('> a._jsonform-array-addmore').addClass('disabled');\n      }\n      if ((boundaries.minItems >= 0) &&\n          (node.children.length <= boundaries.minItems)) {\n        $nodeid.find('> a._jsonform-array-deleteitem').addClass('disabled');\n      }\n    }\n  },\n  'help': {\n    'template':'<span class=\"help-block\" style=\"padding-top:5px\"><%= elt.helpvalue %></span>',\n    'fieldtemplate': true\n  },\n  'msg': {\n    'template': '<%= elt.msg %>'\n  },\n  'fieldset': {\n    'template': '<fieldset class=\"form-group jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:\"\" %>\" ' +\n      '<% if (id) { %> id=\"<%= id %>\"<% } %>' +\n      '>' +\n      '<% if (node.title || node.legend) { %><legend role=\"treeitem\" aria-expanded=\"false\"><%= node.title || node.legend %></legend><% } %>' +\n      '<% if (elt.expandable) { %><div class=\"form-group\"><% } %>' +\n      '<%= children %>' +\n      '<% if (elt.expandable) { %></div><% } %>' +\n      '</fieldset>',\n    onInsert: function (evt, node) {\n      if (node.el !== null) {\n        $('.expandable > div, .expandable > fieldset', node.el).hide();\n        // See #233\n        $(\".expandable\", node.el).removeClass(\"expanded\");\n      }\n    }\n  },\n  'advancedfieldset': {\n    'template': '<fieldset' +\n      '<% if (id) { %> id=\"<%= id %>\"<% } %>' +\n      ' class=\"expandable <%= elt.htmlClass?elt.htmlClass:\"\" %>\">' +\n      '<legend role=\"treeitem\" aria-expanded=\"false\"><%= (node.title || node.legend) ? (node.title || node.legend) : \"Advanced options\" %></legend>' +\n      '<div class=\"form-group\">' +\n      '<%= children %>' +\n      '</div>' +\n      '</fieldset>',\n    onInsert: function (evt, node) {\n      if (node.el !== null) {\n        $('.expandable > div, .expandable > fieldset', node.el).hide();\n        // See #233\n        $(\".expandable\", node.el).removeClass(\"expanded\");\n      }\n    }\n  },\n  'authfieldset': {\n    'template': '<fieldset' +\n      '<% if (id) { %> id=\"<%= id %>\"<% } %>' +\n      ' class=\"expandable <%= elt.htmlClass?elt.htmlClass:\"\" %>\">' +\n      '<legend role=\"treeitem\" aria-expanded=\"false\"><%= (node.title || node.legend) ? (node.title || node.legend) : \"Authentication settings\" %></legend>' +\n      '<div class=\"form-group\">' +\n      '<%= children %>' +\n      '</div>' +\n      '</fieldset>',\n    onInsert: function (evt, node) {\n      if (node.el !== null) {\n        $('.expandable > div, .expandable > fieldset', node.el).hide();\n        // See #233\n        $(\".expandable\", node.el).removeClass(\"expanded\");\n      }\n    }\n  },\n  'submit':{\n    'template':'<input type=\"submit\" <% if (id) { %> id=\"<%= id %>\" <% } %> class=\"btn btn-primary <%= elt.htmlClass?elt.htmlClass:\"\" %>\" value=\"<%= value || node.title %>\"<%= (node.disabled? \" disabled\" : \"\")%>/>'\n  },\n  'button':{\n    'template':' <button type=\"button\" <% if (id) { %> id=\"<%= id %>\" <% } %> class=\"btn btn-default <%= elt.htmlClass?elt.htmlClass:\"\" %>\"><%= node.title %></button> '\n  },\n  'actions':{\n    'template':'<div class=\"<%= elt.htmlClass?elt.htmlClass:\"\" %>\"><%= children %></div>'\n  },\n  'hidden':{\n    'template':'<input type=\"hidden\" id=\"<%= id %>\" name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" />',\n    'inputfield': true\n  },\n  'tabs':{\n    'template':'<ul class=\"nav nav-tabs <%= elt.htmlClass?elt.htmlClass:\"\" %>\"' +\n    '<% if (elt.id) { %> id=\"<%= elt.id %>\"<% } %>' +\n    '><%=tab_list%></ul><div class=\"tab-content\" <% if (elt.id) { %> data-tabset=\"<%= elt.id %>\"<% } %>><%=children%></div>',\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onBeforeRender': function (data, node) {\n      // Generate the initial 'tabs' from the children\n      var parentID = escapeHTML(node.id ? node.id + \"-\" : \"\")\n      var tab_list = '';\n      _.each(node.children, function (child, idx) {\n        var title = escapeHTML(child.title || ('Item ' + (idx+1)));\n        var title_escaped = title.replace(\" \",\"_\");\n        tab_list += '<li class=\"nav-item' +\n          ((idx === 0) ? ' active' : '') + '\">' +\n          '<a href=\"#'+ parentID + title_escaped +'\" class=\"nav-link\"' +\n          ' data-tab=\"' + parentID + title_escaped + '\"' +\n          ' data-toggle=\"tab\">' + title +\n          '</a></li>';\n      });\n      data.tab_list = tab_list;\n      return data;\n    },\n    'onInsert': function(evt, node){\n      $(\"#\"+node.id+\">li.nav-item\").on(\"click\", function(e){\n        e.preventDefault();\n        $(node.el).find(\"div[data-tabset='\"+node.id+\"']>div.tab-pane.active\").each(function(){\n          $(this).removeClass(\"active\");\n        })\n        var tab_id = $(this).find('a').attr('data-tab');\n        $(\"#\"+tab_id).addClass(\"active\");\n      });\n    }\n  },\n  'tab':{\n    'template': '<div class=\"tab-pane' +\n    '<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %>' +\n        //Set the first tab as active\n    '<% if (node.childPos === 0) { %> active<% } %>' +\n    '\"' + //Finish end quote of class tag\n    '<% if (node.title) { %> id=\"<%= node.parentNode.id %>-<%= node.title.replace(\" \",\"_\") %>\"<% } %>' +\n    '><%= children %></div>'\n  },\n  'selectfieldset': {\n    'template': '<fieldset class=\"tab-container <%= elt.htmlClass?elt.htmlClass:\"\" %>\">' +\n      '<% if (node.legend) { %><legend role=\"treeitem\" aria-expanded=\"false\"><%= node.legend %></legend><% } %>' +\n      '<% if (node.formElement.key) { %><input type=\"hidden\" id=\"<%= node.id %>\" name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" /><% } else { %>' +\n        '<a id=\"<%= node.id %>\"></a><% } %>' +\n      '<div class=\"tabbable\">' +\n        '<div class=\"form-group<%= node.formElement.hideMenu ? \" hide\" : \"\" %>\">' +\n          '<% if (!elt.notitle) { %><label for=\"<%= node.id %>\"><%= node.title ? node.title : node.name %></label><% } %>' +\n          '<div class=\"controls\"><%= tabs %></div>' +\n        '</div>' +\n        '<div class=\"tab-content\">' +\n          '<%= children %>' +\n        '</div>' +\n      '</div>' +\n      '</fieldset>',\n    'inputfield': true,\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'childTemplate': function (inner) {\n      return '<div data-idx=\"<%= node.childPos %>\" class=\"tab-pane' +\n        '<% if (node.active) { %> active<% } %>\">' +\n        inner +\n        '</div>';\n    },\n    'onBeforeRender': function (data, node) {\n      // Before rendering, this function ensures that:\n      // 1. direct children have IDs (used to show/hide the tabs contents)\n      // 2. the tab to active is flagged accordingly. The active tab is\n      // the first one, except if form values are available, in which case\n      // it's the first tab for which there is some value available (or back\n      // to the first one if there are none)\n      // 3. the HTML of the select field used to select tabs is exposed in the\n      // HTML template data as \"tabs\"\n\n      var children = null;\n      var choices = [];\n      if (node.schemaElement) {\n        choices = node.schemaElement['enum'] || [];\n      }\n      if (node.options) {\n        children = _.map(node.options, function (option, idx) {\n          var child = node.children[idx];\n          child.childPos = idx; // When nested the childPos is always 0.\n          if (option instanceof Object) {\n            option = _.extend({ node: child }, option);\n            option.title = option.title ||\n              child.legend ||\n              child.title ||\n              ('Option ' + (child.childPos+1));\n            option.value = isSet(option.value) ? option.value :\n              isSet(choices[idx]) ? choices[idx] : idx;\n            return option;\n          }\n          else {\n            return {\n              title: option,\n              value: isSet(choices[child.childPos]) ?\n                choices[child.childPos] :\n                child.childPos,\n              node: child\n            };\n          }\n        });\n      }\n      else {\n        children = _.map(node.children, function (child, idx) {\n          child.childPos = idx; // When nested the childPos is always 0.\n          return {\n            title: child.legend || child.title || ('Option ' + (child.childPos+1)),\n            value: choices[child.childPos] || child.childPos,\n            node: child\n          };\n        });\n      }\n\n      // Reset each children to inactive so that they are not shown on insert\n      // The active one will then be shown later one. This is useful when sorting\n      // arrays with selectfieldset, otherwise both fields could be active at the\n      // same time.\n      _.each(children, function (child, idx) {\n        child.node.active = false\n      });\n\n      var activeChild = null;\n      if (data.value) {\n        activeChild = _.find(children, function (child) {\n          return (child.value === node.value);\n        });\n      }\n      if (!activeChild) {\n        activeChild = _.find(children, function (child) {\n          return child.node.hasNonDefaultValue();\n        });\n      }\n      if (!activeChild) {\n        activeChild = children[0];\n      }\n      activeChild.node.active = true;\n      data.value = activeChild.value;\n\n      var elt = node.formElement;\n      var tabs = '<select class=\"nav form-control\"' +\n        (node.disabled ? ' disabled' : '') +\n        '>';\n      _.each(children, function (child, idx) {\n        tabs += '<option data-idx=\"' + idx + '\" value=\"' + child.value + '\"' +\n          (child.node.active ? ' selected=\"selected\" class=\"active\"' : '') +\n          '>' +\n          escapeHTML(child.title) +\n          '</option>';\n      });\n      tabs += '</select>';\n\n      data.tabs = tabs;\n      return data;\n    },\n    'onInsert': function (evt, node) {\n      $(node.el).find('select.nav').first().on('change', function (evt) {\n        var $option = $(this).find('option:selected');\n        $(node.el).find('input[type=\"hidden\"]').first().val($option.attr('value'));\n      });\n    }\n  },\n  'optionfieldset': {\n    'template': '<div' +\n      '<% if (node.id) { %> id=\"<%= node.id %>\"<% } %>' +\n      '>' +\n      '<%= children %>' +\n      '</div>'\n  },\n  'section': {\n    'template': '<div' +\n      '<% if (elt.htmlClass) { %> class=\"<%= elt.htmlClass %>\"<% } %>' +\n      '<% if (node.id) { %> id=\"<%= node.id %>\"<% } %>' +\n      '><%= children %></div>'\n  },\n\n  /**\n   * A \"questions\" field renders a series of question fields and binds the\n   * result to the value of a schema key.\n   */\n  'questions': {\n    'template': '<div>' +\n      '<input type=\"hidden\" id=\"<%= node.id %>\" name=\"<%= node.name %>\" value=\"<%= escape(value) %>\" />' +\n      '<%= children %>' +\n      '</div>',\n    'fieldtemplate': true,\n    'inputfield': true,\n    'getElement': function (el) {\n      return $(el).parent().get(0);\n    },\n    'onInsert': function (evt, node) {\n      if (!node.children || (node.children.length === 0)) return;\n      _.each(node.children, function (child) {\n        $(child.el).hide();\n      });\n      $(node.children[0].el).show();\n    }\n  },\n\n  /**\n   * A \"question\" field lets user choose a response among possible choices.\n   * The field is not associated with any schema key. A question should be\n   * part of a \"questions\" field that binds a series of questions to a\n   * schema key.\n   */\n  'question': {\n    'template': '<div id=\"<%= node.id %>\"><% _.each(node.options, function(key, val) { %><label class=\"<%= (node.formElement.optionsType === \"radiobuttons\") ? \"btn btn-default\" : \"\" %><%= ((key instanceof Object && key.htmlClass) ? \" \" + key.htmlClass : \"\") %>\"><input type=\"radio\" <% if (node.formElement.optionsType === \"radiobuttons\") { %> style=\"position:absolute;left:-9999px;\" <% } %>name=\"<%= node.id %>\" value=\"<%= val %>\"<%= (node.disabled? \" disabled\" : \"\")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',\n    'fieldtemplate': true,\n    'onInsert': function (evt, node) {\n      var activeClass = 'active';\n      var elt = node.formElement || {};\n      if (elt.activeClass) {\n        activeClass += ' ' + elt.activeClass;\n      }\n\n      // Bind to change events on radio buttons\n      $(node.el).find('input[type=\"radio\"]').on('change', function (evt) {\n        var questionNode = null;\n        var option = node.options[$(this).val()];\n        if (!node.parentNode || !node.parentNode.el) return;\n\n        $(this).parent().parent().find('label').removeClass(activeClass);\n        $(this).parent().addClass(activeClass);\n        $(node.el).nextAll().hide();\n        $(node.el).nextAll().find('input[type=\"radio\"]').prop('checked', false);\n\n        // Execute possible actions (set key value, form submission, open link,\n        // move on to next question)\n        if (option.value) {\n          // Set the key of the 'Questions' parent\n          $(node.parentNode.el).find('input[type=\"hidden\"]').val(option.value);\n        }\n        if (option.next) {\n          questionNode = _.find(node.parentNode.children, function (child) {\n            return (child.formElement && (child.formElement.qid === option.next));\n          });\n          $(questionNode.el).show();\n          $(questionNode.el).nextAll().hide();\n          $(questionNode.el).nextAll().find('input[type=\"radio\"]').prop('checked', false);\n        }\n        if (option.href) {\n          if (option.target) {\n            window.open(option.href, option.target);\n          }\n          else {\n            window.location = option.href;\n          }\n        }\n        if (option.submit) {\n          setTimeout(function () {\n            node.ownerTree.submit();\n          }, 0);\n        }\n      });\n    }\n  }\n};\n\n\n//Allow to access subproperties by splitting \".\"\n/**\n * Retrieves the key identified by a path selector in the structured object.\n *\n * Levels in the path are separated by a dot. Array items are marked\n * with [x]. For instance:\n *  foo.bar[3].baz\n *\n * @function\n * @param {Object} obj Structured object to parse\n * @param {String} key Path to the key to retrieve\n * @param {boolean} ignoreArrays True to use first element in an array when\n *   stucked on a property. This parameter is basically only useful when\n *   parsing a JSON schema for which the \"items\" property may either be an\n *   object or an array with one object (only one because JSON form does not\n *   support mix of items for arrays).\n * @return {Object} The key's value.\n */\njsonform.util.getObjKey = function (obj, key, ignoreArrays) {\n  var innerobj = obj;\n  var keyparts = key.split(\".\");\n  var subkey = null;\n  var arrayMatch = null;\n  var prop = null;\n\n  for (var i = 0; i < keyparts.length; i++) {\n    if ((innerobj === null) || (typeof innerobj !== \"object\")) return null;\n    subkey = keyparts[i];\n    prop = subkey.replace(reArray, '');\n    reArray.lastIndex = 0;\n    arrayMatch = reArray.exec(subkey);\n    if (arrayMatch) {\n      while (true) {\n        if (prop && !_.isArray(innerobj[prop])) return null;\n        innerobj = prop ? innerobj[prop][parseInt(arrayMatch[1])] : innerobj[parseInt(arrayMatch[1])];\n        arrayMatch = reArray.exec(subkey);\n        if (!arrayMatch) break;\n        // In the case of multidimensional arrays,\n        // we should not take innerobj[prop][0] anymore,\n        // but innerobj[0] directly\n        prop = null;\n      }\n    } else if (ignoreArrays &&\n        !innerobj[prop] &&\n        _.isArray(innerobj) &&\n        innerobj[0]) {\n      innerobj = innerobj[0][prop];\n    } else {\n      innerobj = innerobj[prop];\n    }\n  }\n\n  if (ignoreArrays && _.isArray(innerobj) && innerobj[0]) {\n    return innerobj[0];\n  } else {\n    return innerobj;\n  }\n};\n\n\n/**\n * Sets the key identified by a path selector to the given value.\n *\n * Levels in the path are separated by a dot. Array items are marked\n * with [x]. For instance:\n *  foo.bar[3].baz\n *\n * The hierarchy is automatically created if it does not exist yet.\n *\n * @function\n * @param {Object} obj The object to build\n * @param {String} key The path to the key to set where each level\n *  is separated by a dot, and array items are flagged with [x].\n * @param {Object} value The value to set, may be of any type.\n */\njsonform.util.setObjKey = function(obj,key,value) {\n  var innerobj = obj;\n  var keyparts = key.split(\".\");\n  var subkey = null;\n  var arrayMatch = null;\n  var prop = null;\n\n  for (var i = 0; i < keyparts.length-1; i++) {\n    subkey = keyparts[i];\n    prop = subkey.replace(reArray, '');\n    reArray.lastIndex = 0;\n    arrayMatch = reArray.exec(subkey);\n    if (arrayMatch) {\n      // Subkey is part of an array\n      while (true) {\n        if (!_.isArray(innerobj[prop])) {\n          innerobj[prop] = [];\n        }\n        innerobj = innerobj[prop];\n        prop = parseInt(arrayMatch[1], 10);\n        arrayMatch = reArray.exec(subkey);\n        if (!arrayMatch) break;\n      }\n      if ((typeof innerobj[prop] !== 'object') ||\n        (innerobj[prop] === null)) {\n        innerobj[prop] = {};\n      }\n      innerobj = innerobj[prop];\n    }\n    else {\n      // \"Normal\" subkey\n      if ((typeof innerobj[prop] !== 'object') ||\n        (innerobj[prop] === null)) {\n        innerobj[prop] = {};\n      }\n      innerobj = innerobj[prop];\n    }\n  }\n\n  // Set the final value\n  subkey = keyparts[keyparts.length - 1];\n  prop = subkey.replace(reArray, '');\n  reArray.lastIndex = 0;\n  arrayMatch = reArray.exec(subkey);\n  if (arrayMatch) {\n    while (true) {\n      if (!_.isArray(innerobj[prop])) {\n        innerobj[prop] = [];\n      }\n      innerobj = innerobj[prop];\n      prop = parseInt(arrayMatch[1], 10);\n      arrayMatch = reArray.exec(subkey);\n      if (!arrayMatch) break;\n    }\n    innerobj[prop] = value;\n  }\n  else {\n    innerobj[prop] = value;\n  }\n};\n\n\n/**\n * Retrieves the key definition from the given schema.\n *\n * The key is identified by the path that leads to the key in the\n * structured object that the schema would generate. Each level is\n * separated by a '.'. Array levels are marked with []. For instance:\n *  foo.bar[].baz\n * ... to retrieve the definition of the key at the following location\n * in the JSON schema (using a dotted path notation):\n *  foo.properties.bar.items.properties.baz\n *\n * @function\n * @param {Object} schema The JSON schema to retrieve the key from\n * @param {String} key The path to the key, each level being separated\n *  by a dot and array items being flagged with [].\n * @return {Object} The key definition in the schema, null if not found.\n */\nvar getSchemaKey = function(schema,key) {\n  var schemaKey = key\n    .replace(/\\./g, '.properties.')\n    .replace(/\\[[0-9]*\\]/g, '.items');\n  var schemaDef = jsonform.util.getObjKey(schema, schemaKey, true);\n  if (schemaDef && schemaDef.$ref) {\n    throw new Error('JSONForm does not yet support schemas that use the ' +\n      '$ref keyword. See: https://github.com/joshfire/jsonform/issues/54');\n  }\n  return schemaDef;\n};\n\n\n/**\n * Truncates the key path to the requested depth.\n *\n * For instance, if the key path is:\n *  foo.bar[].baz.toto[].truc[].bidule\n * and the requested depth is 1, the returned key will be:\n *  foo.bar[].baz.toto\n *\n * Note the function includes the path up to the next depth level.\n *\n * @function\n * @param {String} key The path to the key in the schema, each level being\n *  separated by a dot and array items being flagged with [].\n * @param {Number} depth The array depth\n * @return {String} The path to the key truncated to the given depth.\n */\nvar truncateToArrayDepth = function (key, arrayDepth) {\n  var depth = 0;\n  var pos = 0;\n  if (!key) return null;\n\n  if (arrayDepth > 0) {\n    while (depth < arrayDepth) {\n      pos = key.indexOf('[]', pos);\n      if (pos === -1) {\n        // Key path is not \"deep\" enough, simply return the full key\n        return key;\n      }\n      pos = pos + 2;\n      depth += 1;\n    }\n  }\n\n  // Move one step further to the right without including the final []\n  pos = key.indexOf('[]', pos);\n  if (pos === -1) return key;\n  else return key.substring(0, pos);\n};\n\n/**\n * Applies the array path to the key path.\n *\n * For instance, if the key path is:\n *  foo.bar[].baz.toto[].truc[].bidule\n * and the arrayPath [4, 2], the returned key will be:\n *  foo.bar[4].baz.toto[2].truc[].bidule\n *\n * @function\n * @param {String} key The path to the key in the schema, each level being\n *  separated by a dot and array items being flagged with [].\n * @param {Array(Number)} arrayPath The array path to apply, e.g. [4, 2]\n * @return {String} The path to the key that matches the array path.\n */\nvar applyArrayPath = function (key, arrayPath) {\n  var depth = 0;\n  if (!key) return null;\n  if (!arrayPath || (arrayPath.length === 0)) return key;\n  var newKey = key.replace(reArray, function (str, p1) {\n    // Note this function gets called as many times as there are [x] in the ID,\n    // from left to right in the string. The goal is to replace the [x] with\n    // the appropriate index in the new array path, if defined.\n    var newIndex = str;\n    if (isSet(arrayPath[depth])) {\n      newIndex = '[' + arrayPath[depth] + ']';\n    }\n    depth += 1;\n    return newIndex;\n  });\n  return newKey;\n};\n\n\n/**\n * Returns the initial value that a field identified by its key\n * should take.\n *\n * The \"initial\" value is defined as:\n * 1. the previously submitted value if already submitted\n * 2. the default value defined in the layout of the form\n * 3. the default value defined in the schema\n *\n * The \"value\" returned is intended for rendering purpose,\n * meaning that, for fields that define a titleMap property,\n * the function returns the label, and not the intrinsic value.\n *\n * The function handles values that contains template strings,\n * e.g. {{values.foo[].bar}} or {{idx}}.\n *\n * When the form is a string, the function truncates the resulting string\n * to meet a potential \"maxLength\" constraint defined in the schema, using\n * \"...\" to mark the truncation. Note it does not validate the resulting\n * string against other constraints (e.g. minLength, pattern) as it would\n * be hard to come up with an automated course of action to \"fix\" the value.\n *\n * @function\n * @param {Object} formObject The JSON Form object\n * @param {String} key The generic key path (e.g. foo[].bar.baz[])\n * @param {Array(Number)} arrayPath The array path that identifies\n *  the unique value in the submitted form (e.g. [1, 3])\n * @param {Object} tpldata Template data object\n * @param {Boolean} usePreviousValues true to use previously submitted values\n *  if defined.\n */\nvar getInitialValue = function (formObject, key, arrayPath, tpldata, usePreviousValues) {\n  var value = null;\n\n  // Complete template data for template function\n  tpldata = tpldata || {};\n  tpldata.idx = tpldata.idx ||\n    (arrayPath ? arrayPath[arrayPath.length-1] : 1);\n  tpldata.value = isSet(tpldata.value) ? tpldata.value : '';\n  tpldata.getValue = tpldata.getValue || function (key) {\n    return getInitialValue(formObject, key, arrayPath, tpldata, usePreviousValues);\n  };\n\n  // Helper function that returns the form element that explicitly\n  // references the given key in the schema.\n  var getFormElement = function (elements, key) {\n    var formElement = null;\n    if (!elements || !elements.length) return null;\n    _.each(elements, function (elt) {\n      if (formElement) return;\n      if (elt === key) {\n        formElement = { key: elt };\n        return;\n      }\n      if (_.isString(elt)) return;\n      if (elt.key === key) {\n        formElement = elt;\n      }\n      else if (elt.items) {\n        formElement = getFormElement(elt.items, key);\n      }\n    });\n    return formElement;\n  };\n  var formElement = getFormElement(formObject.form || [], key);\n  var schemaElement = getSchemaKey(formObject.schema.properties, key);\n\n  if (usePreviousValues && formObject.value) {\n    // If values were previously submitted, use them directly if defined\n    value = jsonform.util.getObjKey(formObject.value, applyArrayPath(key, arrayPath));\n  }\n  if (!isSet(value)) {\n    if (formElement && (typeof formElement['value'] !== 'undefined')) {\n      // Extract the definition of the form field associated with\n      // the key as it may override the schema's default value\n      // (note a \"null\" value overrides a schema default value as well)\n      value = formElement['value'];\n    }\n    else if (schemaElement) {\n      // Simply extract the default value from the schema\n      if (isSet(schemaElement['default'])) {\n        value = schemaElement['default'];\n      }\n    }\n    if (value && value.indexOf('{{values.') !== -1) {\n      // This label wants to use the value of another input field.\n      // Convert that construct into {{getValue(key)}} for\n      // Underscore to call the appropriate function of formData\n      // when template gets called (note calling a function is not\n      // exactly Mustache-friendly but is supported by Underscore).\n      value = value.replace(\n        /\\{\\{values\\.([^\\}]+)\\}\\}/g,\n        '{{getValue(\"$1\")}}');\n    }\n    if (value) {\n      value = _.template(value, valueTemplateSettings)(tpldata);\n    }\n  }\n\n  // TODO: handle on the formElement.options, because user can setup it too.\n  // Apply titleMap if needed\n  if (isSet(value) && formElement && hasOwnProperty(formElement.titleMap, value)) {\n    value = _.template(formElement.titleMap[value], valueTemplateSettings)(tpldata);\n  }\n\n  // Check maximum length of a string\n  if (value && _.isString(value) &&\n    schemaElement && schemaElement.maxLength) {\n    if (value.length > schemaElement.maxLength) {\n      // Truncate value to maximum length, adding continuation dots\n      value = value.substr(0, schemaElement.maxLength - 1) + '…';\n    }\n  }\n\n  if (!isSet(value)) {\n    return null;\n  }\n  else {\n    return value;\n  }\n};\n\n\n/**\n * Represents a node in the form.\n *\n * Nodes that have an ID are linked to the corresponding DOM element\n * when rendered\n *\n * Note the form element and the schema elements that gave birth to the\n * node may be shared among multiple nodes (in the case of arrays).\n *\n * @class\n */\nvar formNode = function () {\n  /**\n   * The node's ID (may not be set)\n   */\n  this.id = null;\n\n  /**\n   * The node's key path (may not be set)\n   */\n  this.key = null;\n\n  /**\n   * DOM element associated witht the form element.\n   *\n   * The DOM element is set when the form element is rendered.\n   */\n  this.el = null;\n\n  /**\n   * Link to the form element that describes the node's layout\n   * (note the form element is shared among nodes in arrays)\n   */\n  this.formElement = null;\n\n  /**\n   * Link to the schema element that describes the node's value constraints\n   * (note the schema element is shared among nodes in arrays)\n   */\n  this.schemaElement = null;\n\n  /**\n   * Pointer to the \"view\" associated with the node, typically the right\n   * object in jsonform.elementTypes\n   */\n  this.view = null;\n\n  /**\n   * Node's subtree (if one is defined)\n   */\n  this.children = [];\n\n  /**\n   * A pointer to the form tree the node is attached to\n   */\n  this.ownerTree = null;\n\n  /**\n   * A pointer to the parent node of the node in the tree\n   */\n  this.parentNode = null;\n\n  /**\n   * Child template for array-like nodes.\n   *\n   * The child template gets cloned to create new array items.\n   */\n  this.childTemplate = null;\n\n\n  /**\n   * Direct children of array-like containers may use the value of a\n   * specific input field in their subtree as legend. The link to the\n   * legend child is kept here and initialized in computeInitialValues\n   * when a child sets \"valueInLegend\"\n   */\n  this.legendChild = null;\n\n\n  /**\n   * The path of indexes that lead to the current node when the\n   * form element is not at the root array level.\n   *\n   * Note a form element may well be nested element and still be\n   * at the root array level. That's typically the case for \"fieldset\"\n   * elements. An array level only gets created when a form element\n   * is of type \"array\" (or a derivated type such as \"tabarray\").\n   *\n   * The array path of a form element linked to the foo[2].bar.baz[3].toto\n   * element in the submitted values is [2, 3] for instance.\n   *\n   * The array path is typically used to compute the right ID for input\n   * fields. It is also used to update positions when an array item is\n   * created, moved around or suppressed.\n   *\n   * @type {Array(Number)}\n   */\n  this.arrayPath = [];\n\n  /**\n   * Position of the node in the list of children of its parents\n   */\n  this.childPos = 0;\n};\n\n\n/**\n * Clones a node\n *\n * @function\n * @param {formNode} New parent node to attach the node to\n * @return {formNode} Cloned node\n */\nformNode.prototype.clone = function (parentNode) {\n  var node = new formNode();\n  node.arrayPath = _.clone(this.arrayPath);\n  node.ownerTree = this.ownerTree;\n  node.parentNode = parentNode || this.parentNode;\n  node.formElement = this.formElement;\n  node.schemaElement = this.schemaElement;\n  node.view = this.view;\n  node.children = _.map(this.children, function (child) {\n    return child.clone(node);\n  });\n  if (this.childTemplate) {\n    node.childTemplate = this.childTemplate.clone(node);\n  }\n  return node;\n};\n\n\n/**\n * Returns true if the subtree that starts at the current node\n * has some non empty value attached to it\n */\nformNode.prototype.hasNonDefaultValue = function () {\n\n  // hidden elements don't count because they could make the wrong selectfieldset element active\n  if (this.formElement && this.formElement.type==\"hidden\") {\n    return false;\n  }\n\n  if (this.value && !this.defaultValue) {\n    return true;\n  }\n  var child = _.find(this.children, function (child) {\n    return child.hasNonDefaultValue();\n  });\n  return !!child;\n};\n\n\n/**\n * Attaches a child node to the current node.\n *\n * The child node is appended to the end of the list.\n *\n * @function\n * @param {formNode} node The child node to append\n * @return {formNode} The inserted node (same as the one given as parameter)\n */\nformNode.prototype.appendChild = function (node) {\n  node.parentNode = this;\n  node.childPos = this.children.length;\n  this.children.push(node);\n  return node;\n};\n\n\n/**\n * Removes the last child of the node.\n *\n * @function\n */\nformNode.prototype.removeChild = function () {\n  var child = this.children[this.children.length-1];\n  if (!child) return;\n\n  // Remove the child from the DOM\n  $(child.el).remove();\n\n  // Remove the child from the array\n  return this.children.pop();\n};\n\n\n/**\n * Moves the user entered values set in the current node's subtree to the\n * given node's subtree.\n *\n * The target node must follow the same structure as the current node\n * (typically, they should have been generated from the same node template)\n *\n * The current node MUST be rendered in the DOM.\n *\n * TODO: when current node is not in the DOM, extract values from formNode.value\n * properties, so that the function be available even when current node is not\n * in the DOM.\n *\n * Moving values around allows to insert/remove array items at arbitrary\n * positions.\n *\n * @function\n * @param {formNode} node Target node.\n */\nformNode.prototype.moveValuesTo = function (node) {\n  var values = this.getFormValues(node.arrayPath);\n  node.resetValues();\n  node.computeInitialValues(values, true);\n};\n\n\n/**\n * Switches nodes user entered values.\n *\n * The target node must follow the same structure as the current node\n * (typically, they should have been generated from the same node template)\n *\n * Both nodes MUST be rendered in the DOM.\n *\n * TODO: update getFormValues to work even if node is not rendered, using\n * formNode's \"value\" property.\n *\n * @function\n * @param {formNode} node Target node\n */\nformNode.prototype.switchValuesWith = function (node) {\n  var values = this.getFormValues(node.arrayPath);\n  var nodeValues = node.getFormValues(this.arrayPath);\n  node.resetValues();\n  node.computeInitialValues(values, true);\n  this.resetValues();\n  this.computeInitialValues(nodeValues, true);\n};\n\n\n/**\n * Resets all DOM values in the node's subtree.\n *\n * This operation also drops all array item nodes.\n * Note values are not reset to their default values, they are rather removed!\n *\n * @function\n */\nformNode.prototype.resetValues = function () {\n  var params = null;\n  var idx = 0;\n\n  // Reset value\n  this.value = null;\n\n  // Propagate the array path from the parent node\n  // (adding the position of the child for nodes that are direct\n  // children of array-like nodes)\n  if (this.parentNode) {\n    this.arrayPath = _.clone(this.parentNode.arrayPath);\n    if (this.parentNode.view && this.parentNode.view.array) {\n      this.arrayPath.push(this.childPos);\n    }\n  }\n  else {\n    this.arrayPath = [];\n  }\n\n  if (this.view && this.view.inputfield) {\n    // Simple input field, extract the value from the origin,\n    // set the target value and reset the origin value\n    params = $(':input', this.el).serializeArray();\n    _.each(params, function (param) {\n      // TODO: check this, there may exist corner cases with this approach\n      // (with multiple checkboxes for instance)\n      $('[name=\"' + escapeSelector(param.name) + '\"]', $(this.el)).val('');\n    }, this);\n  }\n  else if (this.view && this.view.array) {\n    // The current node is an array, drop all children\n    while (this.children.length > 0) {\n      this.removeChild();\n    }\n  }\n\n  // Recurse down the tree\n  _.each(this.children, function (child) {\n    child.resetValues();\n  });\n};\n\n\n/**\n * Sets the child template node for the current node.\n *\n * The child template node is used to create additional children\n * in an array-like form element. The template is never rendered.\n *\n * @function\n * @param {formNode} node The child template node to set\n */\nformNode.prototype.setChildTemplate = function (node) {\n  this.childTemplate = node;\n  node.parentNode = this;\n};\n\n\n/**\n * Recursively sets values to all nodes of the current subtree\n * based on previously submitted values, or based on default\n * values when the submitted values are not enough\n *\n * The function should be called once in the lifetime of a node\n * in the tree. It expects its parent's arrayPath to be up to date.\n *\n * Three cases may arise:\n * 1. if the form element is a simple input field, the value is\n * extracted from previously submitted values of from default values\n * defined in the schema.\n * 2. if the form element is an array-like node, the child template\n * is used to create as many children as possible (and at least one).\n * 3. the function simply recurses down the node's subtree otherwise\n * (this happens when the form element is a fieldset-like element).\n *\n * @function\n * @param {Object} values Previously submitted values for the form\n * @param {Boolean} ignoreDefaultValues Ignore default values defined in the\n *  schema when set.\n */\nformNode.prototype.computeInitialValues = function (values, ignoreDefaultValues) {\n  var self = this;\n  var node = null;\n  var nbChildren = 1;\n  var i = 0;\n  var formData = this.ownerTree.formDesc.tpldata || {};\n\n  // Propagate the array path from the parent node\n  // (adding the position of the child for nodes that are direct\n  // children of array-like nodes)\n  if (this.parentNode) {\n    this.arrayPath = _.clone(this.parentNode.arrayPath);\n    if (this.parentNode.view && this.parentNode.view.array) {\n      this.arrayPath.push(this.childPos);\n    }\n  }\n  else {\n    this.arrayPath = [];\n  }\n\n  // Prepare special data param \"idx\" for templated values\n  // (is is the index of the child in its wrapping array, starting\n  // at 1 since that's more human-friendly than a zero-based index)\n  formData.idx = (this.arrayPath.length > 0) ?\n    this.arrayPath[this.arrayPath.length-1] + 1 :\n    this.childPos + 1;\n\n  // Prepare special data param \"value\" for templated values\n  formData.value = '';\n\n  // Prepare special function to compute the value of another field\n  formData.getValue = function (key) {\n    if (!values) {\n      return '';\n    }\n    var returnValue = values;\n    var listKey = key.split('[].');\n    var i;\n    for (i = 0; i < listKey.length - 1; i++) {\n      returnValue = returnValue[listKey[i]][self.arrayPath[i]];\n    }\n    return returnValue[listKey[i]];\n  };\n\n  if (this.formElement) {\n    // Compute the ID of the field (if needed)\n    if (this.formElement.id) {\n      this.id = applyArrayPath(this.formElement.id, this.arrayPath);\n    }\n    else if (this.view && this.view.array) {\n      this.id = escapeSelector(this.ownerTree.formDesc.prefix) +\n        '-elt-counter-' + _.uniqueId();\n    }\n    else if (this.parentNode && this.parentNode.view &&\n      this.parentNode.view.array) {\n      // Array items need an array to associate the right DOM element\n      // to the form node when the parent is rendered.\n      this.id = escapeSelector(this.ownerTree.formDesc.prefix) +\n        '-elt-counter-' + _.uniqueId();\n    }\n    else if ((this.formElement.type === 'button') ||\n      (this.formElement.type === 'selectfieldset') ||\n      (this.formElement.type === 'question') ||\n      (this.formElement.type === 'buttonquestion')) {\n      // Buttons do need an id for \"onClick\" purpose\n      this.id = escapeSelector(this.ownerTree.formDesc.prefix) +\n        '-elt-counter-' + _.uniqueId();\n    }\n\n    // Compute the actual key (the form element's key is index-free,\n    // i.e. it looks like foo[].bar.baz[].truc, so we need to apply\n    // the array path of the node to get foo[4].bar.baz[2].truc)\n    if (this.formElement.key) {\n      this.key = applyArrayPath(this.formElement.key, this.arrayPath);\n      this.keydash = slugify(this.key.replace(/\\./g, '---'));\n    }\n\n    // Same idea for the field's name\n    this.name = applyArrayPath(this.formElement.name, this.arrayPath);\n\n    // Consider that label values are template values and apply the\n    // form's data appropriately (note we also apply the array path\n    // although that probably doesn't make much sense for labels...)\n    _.each([\n      'title',\n      'legend',\n      'description',\n      'append',\n      'prepend',\n      'inlinetitle',\n      'helpvalue',\n      'value',\n      'disabled',\n      'placeholder',\n      'readOnly'\n    ], function (prop) {\n      if (_.isString(this.formElement[prop])) {\n        if (this.formElement[prop].indexOf('{{values.') !== -1) {\n          // This label wants to use the value of another input field.\n          // Convert that construct into {{jsonform.getValue(key)}} for\n          // Underscore to call the appropriate function of formData\n          // when template gets called (note calling a function is not\n          // exactly Mustache-friendly but is supported by Underscore).\n          this[prop] = this.formElement[prop].replace(\n            /\\{\\{values\\.([^\\}]+)\\}\\}/g,\n            '{{getValue(\"$1\")}}');\n        }\n        else {\n          // Note applying the array path probably doesn't make any sense,\n          // but some geek might want to have a label \"foo[].bar[].baz\",\n          // with the [] replaced by the appropriate array path.\n          this[prop] = applyArrayPath(this.formElement[prop], this.arrayPath);\n        }\n        if (this[prop]) {\n          this[prop] = _.template(this[prop], valueTemplateSettings)(formData);\n        }\n      }\n      else {\n        this[prop] = this.formElement[prop];\n      }\n    }, this);\n\n    // Apply templating to options created with \"titleMap\" as well\n    if (this.formElement.options) {\n      this.options = _.map(this.formElement.options, function (option) {\n        var title = null;\n        if (_.isObject(option) && option.title) {\n          // See a few lines above for more details about templating\n          // preparation here.\n          if (option.title.indexOf('{{values.') !== -1) {\n            title = option.title.replace(\n              /\\{\\{values\\.([^\\}]+)\\}\\}/g,\n              '{{getValue(\"$1\")}}');\n          }\n          else {\n            title = applyArrayPath(option.title, self.arrayPath);\n          }\n          return _.extend({}, option, {\n            value: (isSet(option.value) ? option.value : ''),\n            title: _.template(title, valueTemplateSettings)(formData)\n          });\n        }\n        else {\n          return option;\n        }\n      });\n    }\n  }\n\n  if (this.view && this.view.inputfield && this.schemaElement) {\n    // Case 1: simple input field\n    if (values) {\n      // Form has already been submitted, use former value if defined.\n      // Note we won't set the field to its default value otherwise\n      // (since the user has already rejected it)\n      if (isSet(jsonform.util.getObjKey(values, this.key))) {\n        this.value = jsonform.util.getObjKey(values, this.key);\n      } else if (isSet(this.schemaElement['default'])) {\n        // the value is not provided in the values section but the\n        // default is set in the schemaElement (which we have)\n        this.value = this.schemaElement['default']\n        // We only apply a template if it's a string\n        if (typeof this.value === 'string') {\n          this.value = _.template(this.value, valueTemplateSettings)(formData);\n        }\n\n      }\n    }\n    else if (!ignoreDefaultValues) {\n      // No previously submitted form result, use default value\n      // defined in the schema if it's available and not already\n      // defined in the form element\n      if (!isSet(this.value) && isSet(this.schemaElement['default'])) {\n        this.value = this.schemaElement['default'];\n        if (_.isString(this.value)) {\n          if (this.value.indexOf('{{values.') !== -1) {\n            // This label wants to use the value of another input field.\n            // Convert that construct into {{jsonform.getValue(key)}} for\n            // Underscore to call the appropriate function of formData\n            // when template gets called (note calling a function is not\n            // exactly Mustache-friendly but is supported by Underscore).\n            this.value = this.value.replace(\n              /\\{\\{values\\.([^\\}]+)\\}\\}/g,\n              '{{getValue(\"$1\")}}');\n          }\n          else {\n            // Note applying the array path probably doesn't make any sense,\n            // but some geek might want to have a label \"foo[].bar[].baz\",\n            // with the [] replaced by the appropriate array path.\n            this.value = applyArrayPath(this.value, this.arrayPath);\n          }\n          if (this.value) {\n            this.value = _.template(this.value, valueTemplateSettings)(formData);\n          }\n        }\n        this.defaultValue = true;\n      }\n    }\n  }\n  else if (this.view && this.view.array) {\n    // Case 2: array-like node\n    nbChildren = 0;\n    if (values) {\n      nbChildren = this.getPreviousNumberOfItems(values, this.arrayPath);\n    }\n    // TODO: use default values at the array level when form has not been\n    // submitted before. Note it's not that easy because each value may\n    // be a complex structure that needs to be pushed down the subtree.\n    // The easiest way is probably to generate a \"values\" object and\n    // compute initial values from that object\n    /*\n    else if (this.schemaElement['default']) {\n      nbChildren = this.schemaElement['default'].length;\n    }\n    */\n    else if (nbChildren === 0) {\n      // If form has already been submitted with no children, the array\n      // needs to be rendered without children. If there are no previously\n      // submitted values, the array gets rendered with one empty item as\n      // it's more natural from a user experience perspective. That item can\n      // be removed with a click on the \"-\" button.\n      nbChildren = 1;\n    }\n    for (i = 0; i < nbChildren; i++) {\n      this.appendChild(this.childTemplate.clone());\n    }\n  }\n\n  // Case 3 and in any case: recurse through the list of children\n  _.each(this.children, function (child) {\n    child.computeInitialValues(values, ignoreDefaultValues);\n  });\n\n  // If the node's value is to be used as legend for its \"container\"\n  // (typically the array the node belongs to), ensure that the container\n  // has a direct link to the node for the corresponding tab.\n  if (this.formElement && this.formElement.valueInLegend) {\n    node = this;\n    while (node) {\n      if (node.parentNode &&\n        node.parentNode.view &&\n        node.parentNode.view.array) {\n        node.legendChild = this;\n        if (node.formElement && node.formElement.legend) {\n          node.legend = applyArrayPath(node.formElement.legend, node.arrayPath);\n          formData.idx = (node.arrayPath.length > 0) ?\n            node.arrayPath[node.arrayPath.length-1] + 1 :\n            node.childPos + 1;\n          formData.value = isSet(this.value) ? this.value : '';\n          node.legend = _.template(node.legend, valueTemplateSettings)(formData);\n          break;\n        }\n      }\n      node = node.parentNode;\n    }\n  }\n};\n\n\n/**\n * Returns the number of items that the array node should have based on\n * previously submitted values.\n *\n * The whole difficulty is that values may be hidden deep in the subtree\n * of the node and may actually target different arrays in the JSON schema.\n *\n * @function\n * @param {Object} values Previously submitted values\n * @param {Array(Number)} arrayPath the array path we're interested in\n * @return {Number} The number of items in the array\n */\nformNode.prototype.getPreviousNumberOfItems = function (values, arrayPath) {\n  var key = null;\n  var arrayValue = null;\n  var childNumbers = null;\n  var idx = 0;\n\n  if (!values) {\n    // No previously submitted values, no need to go any further\n    return 0;\n  }\n\n  if (this.view.inputfield && this.schemaElement) {\n    // Case 1: node is a simple input field that links to a key in the schema.\n    // The schema key looks typically like:\n    //  foo.bar[].baz.toto[].truc[].bidule\n    // The goal is to apply the array path and truncate the key to the last\n    // array we're interested in, e.g. with an arrayPath [4, 2]:\n    //  foo.bar[4].baz.toto[2]\n    key = truncateToArrayDepth(this.formElement.key, arrayPath.length);\n    key = applyArrayPath(key, arrayPath);\n    arrayValue = jsonform.util.getObjKey(values, key);\n    if (!arrayValue) {\n      // No key? That means this field had been left empty\n      // in previous submit\n      return 0;\n    }\n    childNumbers = _.map(this.children, function (child) {\n      return child.getPreviousNumberOfItems(values, arrayPath);\n    });\n    return _.max([_.max(childNumbers) || 0, arrayValue.length]);\n  }\n  else if (this.view.array) {\n    // Case 2: node is an array-like node, look for input fields\n    // in its child template\n    return this.childTemplate.getPreviousNumberOfItems(values, arrayPath);\n  }\n  else {\n    // Case 3: node is a leaf or a container,\n    // recurse through the list of children and return the maximum\n    // number of items found in each subtree\n    childNumbers = _.map(this.children, function (child) {\n      return child.getPreviousNumberOfItems(values, arrayPath);\n    });\n    return _.max(childNumbers) || 0;\n  }\n};\n\n\n/**\n * Returns the structured object that corresponds to the form values entered\n * by the user for the node's subtree.\n *\n * The returned object follows the structure of the JSON schema that gave\n * birth to the form.\n *\n * Obviously, the node must have been rendered before that function may\n * be called.\n *\n * @function\n * @param {Array(Number)} updateArrayPath Array path to use to pretend that\n *  the entered values were actually entered for another item in an array\n *  (this is used to move values around when an item is inserted/removed/moved\n *  in an array)\n * @return {Object} The object that follows the data schema and matches the\n *  values entered by the user.\n */\nformNode.prototype.getFormValues = function (updateArrayPath) {\n  // The values object that will be returned\n  var values = {};\n\n  if (!this.el) {\n    throw new Error('formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree');\n  }\n\n  // Form fields values\n  var formArray = $(':input', this.el).serializeArray();\n\n  // Set values to false for unset checkboxes and radio buttons\n  // because serializeArray() ignores them\n  formArray = formArray.concat(\n    $(':input[type=checkbox]:not(:disabled):not(:checked)', this.el).map( function() {\n      return {\"name\": this.name, \"value\": this.checked}\n    }).get()\n  );\n\n  if (updateArrayPath) {\n    _.each(formArray, function (param) {\n      param.name = applyArrayPath(param.name, updateArrayPath);\n    });\n  }\n\n  // The underlying data schema\n  var formSchema = this.ownerTree.formDesc.schema;\n\n  for (var i = 0; i < formArray.length; i++) {\n    // Retrieve the key definition from the data schema\n    var name = formArray[i].name;\n    var eltSchema = getSchemaKey(formSchema.properties, name);\n    var arrayMatch = null;\n    var cval = null;\n\n    // Skip the input field if it's not part of the schema\n    if (!eltSchema) continue;\n\n    // Handle multiple checkboxes separately as the idea is to generate\n    // an array that contains the list of enumeration items that the user\n    // selected.\n    if (eltSchema._jsonform_checkboxes_as_array) {\n      arrayMatch = name.match(/\\[([0-9]*)\\]$/);\n      if (arrayMatch) {\n        name = name.replace(/\\[([0-9]*)\\]$/, '');\n        cval = jsonform.util.getObjKey(values, name) || [];\n        if (formArray[i].value === '1') {\n          // Value selected, push the corresponding enumeration item\n          // to the data result\n          cval.push(eltSchema['enum'][parseInt(arrayMatch[1],10)]);\n        }\n        jsonform.util.setObjKey(values, name, cval);\n        continue;\n      }\n    }\n\n    // Type casting\n    if (eltSchema.type === 'boolean') {\n      if (formArray[i].value === '0') {\n        formArray[i].value = false;\n      } else {\n        formArray[i].value = !!formArray[i].value;\n      }\n    }\n    if ((eltSchema.type === 'number') ||\n      (eltSchema.type === 'integer')) {\n      if (_.isString(formArray[i].value)) {\n        if (!formArray[i].value.length) {\n          formArray[i].value = null;\n        } else if (!isNaN(Number(formArray[i].value))) {\n          formArray[i].value = Number(formArray[i].value);\n        }\n      }\n    }\n    if ((eltSchema.type === 'string') &&\n      (formArray[i].value === '') &&\n      !eltSchema._jsonform_allowEmpty) {\n      formArray[i].value=null;\n    }\n    if ((eltSchema.type === 'object') &&\n      _.isString(formArray[i].value) &&\n      (formArray[i].value.substring(0,1) === '{')) {\n      try {\n        formArray[i].value = JSON.parse(formArray[i].value);\n      } catch (e) {\n        formArray[i].value = {};\n      }\n    }\n    //TODO: is this due to a serialization bug?\n    if ((eltSchema.type === 'object') &&\n      (formArray[i].value === 'null' || formArray[i].value === '')) {\n      formArray[i].value = null;\n    }\n\n    if (formArray[i].name && (formArray[i].value !== null)) {\n      jsonform.util.setObjKey(values, formArray[i].name, formArray[i].value);\n    }\n  }\n  return values;\n};\n\n\n\n/**\n * Renders the node.\n *\n * Rendering is done in three steps: HTML generation, DOM element creation\n * and insertion, and an enhance step to bind event handlers.\n *\n * @function\n * @param {Node} el The DOM element where the node is to be rendered. The\n *  node is inserted at the right position based on its \"childPos\" property.\n */\nformNode.prototype.render = function (el) {\n  var html = this.generate();\n  this.setContent(html, el);\n  this.enhance();\n};\n\n\n/**\n * Inserts/Updates the HTML content of the node in the DOM.\n *\n * If the HTML is an update, the new HTML content replaces the old one.\n * The new HTML content is not moved around in the DOM in particular.\n *\n * The HTML is inserted at the right position in its parent's DOM subtree\n * otherwise (well, provided there are enough children, but that should always\n * be the case).\n *\n * @function\n * @param {string} html The HTML content to render\n * @param {Node} parentEl The DOM element that is to contain the DOM node.\n *  This parameter is optional (the node's parent is used otherwise) and\n *  is ignored if the node to render is already in the DOM tree.\n */\nformNode.prototype.setContent = function (html, parentEl) {\n  var node = $(html);\n  var parentNode = parentEl ||\n    (this.parentNode ? this.parentNode.el : this.ownerTree.domRoot);\n  var nextSibling = null;\n\n  if (this.el) {\n    // Replace the contents of the DOM element if the node is already in the tree\n    $(this.el).replaceWith(node);\n  }\n  else {\n    // Insert the node in the DOM if it's not already there\n    nextSibling = $(parentNode).children().get(this.childPos);\n    if (nextSibling) {\n      $(nextSibling).before(node);\n    }\n    else {\n      $(parentNode).append(node);\n    }\n  }\n\n  // Save the link between the form node and the generated HTML\n  this.el = node;\n\n  // Update the node's subtree, extracting DOM elements that match the nodes\n  // from the generated HTML\n  this.updateElement(this.el);\n};\n\n\n/**\n * Updates the DOM element associated with the node.\n *\n * Only nodes that have ID are directly associated with a DOM element.\n *\n * @function\n */\nformNode.prototype.updateElement = function (domNode) {\n  if (this.id) {\n    this.el = $('#' + escapeSelector(this.id), domNode).get(0);\n    if (this.view && this.view.getElement) {\n      this.el = this.view.getElement(this.el);\n    }\n    if ((this.fieldtemplate !== false) &&\n      this.view && this.view.fieldtemplate) {\n      // The field template wraps the element two or three level deep\n      // in the DOM tree, depending on whether there is anything prepended\n      // or appended to the input field\n      this.el = $(this.el).parent().parent();\n      if (this.prepend || this.prepend) {\n        this.el = this.el.parent();\n      }\n      this.el = this.el.get(0);\n    }\n    if (this.parentNode && this.parentNode.view &&\n      this.parentNode.view.childTemplate) {\n      // TODO: the child template may introduce more than one level,\n      // so the number of levels introduced should rather be exposed\n      // somehow in jsonform.fieldtemplate.\n      this.el = $(this.el).parent().get(0);\n    }\n  }\n\n  for (const k in  this.children) {\n     if (this.children.hasOwnProperty(k) == false) {\n         continue;\n     }\n     this.children[k].updateElement(this.el || domNode);\n }\n};\n\n\n/**\n * Generates the view's HTML content for the underlying model.\n *\n * @function\n */\nformNode.prototype.generate = function () {\n  var data = {\n    id: this.id,\n    keydash: this.keydash,\n    elt: this.formElement,\n    schema: this.schemaElement,\n    node: this,\n    value: isSet(this.value) ? this.value : '',\n    escape: escapeHTML\n  };\n  var template = null;\n  var html = '';\n\n  // Complete the data context if needed\n  if (this.ownerTree.formDesc.onBeforeRender) {\n    this.ownerTree.formDesc.onBeforeRender(data, this);\n  }\n  if (this.view.onBeforeRender) {\n    this.view.onBeforeRender(data, this);\n  }\n\n  // Use the template that 'onBeforeRender' may have set,\n  // falling back to that of the form element otherwise\n  if (this.template) {\n    template = this.template;\n  }\n  else if (this.formElement && this.formElement.template) {\n    template = this.formElement.template;\n  }\n  else {\n    template = this.view.template;\n  }\n\n  // Wrap the view template in the generic field template\n  // (note the strict equality to 'false', needed as we fallback\n  // to the view's setting otherwise)\n  if ((this.fieldtemplate !== false) &&\n    (this.fieldtemplate || this.view.fieldtemplate)) {\n    template = jsonform.fieldTemplate(template);\n  }\n\n  // Wrap the content in the child template of its parent if necessary.\n  if (this.parentNode && this.parentNode.view &&\n    this.parentNode.view.childTemplate) {\n    // only allow drag of children if default or enabled\n    template = this.parentNode.view.childTemplate(template, (!isSet(this.parentNode.formElement.draggable) ? true : this.parentNode.formElement.draggable));\n  }\n\n  // Prepare the HTML of the children\n  var childrenhtml = '';\n  _.each(this.children, function (child) {\n    childrenhtml += child.generate();\n  });\n  data.children = childrenhtml;\n\n  data.fieldHtmlClass = '';\n  if (this.ownerTree &&\n      this.ownerTree.formDesc &&\n      this.ownerTree.formDesc.params &&\n      this.ownerTree.formDesc.params.fieldHtmlClass) {\n    data.fieldHtmlClass = this.ownerTree.formDesc.params.fieldHtmlClass;\n  }\n  if (this.formElement &&\n      (typeof this.formElement.fieldHtmlClass !== 'undefined')) {\n    data.fieldHtmlClass = this.formElement.fieldHtmlClass;\n  }\n\n  // Apply the HTML template\n  html = _.template(template, fieldTemplateSettings)(data);\n  return html;\n};\n\n\n/**\n * Enhances the view with additional logic, binding event handlers\n * in particular.\n *\n * The function also runs the \"insert\" event handler of the view and\n * form element if they exist (starting with that of the view)\n *\n * @function\n */\nformNode.prototype.enhance = function () {\n  var node = this;\n  var handlers = null;\n  var handler = null;\n  var formData = _.clone(this.ownerTree.formDesc.tpldata) || {};\n\n  if (this.formElement) {\n    // Check the view associated with the node as it may define an \"onInsert\"\n    // event handler to be run right away\n    if (this.view.onInsert) {\n      this.view.onInsert({ target: $(this.el) }, this);\n    }\n\n    handlers = this.handlers || this.formElement.handlers;\n\n    // Trigger the \"insert\" event handler\n    handler = this.onInsert || this.formElement.onInsert;\n    if (handler) {\n      handler({ target: $(this.el) }, this);\n    }\n    if (handlers) {\n      _.each(handlers, function (handler, onevent) {\n        if (onevent === 'insert') {\n          handler({ target: $(this.el) }, this);\n        }\n      }, this);\n    }\n\n    // No way to register event handlers if the DOM element is unknown\n    // TODO: find some way to register event handlers even when this.el is not set.\n    if (this.el) {\n\n      // Register specific event handlers\n      // TODO: Add support for other event handlers\n      if (this.onChange)\n        $(this.el).bind('change', function(evt) { node.onChange(evt, node); });\n      if (this.view.onChange)\n        $(this.el).bind('change', function(evt) { node.view.onChange(evt, node); });\n      if (this.formElement.onChange)\n        $(this.el).bind('change', function(evt) { node.formElement.onChange(evt, node); });\n\n      if (this.onInput)\n        $(this.el).bind('input', function(evt) { node.onInput(evt, node); });\n      if (this.view.onInput)\n        $(this.el).bind('input', function(evt) { node.view.onInput(evt, node); });\n      if (this.formElement.onInput)\n        $(this.el).bind('input', function(evt) { node.formElement.onInput(evt, node); });\n\n      if (this.onClick)\n        $(this.el).bind('click', function(evt) { node.onClick(evt, node); });\n      if (this.view.onClick)\n        $(this.el).bind('click', function(evt) { node.view.onClick(evt, node); });\n      if (this.formElement.onClick)\n        $(this.el).bind('click', function(evt) { node.formElement.onClick(evt, node); });\n\n      if (this.onKeyUp)\n        $(this.el).bind('keyup', function(evt) { node.onKeyUp(evt, node); });\n      if (this.view.onKeyUp)\n        $(this.el).bind('keyup', function(evt) { node.view.onKeyUp(evt, node); });\n      if (this.formElement.onKeyUp)\n        $(this.el).bind('keyup', function(evt) { node.formElement.onKeyUp(evt, node); });\n\n      if (handlers) {\n        _.each(handlers, function (handler, onevent) {\n          if (onevent !== 'insert') {\n            $(this.el).bind(onevent, function(evt) { handler(evt, node); });\n          }\n        }, this);\n      }\n    }\n\n    // Auto-update legend based on the input field that's associated with it\n    if (this.legendChild && this.legendChild.formElement) {\n      var onChangeHandler = function (evt) {\n        if (node.formElement && node.formElement.legend && node.parentNode) {\n          node.legend = applyArrayPath(node.formElement.legend, node.arrayPath);\n          formData.idx = (node.arrayPath.length > 0) ?\n              node.arrayPath[node.arrayPath.length - 1] + 1 :\n              node.childPos + 1;\n          formData.value = $(evt.target).val();\n          node.legend = _.template(node.legend, valueTemplateSettings)(formData);\n          $(node.parentNode.el).trigger('legendUpdated');\n        }\n      };\n      $(this.legendChild.el).bind('change', onChangeHandler);\n      $(this.legendChild.el).bind('keyup', onChangeHandler);\n    }\n  }\n\n  // Recurse down the tree to enhance children\n  _.each(this.children, function (child) {\n    child.enhance();\n  });\n};\n\n\n\n/**\n * Inserts an item in the array at the requested position and renders the item.\n *\n * @function\n * @param {Number} idx Insertion index\n */\nformNode.prototype.insertArrayItem = function (idx, domElement) {\n  var i = 0;\n\n  // Insert element at the end of the array if index is not given\n  if (idx === undefined) {\n    idx = this.children.length;\n  }\n\n  // Create the additional array item at the end of the list,\n  // using the item template created when tree was initialized\n  // (the call to resetValues ensures that 'arrayPath' is correctly set)\n  var child = this.childTemplate.clone();\n  this.appendChild(child);\n  child.resetValues();\n\n  // To create a blank array item at the requested position,\n  // shift values down starting at the requested position\n  // one to insert (note we start with the end of the array on purpose)\n  for (i = this.children.length-2; i >= idx; i--) {\n    this.children[i].moveValuesTo(this.children[i+1]);\n  }\n\n  // Initialize the blank node we've created with default values\n  this.children[idx].resetValues();\n  this.children[idx].computeInitialValues();\n\n  // Re-render all children that have changed\n  for (i = idx; i < this.children.length; i++) {\n    this.children[i].render(domElement);\n  }\n};\n\n\n/**\n * Remove an item from an array\n *\n * @function\n * @param {Number} idx The index number of the item to remove\n */\nformNode.prototype.deleteArrayItem = function (idx) {\n  var i = 0;\n  var child = null;\n\n  // Delete last item if no index is given\n  if (idx === undefined) {\n    idx = this.children.length - 1;\n  }\n\n  // Move values up in the array\n  for (i = idx; i < this.children.length-1; i++) {\n    this.children[i+1].moveValuesTo(this.children[i]);\n    this.children[i].render();\n  }\n\n  // Remove the last array item from the DOM tree and from the form tree\n  this.removeChild();\n};\n\n/**\n * Returns the minimum/maximum number of items that an array field\n * is allowed to have according to the schema definition of the fields\n * it contains.\n *\n * The function parses the schema definitions of the array items that\n * compose the current \"array\" node and returns the minimum value of\n * \"maxItems\" it encounters as the maximum number of items, and the\n * maximum value of \"minItems\" as the minimum number of items.\n *\n * The function reports a -1 for either of the boundaries if the schema\n * does not put any constraint on the number of elements the current\n * array may have of if the current node is not an array.\n *\n * Note that array boundaries should be defined in the JSON Schema using\n * \"minItems\" and \"maxItems\". The code also supports \"minLength\" and\n * \"maxLength\" as a fallback, mostly because it used to by mistake (see #22)\n * and because other people could make the same mistake.\n *\n * @function\n * @return {Object} An object with properties \"minItems\" and \"maxItems\"\n *  that reports the corresponding number of items that the array may\n *  have (value is -1 when there is no constraint for that boundary)\n */\nformNode.prototype.getArrayBoundaries = function () {\n  var boundaries = {\n    minItems: -1,\n    maxItems: -1\n  };\n  if (!this.view || !this.view.array) return boundaries;\n\n  var getNodeBoundaries = function (node, initialNode) {\n    var schemaKey = null;\n    var arrayKey = null;\n    var boundaries = {\n      minItems: -1,\n      maxItems: -1\n    };\n    initialNode = initialNode || node;\n\n    if (node.view && node.view.array && (node !== initialNode)) {\n      // New array level not linked to an array in the schema,\n      // so no size constraints\n      return boundaries;\n    }\n\n    if (node.key) {\n      // Note the conversion to target the actual array definition in the\n      // schema where minItems/maxItems may be defined. If we're still looking\n      // at the initial node, the goal is to convert from:\n      //  foo[0].bar[3].baz to foo[].bar[].baz\n      // If we're not looking at the initial node, the goal is to look at the\n      // closest array parent:\n      //  foo[0].bar[3].baz to foo[].bar\n      arrayKey = node.key.replace(/\\[[0-9]+\\]/g, '[]');\n      if (node !== initialNode) {\n        arrayKey = arrayKey.replace(/\\[\\][^\\[\\]]*$/, '');\n      }\n      schemaKey = getSchemaKey(\n        node.ownerTree.formDesc.schema.properties,\n        arrayKey\n      );\n      if (!schemaKey) return boundaries;\n      return {\n        minItems: schemaKey.minItems || schemaKey.minLength || -1,\n        maxItems: schemaKey.maxItems || schemaKey.maxLength || -1\n      };\n    }\n    else {\n      _.each(node.children, function (child) {\n        var subBoundaries = getNodeBoundaries(child, initialNode);\n        if (subBoundaries.minItems !== -1) {\n          if (boundaries.minItems !== -1) {\n            boundaries.minItems = Math.max(\n              boundaries.minItems,\n              subBoundaries.minItems\n            );\n          }\n          else {\n            boundaries.minItems = subBoundaries.minItems;\n          }\n        }\n        if (subBoundaries.maxItems !== -1) {\n          if (boundaries.maxItems !== -1) {\n            boundaries.maxItems = Math.min(\n              boundaries.maxItems,\n              subBoundaries.maxItems\n            );\n          }\n          else {\n            boundaries.maxItems = subBoundaries.maxItems;\n          }\n        }\n      });\n    }\n    return boundaries;\n  };\n  return getNodeBoundaries(this);\n};\n\n\n/**\n * Form tree class.\n *\n * Holds the internal representation of the form.\n * The tree is always in sync with the rendered form, this allows to parse\n * it easily.\n *\n * @class\n */\nvar formTree = function () {\n  this.eventhandlers = [];\n  this.root = null;\n  this.formDesc = null;\n};\n\n/**\n * Initializes the form tree structure from the JSONForm object\n *\n * This function is the main entry point of the JSONForm library.\n *\n * Initialization steps:\n * 1. the internal tree structure that matches the JSONForm object\n *  gets created (call to buildTree)\n * 2. initial values are computed from previously submitted values\n *  or from the default values defined in the JSON schema.\n *\n * When the function returns, the tree is ready to be rendered through\n * a call to \"render\".\n *\n * @function\n */\nformTree.prototype.initialize = function (formDesc) {\n  formDesc = formDesc || {};\n\n  // Keep a pointer to the initial JSONForm\n  // (note clone returns a shallow copy, only first-level is cloned)\n  this.formDesc = _.clone(formDesc);\n\n  // Compute form prefix if no prefix is given.\n  this.formDesc.prefix = this.formDesc.prefix ||\n    'jsonform-' + _.uniqueId();\n\n  // JSON schema shorthand\n  if (this.formDesc.schema && !this.formDesc.schema.properties) {\n    this.formDesc.schema = {\n      properties: this.formDesc.schema\n    };\n  }\n\n  // Ensure layout is set\n  this.formDesc.form = this.formDesc.form || [\n    '*',\n    {\n      type: 'actions',\n      items: [\n        {\n          type: 'submit',\n          value: 'Submit'\n        }\n      ]\n    }\n  ];\n  this.formDesc.form = (_.isArray(this.formDesc.form) ?\n    this.formDesc.form :\n    [this.formDesc.form]);\n\n  this.formDesc.params = this.formDesc.params || {};\n\n  // Create the root of the tree\n  this.root = new formNode();\n  this.root.ownerTree = this;\n  this.root.view = jsonform.elementTypes['root'];\n\n  // Generate the tree from the form description\n  this.buildTree();\n\n  // Compute the values associated with each node\n  // (for arrays, the computation actually creates the form nodes)\n  this.computeInitialValues();\n};\n\n\n/**\n * Constructs the tree from the form description.\n *\n * The function must be called once when the tree is first created.\n *\n * @function\n */\nformTree.prototype.buildTree = function () {\n  // Parse and generate the form structure based on the elements encountered:\n  // - '*' means \"generate all possible fields using default layout\"\n  // - a key reference to target a specific data element\n  // - a more complex object to generate specific form sections\n  _.each(this.formDesc.form, function (formElement) {\n    if (formElement === '*') {\n      _.each(this.formDesc.schema.properties, function (element, key) {\n        this.root.appendChild(this.buildFromLayout({\n          key: key\n        }));\n      }, this);\n    }\n    else {\n      if (_.isString(formElement)) {\n        formElement = {\n          key: formElement\n        };\n      }\n      this.root.appendChild(this.buildFromLayout(formElement));\n    }\n  }, this);\n};\n\n\n/**\n * Builds the internal form tree representation from the requested layout.\n *\n * The function is recursive, generating the node children as necessary.\n * The function extracts the values from the previously submitted values\n * (this.formDesc.value) or from default values defined in the schema.\n *\n * @function\n * @param {Object} formElement JSONForm element to render\n * @param {Object} context The parsing context (the array depth in particular)\n * @return {Object} The node that matches the element.\n */\nformTree.prototype.buildFromLayout = function (formElement, context) {\n  var schemaElement = null;\n  var node = new formNode();\n  var view = null;\n  var key = null;\n\n  // The form element parameter directly comes from the initial\n  // JSONForm object. We'll make a shallow copy of it and of its children\n  // not to pollute the original object.\n  // (note JSON.parse(JSON.stringify()) cannot be used since there may be\n  // event handlers in there!)\n  formElement = _.clone(formElement);\n  if (formElement.items) {\n    if (_.isArray(formElement.items)) {\n      formElement.items = _.map(formElement.items, _.clone);\n    }\n    else {\n      formElement.items = [ _.clone(formElement.items) ];\n    }\n  }\n\n  if (formElement.key) {\n    // The form element is directly linked to an element in the JSON\n    // schema. The properties of the form element override those of the\n    // element in the JSON schema. Properties from the JSON schema complete\n    // those of the form element otherwise.\n\n    // Retrieve the element from the JSON schema\n    schemaElement = getSchemaKey(\n      this.formDesc.schema.properties,\n      formElement.key);\n    if (!schemaElement) {\n      // The JSON Form is invalid!\n      throw new Error('The JSONForm object references the schema key \"' +\n        formElement.key + '\" but that key does not exist in the JSON schema');\n    }\n\n    // Schema element has just been found, let's trigger the\n    // \"onElementSchema\" event\n    // (tidoust: not sure what the use case for this is, keeping the\n    // code for backward compatibility)\n    if (this.formDesc.onElementSchema) {\n      this.formDesc.onElementSchema(formElement, schemaElement);\n    }\n\n    formElement.name =\n      formElement.name ||\n      formElement.key;\n    formElement.title =\n      formElement.title ||\n      schemaElement.title;\n    formElement.description =\n      formElement.description ||\n      schemaElement.description;\n    formElement.readOnly =\n      formElement.readOnly ||\n      schemaElement.readOnly ||\n      formElement.readonly ||\n      schemaElement.readonly;\n\n    // Compute the ID of the input field\n    if (!formElement.id) {\n      formElement.id = escapeSelector(this.formDesc.prefix) +\n        '-elt-' + slugify(formElement.key);\n    }\n\n    // Should empty strings be included in the final value?\n    // TODO: it's rather unclean to pass it through the schema.\n    if (formElement.allowEmpty) {\n      schemaElement._jsonform_allowEmpty = true;\n    }\n\n    // If the form element does not define its type, use the type of\n    // the schema element.\n    if (!formElement.type) {\n      // If schema type is an array containing only a type and \"null\",\n      // remove null and make the element non-required\n      if (_.isArray(schemaElement.type)) {\n        if (_.contains(schemaElement.type, \"null\")) {\n          schemaElement.type = _.without(schemaElement.type, \"null\");\n          schemaElement.required = false;\n        }\n        if (schemaElement.type.length > 1) {\n          throw new Error(\"Cannot process schema element with multiple types.\");\n        }\n        schemaElement.type = _.first(schemaElement.type);\n      }\n\n      if ((schemaElement.type === 'string') &&\n        (schemaElement.format === 'color')) {\n        formElement.type = 'color';\n      } else if ((schemaElement.type === 'number' ||\n        schemaElement.type === 'integer') &&\n        !schemaElement['enum']) {\n       formElement.type = 'number';\n       if (schemaElement.type === 'number') schemaElement.step = 'any';\n      } else if ((schemaElement.type === 'string' ||\n        schemaElement.type === 'any') &&\n        !schemaElement['enum']) {\n        formElement.type = 'text';\n      } else if (schemaElement.type === 'boolean') {\n        formElement.type = 'checkbox';\n      } else if (schemaElement.type === 'object') {\n        if (schemaElement.properties) {\n          formElement.type = 'fieldset';\n        } else {\n          formElement.type = 'textarea';\n        }\n      } else if (!_.isUndefined(schemaElement['enum'])) {\n        formElement.type = 'select';\n      } else {\n        formElement.type = schemaElement.type;\n      }\n    }\n\n    // Unless overridden in the definition of the form element (or unless\n    // there's a titleMap defined), use the enumeration list defined in\n    // the schema\n    if (!formElement.options && schemaElement['enum']) {\n      if (formElement.titleMap) {\n        formElement.options = _.map(schemaElement['enum'], function (value) {\n          return {\n            value: value,\n            title: hasOwnProperty(formElement.titleMap, value) ? formElement.titleMap[value] : value\n          };\n        });\n      }\n      else {\n        formElement.options = schemaElement['enum'];\n      }\n    }\n\n    // Flag a list of checkboxes with multiple choices\n    if ((formElement.type === 'checkboxes') && schemaElement.items) {\n      var itemsEnum = schemaElement.items['enum'];\n      if (itemsEnum) {\n        schemaElement.items._jsonform_checkboxes_as_array = true;\n      }\n      if (!itemsEnum && schemaElement.items[0]) {\n        itemsEnum = schemaElement.items[0]['enum'];\n        if (itemsEnum) {\n          schemaElement.items[0]._jsonform_checkboxes_as_array = true;\n        }\n      }\n    }\n\n    // If the form element targets an \"object\" in the JSON schema,\n    // we need to recurse through the list of children to create an\n    // input field per child property of the object in the JSON schema\n    if (schemaElement.type === 'object') {\n      _.each(schemaElement.properties, function (prop, propName) {\n        node.appendChild(this.buildFromLayout({\n          key: formElement.key + '.' + propName\n        }));\n      }, this);\n    }\n  }\n\n  if (!formElement.type) {\n    formElement.type = 'none';\n  }\n  view = jsonform.elementTypes[formElement.type];\n  if (!view) {\n    throw new Error('The JSONForm contains an element whose type is unknown: \"' +\n      formElement.type + '\"');\n  }\n\n\n  if (schemaElement) {\n    // The form element is linked to an element in the schema.\n    // Let's make sure the types are compatible.\n    // In particular, the element must not be a \"container\"\n    // (or must be an \"object\" or \"array\" container)\n    if (!view.inputfield && !view.array &&\n      (formElement.type !== 'selectfieldset') &&\n      (schemaElement.type !== 'object')) {\n      throw new Error('The JSONForm contains an element that links to an ' +\n        'element in the JSON schema (key: \"' + formElement.key + '\") ' +\n        'and that should not based on its type (\"' + formElement.type + '\")');\n    }\n  }\n  else {\n    // The form element is not linked to an element in the schema.\n    // This means the form element must be a \"container\" element,\n    // and must not define an input field.\n    if (view.inputfield && (formElement.type !== 'selectfieldset')) {\n      throw new Error('The JSONForm defines an element of type ' +\n        '\"' + formElement.type + '\" ' +\n        'but no \"key\" property to link the input field to the JSON schema');\n    }\n  }\n\n  // A few characters need to be escaped to use the ID as jQuery selector\n  formElement.iddot = escapeSelector(formElement.id || '');\n\n  // Initialize the form node from the form element and schema element\n  node.formElement = formElement;\n  node.schemaElement = schemaElement;\n  node.view = view;\n  node.ownerTree = this;\n\n  // Set event handlers\n  if (!formElement.handlers) {\n    formElement.handlers = {};\n  }\n\n  // Parse children recursively\n  if (node.view.array) {\n    // The form element is an array. The number of items in an array\n    // is by definition dynamic, up to the form user (through \"Add more\",\n    // \"Delete\" commands). The positions of the items in the array may\n    // also change over time (through \"Move up\", \"Move down\" commands).\n    //\n    // The form node stores a \"template\" node that serves as basis for\n    // the creation of an item in the array.\n    //\n    // Array items may be complex forms themselves, allowing for nesting.\n    //\n    // The initial values set the initial number of items in the array.\n    // Note a form element contains at least one item when it is rendered.\n    if (formElement.items) {\n      key = formElement.items[0] || formElement.items;\n    }\n    else {\n      key = formElement.key + '[]';\n    }\n    if (_.isString(key)) {\n      key = { key: key };\n    }\n    node.setChildTemplate(this.buildFromLayout(key));\n  }\n  else if (formElement.items) {\n    // The form element defines children elements\n    _.each(formElement.items, function (item) {\n      if (_.isString(item)) {\n        item = { key: item };\n      }\n      node.appendChild(this.buildFromLayout(item));\n    }, this);\n  }\n\n  return node;\n};\n\n\n/**\n * Computes the values associated with each input field in the tree based\n * on previously submitted values or default values in the JSON schema.\n *\n * For arrays, the function actually creates and inserts additional\n * nodes in the tree based on previously submitted values (also ensuring\n * that the array has at least one item).\n *\n * The function sets the array path on all nodes.\n * It should be called once in the lifetime of a form tree right after\n * the tree structure has been created.\n *\n * @function\n */\nformTree.prototype.computeInitialValues = function () {\n  this.root.computeInitialValues(this.formDesc.value);\n};\n\n\n/**\n * Renders the form tree\n *\n * @function\n * @param {Node} domRoot The \"form\" element in the DOM tree that serves as\n *  root for the form\n */\nformTree.prototype.render = function (domRoot) {\n  if (!domRoot) return;\n  this.domRoot = domRoot;\n  this.root.render();\n\n  // If the schema defines required fields, flag the form with the\n  // \"jsonform-hasrequired\" class for styling purpose\n  // (typically so that users may display a legend)\n  if (this.hasRequiredField()) {\n    $(domRoot).addClass('jsonform-hasrequired');\n  }\n};\n\n/**\n * Walks down the element tree with a callback\n *\n * @function\n * @param {Function} callback The callback to call on each element\n */\nformTree.prototype.forEachElement = function (callback) {\n\n  var f = function(root) {\n    for (var i=0;i<root.children.length;i++) {\n      callback(root.children[i]);\n      f(root.children[i]);\n    }\n  };\n  f(this.root);\n\n};\n\nformTree.prototype.validate = function(noErrorDisplay) {\n\n  var values = jsonform.getFormValue(this.domRoot);\n  var errors = false;\n\n  var options = this.formDesc;\n\n  if (options.validate!==false) {\n    var validator = false;\n    if (typeof options.validate!=\"object\") {\n      if (global.JSONFormValidator) {\n        validator = global.JSONFormValidator.createEnvironment(\"json-schema-draft-03\");\n      }\n    } else {\n      validator = options.validate;\n    }\n    if (validator) {\n      var v = validator.validate(values, this.formDesc.schema);\n      $(this.domRoot).jsonFormErrors(false,options);\n      if (v.errors.length) {\n        if (!errors) errors = [];\n        errors = errors.concat(v.errors);\n      }\n    }\n  }\n\n  if (errors && !noErrorDisplay) {\n    if (options.displayErrors) {\n      options.displayErrors(errors,this.domRoot);\n    } else {\n      $(this.domRoot).jsonFormErrors(errors,options);\n    }\n  }\n\n  return {\"errors\":errors}\n\n}\n\nformTree.prototype.submit = function(evt) {\n\n  var stopEvent = function() {\n    if (evt) {\n      evt.preventDefault();\n      evt.stopPropagation();\n    }\n    return false;\n  };\n  var values = jsonform.getFormValue(this.domRoot);\n  var options = this.formDesc;\n\n  var brk=false;\n  this.forEachElement(function(elt) {\n    if (brk) return;\n    if (elt.view.onSubmit) {\n      brk = !elt.view.onSubmit(evt, elt); //may be called multiple times!!\n    }\n  });\n\n  if (brk) return stopEvent();\n\n  var validated = this.validate();\n\n  if (options.onSubmit && !options.onSubmit(validated.errors,values)) {\n    return stopEvent();\n  }\n\n  if (validated.errors) return stopEvent();\n\n  if (options.onSubmitValid && !options.onSubmitValid(values)) {\n    return stopEvent();\n  }\n\n  return false;\n\n};\n\n\n/**\n * Returns true if the form displays a \"required\" field.\n *\n * To keep things simple, the function parses the form's schema and returns\n * true as soon as it finds a \"required\" flag even though, in theory, that\n * schema key may not appear in the final form.\n *\n * Note that a \"required\" constraint on a boolean type is always enforced,\n * the code skips such definitions.\n *\n * @function\n * @return {boolean} True when the form has some required field,\n *  false otherwise.\n */\nformTree.prototype.hasRequiredField = function () {\n  var parseElement = function (element) {\n    if (!element) return null;\n    if (element.required && (element.type !== 'boolean')) {\n      return element;\n    }\n\n    var prop = _.find(element.properties, function (property) {\n      return parseElement(property);\n    });\n    if (prop) {\n      return prop;\n    }\n\n    if (element.items) {\n      if (_.isArray(element.items)) {\n        prop = _.find(element.items, function (item) {\n          return parseElement(item);\n        });\n      }\n      else {\n        prop = parseElement(element.items);\n      }\n      if (prop) {\n        return prop;\n      }\n    }\n  };\n\n  return parseElement(this.formDesc.schema);\n};\n\n\n/**\n * Returns the structured object that corresponds to the form values entered\n * by the use for the given form.\n *\n * The form must have been previously rendered through a call to jsonform.\n *\n * @function\n * @param {Node} The <form> tag in the DOM\n * @return {Object} The object that follows the data schema and matches the\n *  values entered by the user.\n */\njsonform.getFormValue = function (formelt) {\n  var form = $(formelt).data('jsonform-tree');\n  if (!form) return null;\n  return form.root.getFormValues();\n};\n\n\n/**\n * Highlights errors reported by the JSON schema validator in the document.\n *\n * @function\n * @param {Object} errors List of errors reported by the JSON schema validator\n * @param {Object} options The JSON Form object that describes the form\n *  (unused for the time being, could be useful to store example values or\n *   specific error messages)\n */\n$.fn.jsonFormErrors = function(errors, options) {\n  $(\".error\", this).removeClass(\"error\");\n  $(\".warning\", this).removeClass(\"warning\");\n\n  $(\".jsonform-errortext\", this).hide();\n  if (!errors) return;\n\n  var errorSelectors = [];\n  for (var i = 0; i < errors.length; i++) {\n    // Compute the address of the input field in the form from the URI\n    // returned by the JSON schema validator.\n    // These URIs typically look like:\n    //  urn:uuid:cccc265e-ffdd-4e40-8c97-977f7a512853#/pictures/1/thumbnail\n    // What we need from that is the path in the value object:\n    //  pictures[1].thumbnail\n    // ... and the jQuery-friendly class selector of the input field:\n    //  .jsonform-error-pictures\\[1\\]---thumbnail\n    var key = errors[i].uri\n      .replace(/.*#\\//, '')\n      .replace(/\\//g, '.')\n      .replace(/\\.([0-9]+)(?=\\.|$)/g, '[$1]');\n    var errormarkerclass = \".jsonform-error-\" +\n      escapeSelector(key.replace(/\\./g,\"---\"));\n    errorSelectors.push(errormarkerclass);\n\n    var errorType = errors[i].type || \"error\";\n    $(errormarkerclass, this).addClass(errorType);\n    $(errormarkerclass + \" .jsonform-errortext\", this).html(errors[i].message).show();\n  }\n\n  // Look for the first error in the DOM and ensure the element\n  // is visible so that the user understands that something went wrong\n  errorSelectors = errorSelectors.join(',');\n  var firstError = $(errorSelectors).get(0);\n  if (firstError && firstError.scrollIntoView) {\n    firstError.scrollIntoView(true, {\n      behavior: 'smooth'\n    });\n  }\n};\n\n\n/**\n * Generates the HTML form from the given JSON Form object and renders the form.\n *\n * Main entry point of the library. Defined as a jQuery function that typically\n * needs to be applied to a <form> element in the document.\n *\n * The function handles the following properties for the JSON Form object it\n * receives as parameter:\n * - schema (required): The JSON Schema that describes the form to render\n * - form: The options form layout description, overrides default layout\n * - prefix: String to use to prefix computed IDs. Default is an empty string.\n *  Use this option if JSON Form is used multiple times in an application with\n *  schemas that have overlapping parameter names to avoid running into multiple\n *  IDs issues. Default value is \"jsonform-[counter]\".\n * - transloadit: Transloadit parameters when transloadit is used\n * - validate: Validates form against schema upon submission. Uses the value\n * of the \"validate\" property as validator if it is an object.\n * - displayErrors: Function to call with errors upon form submission.\n *  Default is to render the errors next to the input fields.\n * - submitEvent: Name of the form submission event to bind to.\n *  Default is \"submit\". Set this option to false to avoid event binding.\n * - onSubmit: Callback function to call when form is submitted\n * - onSubmitValid: Callback function to call when form is submitted without\n *  errors.\n *\n * @function\n * @param {Object} options The JSON Form object to use as basis for the form\n */\n$.fn.jsonForm = function(options) {\n  var formElt = this;\n\n  options = _.defaults({}, options, {submitEvent: 'submit'});\n\n  var form = new formTree();\n  form.initialize(options);\n  form.render(formElt.get(0));\n\n  // TODO: move that to formTree.render\n  if (options.transloadit) {\n    formElt.append('<input type=\"hidden\" name=\"params\" value=\\'' +\n      escapeHTML(JSON.stringify(options.transloadit.params)) +\n      '\\'>');\n  }\n\n  // Keep a direct pointer to the JSON schema for form submission purpose\n  formElt.data(\"jsonform-tree\", form);\n\n  if (options.submitEvent) {\n    formElt.unbind((options.submitEvent)+'.jsonform');\n    formElt.bind((options.submitEvent)+'.jsonform', function(evt) {\n      form.submit(evt);\n    });\n  }\n\n  // Initialize tabs sections, if any\n  initializeTabs(formElt);\n\n  // Initialize expandable sections, if any\n  $('.expandable > div, .expandable > fieldset', formElt).hide();\n  formElt.on('click', '.expandable > legend', function () {\n    var parent = $(this).parent();\n    parent.toggleClass('expanded');\n    parent.find('legend').attr(\"aria-expanded\", parent.hasClass(\"expanded\"))\n    $('> div', parent).slideToggle(100);\n  });\n\n  return form;\n};\n\n\n/**\n * Retrieves the structured values object generated from the values\n * entered by the user and the data schema that gave birth to the form.\n *\n * Defined as a jQuery function that typically needs to be applied to\n * a <form> element whose content has previously been generated by a\n * call to \"jsonForm\".\n *\n * Unless explicitly disabled, the values are automatically validated\n * against the constraints expressed in the schema.\n *\n * @function\n * @return {Object} Structured values object that matches the user inputs\n *  and the data schema.\n */\n$.fn.jsonFormValue = function() {\n  return jsonform.getFormValue(this);\n};\n\n// Expose the getFormValue method to the global object\n// (other methods exposed as jQuery functions)\nglobal.JSONForm = global.JSONForm || {util:{}};\nglobal.JSONForm.getFormValue = jsonform.getFormValue;\nglobal.JSONForm.fieldTemplate = jsonform.fieldTemplate;\nglobal.JSONForm.fieldTypes = jsonform.elementTypes;\nglobal.JSONForm.getInitialValue = getInitialValue;\nglobal.JSONForm.util.getObjKey = jsonform.util.getObjKey;\nglobal.JSONForm.util.setObjKey = jsonform.util.setObjKey;\n\n})((typeof exports !== 'undefined'),\n  ((typeof exports !== 'undefined') ? exports : window),\n  ((typeof jQuery !== 'undefined') ? jQuery : { fn: {} }),\n  ((typeof _ !== 'undefined') ? _ : null),\n  JSON);\n","// Current version.\nexport var VERSION = '1.12.1';\n\n// Establish the root object, `window` (`self`) in the browser, `global`\n// on the server, or `this` in some virtual machines. We use `self`\n// instead of `window` for `WebWorker` support.\nexport var root = typeof self == 'object' && self.self === self && self ||\n          typeof global == 'object' && global.global === global && global ||\n          Function('return this')() ||\n          {};\n\n// Save bytes in the minified (but not gzipped) version:\nexport var ArrayProto = Array.prototype, ObjProto = Object.prototype;\nexport var SymbolProto = typeof Symbol !== 'undefined' ? Symbol.prototype : null;\n\n// Create quick reference variables for speed access to core prototypes.\nexport var push = ArrayProto.push,\n    slice = ArrayProto.slice,\n    toString = ObjProto.toString,\n    hasOwnProperty = ObjProto.hasOwnProperty;\n\n// Modern feature detection.\nexport var supportsArrayBuffer = typeof ArrayBuffer !== 'undefined',\n    supportsDataView = typeof DataView !== 'undefined';\n\n// All **ECMAScript 5+** native function implementations that we hope to use\n// are declared here.\nexport var nativeIsArray = Array.isArray,\n    nativeKeys = Object.keys,\n    nativeCreate = Object.create,\n    nativeIsView = supportsArrayBuffer && ArrayBuffer.isView;\n\n// Create references to these builtin functions because we override them.\nexport var _isNaN = isNaN,\n    _isFinite = isFinite;\n\n// Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.\nexport var hasEnumBug = !{toString: null}.propertyIsEnumerable('toString');\nexport var nonEnumerableProps = ['valueOf', 'isPrototypeOf', 'toString',\n  'propertyIsEnumerable', 'hasOwnProperty', 'toLocaleString'];\n\n// The largest integer that can be represented exactly.\nexport var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;\n","// Some functions take a variable number of arguments, or a few expected\n// arguments at the beginning and then a variable number of values to operate\n// on. This helper accumulates all remaining arguments past the function’s\n// argument length (or an explicit `startIndex`), into an array that becomes\n// the last argument. Similar to ES6’s \"rest parameter\".\nexport default function restArguments(func, startIndex) {\n  startIndex = startIndex == null ? func.length - 1 : +startIndex;\n  return function() {\n    var length = Math.max(arguments.length - startIndex, 0),\n        rest = Array(length),\n        index = 0;\n    for (; index < length; index++) {\n      rest[index] = arguments[index + startIndex];\n    }\n    switch (startIndex) {\n      case 0: return func.call(this, rest);\n      case 1: return func.call(this, arguments[0], rest);\n      case 2: return func.call(this, arguments[0], arguments[1], rest);\n    }\n    var args = Array(startIndex + 1);\n    for (index = 0; index < startIndex; index++) {\n      args[index] = arguments[index];\n    }\n    args[startIndex] = rest;\n    return func.apply(this, args);\n  };\n}\n","// Is a given variable an object?\nexport default function isObject(obj) {\n  var type = typeof obj;\n  return type === 'function' || type === 'object' && !!obj;\n}\n","// Is a given value equal to null?\nexport default function isNull(obj) {\n  return obj === null;\n}\n","// Is a given variable undefined?\nexport default function isUndefined(obj) {\n  return obj === void 0;\n}\n","import { toString } from './_setup.js';\n\n// Is a given value a boolean?\nexport default function isBoolean(obj) {\n  return obj === true || obj === false || toString.call(obj) === '[object Boolean]';\n}\n","// Is a given value a DOM element?\nexport default function isElement(obj) {\n  return !!(obj && obj.nodeType === 1);\n}\n","import { toString } from './_setup.js';\n\n// Internal function for creating a `toString`-based type tester.\nexport default function tagTester(name) {\n  var tag = '[object ' + name + ']';\n  return function(obj) {\n    return toString.call(obj) === tag;\n  };\n}\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('String');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('Number');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('Date');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('RegExp');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('Error');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('Symbol');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('ArrayBuffer');\n","import tagTester from './_tagTester.js';\nimport { root } from './_setup.js';\n\nvar isFunction = tagTester('Function');\n\n// Optimize `isFunction` if appropriate. Work around some `typeof` bugs in old\n// v8, IE 11 (#1621), Safari 8 (#1929), and PhantomJS (#2236).\nvar nodelist = root.document && root.document.childNodes;\nif (typeof /./ != 'function' && typeof Int8Array != 'object' && typeof nodelist != 'function') {\n  isFunction = function(obj) {\n    return typeof obj == 'function' || false;\n  };\n}\n\nexport default isFunction;\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('Object');\n","import { supportsDataView } from './_setup.js';\nimport hasObjectTag from './_hasObjectTag.js';\n\n// In IE 10 - Edge 13, `DataView` has string tag `'[object Object]'`.\n// In IE 11, the most common among them, this problem also applies to\n// `Map`, `WeakMap` and `Set`.\nexport var hasStringTagBug = (\n      supportsDataView && hasObjectTag(new DataView(new ArrayBuffer(8)))\n    ),\n    isIE11 = (typeof Map !== 'undefined' && hasObjectTag(new Map));\n","import tagTester from './_tagTester.js';\nimport isFunction from './isFunction.js';\nimport isArrayBuffer from './isArrayBuffer.js';\nimport { hasStringTagBug } from './_stringTagBug.js';\n\nvar isDataView = tagTester('DataView');\n\n// In IE 10 - Edge 13, we need a different heuristic\n// to determine whether an object is a `DataView`.\nfunction ie10IsDataView(obj) {\n  return obj != null && isFunction(obj.getInt8) && isArrayBuffer(obj.buffer);\n}\n\nexport default (hasStringTagBug ? ie10IsDataView : isDataView);\n","import { nativeIsArray } from './_setup.js';\nimport tagTester from './_tagTester.js';\n\n// Is a given value an array?\n// Delegates to ECMA5's native `Array.isArray`.\nexport default nativeIsArray || tagTester('Array');\n","import { hasOwnProperty } from './_setup.js';\n\n// Internal function to check whether `key` is an own property name of `obj`.\nexport default function has(obj, key) {\n  return obj != null && hasOwnProperty.call(obj, key);\n}\n","import tagTester from './_tagTester.js';\nimport has from './_has.js';\n\nvar isArguments = tagTester('Arguments');\n\n// Define a fallback version of the method in browsers (ahem, IE < 9), where\n// there isn't any inspectable \"Arguments\" type.\n(function() {\n  if (!isArguments(arguments)) {\n    isArguments = function(obj) {\n      return has(obj, 'callee');\n    };\n  }\n}());\n\nexport default isArguments;\n","import { _isFinite } from './_setup.js';\nimport isSymbol from './isSymbol.js';\n\n// Is a given object a finite number?\nexport default function isFinite(obj) {\n  return !isSymbol(obj) && _isFinite(obj) && !isNaN(parseFloat(obj));\n}\n","import { _isNaN } from './_setup.js';\nimport isNumber from './isNumber.js';\n\n// Is the given value `NaN`?\nexport default function isNaN(obj) {\n  return isNumber(obj) && _isNaN(obj);\n}\n","// Predicate-generating function. Often useful outside of Underscore.\nexport default function constant(value) {\n  return function() {\n    return value;\n  };\n}\n","import { MAX_ARRAY_INDEX } from './_setup.js';\n\n// Common internal logic for `isArrayLike` and `isBufferLike`.\nexport default function createSizePropertyCheck(getSizeProperty) {\n  return function(collection) {\n    var sizeProperty = getSizeProperty(collection);\n    return typeof sizeProperty == 'number' && sizeProperty >= 0 && sizeProperty <= MAX_ARRAY_INDEX;\n  }\n}\n","// Internal helper to generate a function to obtain property `key` from `obj`.\nexport default function shallowProperty(key) {\n  return function(obj) {\n    return obj == null ? void 0 : obj[key];\n  };\n}\n","import shallowProperty from './_shallowProperty.js';\n\n// Internal helper to obtain the `byteLength` property of an object.\nexport default shallowProperty('byteLength');\n","import createSizePropertyCheck from './_createSizePropertyCheck.js';\nimport getByteLength from './_getByteLength.js';\n\n// Internal helper to determine whether we should spend extensive checks against\n// `ArrayBuffer` et al.\nexport default createSizePropertyCheck(getByteLength);\n","import { supportsArrayBuffer, nativeIsView, toString } from './_setup.js';\nimport isDataView from './isDataView.js';\nimport constant from './constant.js';\nimport isBufferLike from './_isBufferLike.js';\n\n// Is a given value a typed array?\nvar typedArrayPattern = /\\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\\]/;\nfunction isTypedArray(obj) {\n  // `ArrayBuffer.isView` is the most future-proof, so use it when available.\n  // Otherwise, fall back on the above regular expression.\n  return nativeIsView ? (nativeIsView(obj) && !isDataView(obj)) :\n                isBufferLike(obj) && typedArrayPattern.test(toString.call(obj));\n}\n\nexport default supportsArrayBuffer ? isTypedArray : constant(false);\n","import shallowProperty from './_shallowProperty.js';\n\n// Internal helper to obtain the `length` property of an object.\nexport default shallowProperty('length');\n","import { nonEnumerableProps, ObjProto } from './_setup.js';\nimport isFunction from './isFunction.js';\nimport has from './_has.js';\n\n// Internal helper to create a simple lookup structure.\n// `collectNonEnumProps` used to depend on `_.contains`, but this led to\n// circular imports. `emulatedSet` is a one-off solution that only works for\n// arrays of strings.\nfunction emulatedSet(keys) {\n  var hash = {};\n  for (var l = keys.length, i = 0; i < l; ++i) hash[keys[i]] = true;\n  return {\n    contains: function(key) { return hash[key]; },\n    push: function(key) {\n      hash[key] = true;\n      return keys.push(key);\n    }\n  };\n}\n\n// Internal helper. Checks `keys` for the presence of keys in IE < 9 that won't\n// be iterated by `for key in ...` and thus missed. Extends `keys` in place if\n// needed.\nexport default function collectNonEnumProps(obj, keys) {\n  keys = emulatedSet(keys);\n  var nonEnumIdx = nonEnumerableProps.length;\n  var constructor = obj.constructor;\n  var proto = isFunction(constructor) && constructor.prototype || ObjProto;\n\n  // Constructor is a special case.\n  var prop = 'constructor';\n  if (has(obj, prop) && !keys.contains(prop)) keys.push(prop);\n\n  while (nonEnumIdx--) {\n    prop = nonEnumerableProps[nonEnumIdx];\n    if (prop in obj && obj[prop] !== proto[prop] && !keys.contains(prop)) {\n      keys.push(prop);\n    }\n  }\n}\n","import isObject from './isObject.js';\nimport { nativeKeys, hasEnumBug } from './_setup.js';\nimport has from './_has.js';\nimport collectNonEnumProps from './_collectNonEnumProps.js';\n\n// Retrieve the names of an object's own properties.\n// Delegates to **ECMAScript 5**'s native `Object.keys`.\nexport default function keys(obj) {\n  if (!isObject(obj)) return [];\n  if (nativeKeys) return nativeKeys(obj);\n  var keys = [];\n  for (var key in obj) if (has(obj, key)) keys.push(key);\n  // Ahem, IE < 9.\n  if (hasEnumBug) collectNonEnumProps(obj, keys);\n  return keys;\n}\n","import getLength from './_getLength.js';\nimport isArray from './isArray.js';\nimport isString from './isString.js';\nimport isArguments from './isArguments.js';\nimport keys from './keys.js';\n\n// Is a given array, string, or object empty?\n// An \"empty\" object has no enumerable own-properties.\nexport default function isEmpty(obj) {\n  if (obj == null) return true;\n  // Skip the more expensive `toString`-based type checks if `obj` has no\n  // `.length`.\n  var length = getLength(obj);\n  if (typeof length == 'number' && (\n    isArray(obj) || isString(obj) || isArguments(obj)\n  )) return length === 0;\n  return getLength(keys(obj)) === 0;\n}\n","import keys from './keys.js';\n\n// Returns whether an object has a given set of `key:value` pairs.\nexport default function isMatch(object, attrs) {\n  var _keys = keys(attrs), length = _keys.length;\n  if (object == null) return !length;\n  var obj = Object(object);\n  for (var i = 0; i < length; i++) {\n    var key = _keys[i];\n    if (attrs[key] !== obj[key] || !(key in obj)) return false;\n  }\n  return true;\n}\n","import { VERSION } from './_setup.js';\n\n// If Underscore is called as a function, it returns a wrapped object that can\n// be used OO-style. This wrapper holds altered versions of all functions added\n// through `_.mixin`. Wrapped objects may be chained.\nexport default function _(obj) {\n  if (obj instanceof _) return obj;\n  if (!(this instanceof _)) return new _(obj);\n  this._wrapped = obj;\n}\n\n_.VERSION = VERSION;\n\n// Extracts the result from a wrapped and chained object.\n_.prototype.value = function() {\n  return this._wrapped;\n};\n\n// Provide unwrapping proxies for some methods used in engine operations\n// such as arithmetic and JSON stringification.\n_.prototype.valueOf = _.prototype.toJSON = _.prototype.value;\n\n_.prototype.toString = function() {\n  return String(this._wrapped);\n};\n","import getByteLength from './_getByteLength.js';\n\n// Internal function to wrap or shallow-copy an ArrayBuffer,\n// typed array or DataView to a new view, reusing the buffer.\nexport default function toBufferView(bufferSource) {\n  return new Uint8Array(\n    bufferSource.buffer || bufferSource,\n    bufferSource.byteOffset || 0,\n    getByteLength(bufferSource)\n  );\n}\n","import _ from './underscore.js';\nimport { toString, SymbolProto } from './_setup.js';\nimport getByteLength from './_getByteLength.js';\nimport isTypedArray from './isTypedArray.js';\nimport isFunction from './isFunction.js';\nimport { hasStringTagBug }  from './_stringTagBug.js';\nimport isDataView from './isDataView.js';\nimport keys from './keys.js';\nimport has from './_has.js';\nimport toBufferView from './_toBufferView.js';\n\n// We use this string twice, so give it a name for minification.\nvar tagDataView = '[object DataView]';\n\n// Internal recursive comparison function for `_.isEqual`.\nfunction eq(a, b, aStack, bStack) {\n  // Identical objects are equal. `0 === -0`, but they aren't identical.\n  // See the [Harmony `egal` proposal](https://wiki.ecmascript.org/doku.php?id=harmony:egal).\n  if (a === b) return a !== 0 || 1 / a === 1 / b;\n  // `null` or `undefined` only equal to itself (strict comparison).\n  if (a == null || b == null) return false;\n  // `NaN`s are equivalent, but non-reflexive.\n  if (a !== a) return b !== b;\n  // Exhaust primitive checks\n  var type = typeof a;\n  if (type !== 'function' && type !== 'object' && typeof b != 'object') return false;\n  return deepEq(a, b, aStack, bStack);\n}\n\n// Internal recursive comparison function for `_.isEqual`.\nfunction deepEq(a, b, aStack, bStack) {\n  // Unwrap any wrapped objects.\n  if (a instanceof _) a = a._wrapped;\n  if (b instanceof _) b = b._wrapped;\n  // Compare `[[Class]]` names.\n  var className = toString.call(a);\n  if (className !== toString.call(b)) return false;\n  // Work around a bug in IE 10 - Edge 13.\n  if (hasStringTagBug && className == '[object Object]' && isDataView(a)) {\n    if (!isDataView(b)) return false;\n    className = tagDataView;\n  }\n  switch (className) {\n    // These types are compared by value.\n    case '[object RegExp]':\n      // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')\n    case '[object String]':\n      // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n      // equivalent to `new String(\"5\")`.\n      return '' + a === '' + b;\n    case '[object Number]':\n      // `NaN`s are equivalent, but non-reflexive.\n      // Object(NaN) is equivalent to NaN.\n      if (+a !== +a) return +b !== +b;\n      // An `egal` comparison is performed for other numeric values.\n      return +a === 0 ? 1 / +a === 1 / b : +a === +b;\n    case '[object Date]':\n    case '[object Boolean]':\n      // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n      // millisecond representations. Note that invalid dates with millisecond representations\n      // of `NaN` are not equivalent.\n      return +a === +b;\n    case '[object Symbol]':\n      return SymbolProto.valueOf.call(a) === SymbolProto.valueOf.call(b);\n    case '[object ArrayBuffer]':\n    case tagDataView:\n      // Coerce to typed array so we can fall through.\n      return deepEq(toBufferView(a), toBufferView(b), aStack, bStack);\n  }\n\n  var areArrays = className === '[object Array]';\n  if (!areArrays && isTypedArray(a)) {\n      var byteLength = getByteLength(a);\n      if (byteLength !== getByteLength(b)) return false;\n      if (a.buffer === b.buffer && a.byteOffset === b.byteOffset) return true;\n      areArrays = true;\n  }\n  if (!areArrays) {\n    if (typeof a != 'object' || typeof b != 'object') return false;\n\n    // Objects with different constructors are not equivalent, but `Object`s or `Array`s\n    // from different frames are.\n    var aCtor = a.constructor, bCtor = b.constructor;\n    if (aCtor !== bCtor && !(isFunction(aCtor) && aCtor instanceof aCtor &&\n                             isFunction(bCtor) && bCtor instanceof bCtor)\n                        && ('constructor' in a && 'constructor' in b)) {\n      return false;\n    }\n  }\n  // Assume equality for cyclic structures. The algorithm for detecting cyclic\n  // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n\n  // Initializing stack of traversed objects.\n  // It's done here since we only need them for objects and arrays comparison.\n  aStack = aStack || [];\n  bStack = bStack || [];\n  var length = aStack.length;\n  while (length--) {\n    // Linear search. Performance is inversely proportional to the number of\n    // unique nested structures.\n    if (aStack[length] === a) return bStack[length] === b;\n  }\n\n  // Add the first object to the stack of traversed objects.\n  aStack.push(a);\n  bStack.push(b);\n\n  // Recursively compare objects and arrays.\n  if (areArrays) {\n    // Compare array lengths to determine if a deep comparison is necessary.\n    length = a.length;\n    if (length !== b.length) return false;\n    // Deep compare the contents, ignoring non-numeric properties.\n    while (length--) {\n      if (!eq(a[length], b[length], aStack, bStack)) return false;\n    }\n  } else {\n    // Deep compare objects.\n    var _keys = keys(a), key;\n    length = _keys.length;\n    // Ensure that both objects contain the same number of properties before comparing deep equality.\n    if (keys(b).length !== length) return false;\n    while (length--) {\n      // Deep compare each member\n      key = _keys[length];\n      if (!(has(b, key) && eq(a[key], b[key], aStack, bStack))) return false;\n    }\n  }\n  // Remove the first object from the stack of traversed objects.\n  aStack.pop();\n  bStack.pop();\n  return true;\n}\n\n// Perform a deep comparison to check if two objects are equal.\nexport default function isEqual(a, b) {\n  return eq(a, b);\n}\n","import isObject from './isObject.js';\nimport { hasEnumBug } from './_setup.js';\nimport collectNonEnumProps from './_collectNonEnumProps.js';\n\n// Retrieve all the enumerable property names of an object.\nexport default function allKeys(obj) {\n  if (!isObject(obj)) return [];\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  // Ahem, IE < 9.\n  if (hasEnumBug) collectNonEnumProps(obj, keys);\n  return keys;\n}\n","import getLength from './_getLength.js';\nimport isFunction from './isFunction.js';\nimport allKeys from './allKeys.js';\n\n// Since the regular `Object.prototype.toString` type tests don't work for\n// some types in IE 11, we use a fingerprinting heuristic instead, based\n// on the methods. It's not great, but it's the best we got.\n// The fingerprint method lists are defined below.\nexport function ie11fingerprint(methods) {\n  var length = getLength(methods);\n  return function(obj) {\n    if (obj == null) return false;\n    // `Map`, `WeakMap` and `Set` have no enumerable keys.\n    var keys = allKeys(obj);\n    if (getLength(keys)) return false;\n    for (var i = 0; i < length; i++) {\n      if (!isFunction(obj[methods[i]])) return false;\n    }\n    // If we are testing against `WeakMap`, we need to ensure that\n    // `obj` doesn't have a `forEach` method in order to distinguish\n    // it from a regular `Map`.\n    return methods !== weakMapMethods || !isFunction(obj[forEachName]);\n  };\n}\n\n// In the interest of compact minification, we write\n// each string in the fingerprints only once.\nvar forEachName = 'forEach',\n    hasName = 'has',\n    commonInit = ['clear', 'delete'],\n    mapTail = ['get', hasName, 'set'];\n\n// `Map`, `WeakMap` and `Set` each have slightly different\n// combinations of the above sublists.\nexport var mapMethods = commonInit.concat(forEachName, mapTail),\n    weakMapMethods = commonInit.concat(mapTail),\n    setMethods = ['add'].concat(commonInit, forEachName, hasName);\n","import tagTester from './_tagTester.js';\nimport { isIE11 } from './_stringTagBug.js';\nimport { ie11fingerprint, mapMethods }  from './_methodFingerprint.js';\n\nexport default isIE11 ? ie11fingerprint(mapMethods) : tagTester('Map');\n","import tagTester from './_tagTester.js';\nimport { isIE11 } from './_stringTagBug.js';\nimport { ie11fingerprint, weakMapMethods }  from './_methodFingerprint.js';\n\nexport default isIE11 ? ie11fingerprint(weakMapMethods) : tagTester('WeakMap');\n","import tagTester from './_tagTester.js';\nimport { isIE11 } from './_stringTagBug.js';\nimport { ie11fingerprint, setMethods }  from './_methodFingerprint.js';\n\nexport default isIE11 ? ie11fingerprint(setMethods) : tagTester('Set');\n","import tagTester from './_tagTester.js';\n\nexport default tagTester('WeakSet');\n","import keys from './keys.js';\n\n// Retrieve the values of an object's properties.\nexport default function values(obj) {\n  var _keys = keys(obj);\n  var length = _keys.length;\n  var values = Array(length);\n  for (var i = 0; i < length; i++) {\n    values[i] = obj[_keys[i]];\n  }\n  return values;\n}\n","import keys from './keys.js';\n\n// Convert an object into a list of `[key, value]` pairs.\n// The opposite of `_.object` with one argument.\nexport default function pairs(obj) {\n  var _keys = keys(obj);\n  var length = _keys.length;\n  var pairs = Array(length);\n  for (var i = 0; i < length; i++) {\n    pairs[i] = [_keys[i], obj[_keys[i]]];\n  }\n  return pairs;\n}\n","import keys from './keys.js';\n\n// Invert the keys and values of an object. The values must be serializable.\nexport default function invert(obj) {\n  var result = {};\n  var _keys = keys(obj);\n  for (var i = 0, length = _keys.length; i < length; i++) {\n    result[obj[_keys[i]]] = _keys[i];\n  }\n  return result;\n}\n","import isFunction from './isFunction.js';\n\n// Return a sorted list of the function names available on the object.\nexport default function functions(obj) {\n  var names = [];\n  for (var key in obj) {\n    if (isFunction(obj[key])) names.push(key);\n  }\n  return names.sort();\n}\n","// An internal function for creating assigner functions.\nexport default function createAssigner(keysFunc, defaults) {\n  return function(obj) {\n    var length = arguments.length;\n    if (defaults) obj = Object(obj);\n    if (length < 2 || obj == null) return obj;\n    for (var index = 1; index < length; index++) {\n      var source = arguments[index],\n          keys = keysFunc(source),\n          l = keys.length;\n      for (var i = 0; i < l; i++) {\n        var key = keys[i];\n        if (!defaults || obj[key] === void 0) obj[key] = source[key];\n      }\n    }\n    return obj;\n  };\n}\n","import createAssigner from './_createAssigner.js';\nimport allKeys from './allKeys.js';\n\n// Extend a given object with all the properties in passed-in object(s).\nexport default createAssigner(allKeys);\n","import createAssigner from './_createAssigner.js';\nimport keys from './keys.js';\n\n// Assigns a given object with all the own properties in the passed-in\n// object(s).\n// (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)\nexport default createAssigner(keys);\n","import createAssigner from './_createAssigner.js';\nimport allKeys from './allKeys.js';\n\n// Fill in a given object with default properties.\nexport default createAssigner(allKeys, true);\n","import isObject from './isObject.js';\nimport { nativeCreate } from './_setup.js';\n\n// Create a naked function reference for surrogate-prototype-swapping.\nfunction ctor() {\n  return function(){};\n}\n\n// An internal function for creating a new object that inherits from another.\nexport default function baseCreate(prototype) {\n  if (!isObject(prototype)) return {};\n  if (nativeCreate) return nativeCreate(prototype);\n  var Ctor = ctor();\n  Ctor.prototype = prototype;\n  var result = new Ctor;\n  Ctor.prototype = null;\n  return result;\n}\n","import baseCreate from './_baseCreate.js';\nimport extendOwn from './extendOwn.js';\n\n// Creates an object that inherits from the given prototype object.\n// If additional properties are provided then they will be added to the\n// created object.\nexport default function create(prototype, props) {\n  var result = baseCreate(prototype);\n  if (props) extendOwn(result, props);\n  return result;\n}\n","import isObject from './isObject.js';\nimport isArray from './isArray.js';\nimport extend from './extend.js';\n\n// Create a (shallow-cloned) duplicate of an object.\nexport default function clone(obj) {\n  if (!isObject(obj)) return obj;\n  return isArray(obj) ? obj.slice() : extend({}, obj);\n}\n","// Invokes `interceptor` with the `obj` and then returns `obj`.\n// The primary purpose of this method is to \"tap into\" a method chain, in\n// order to perform operations on intermediate results within the chain.\nexport default function tap(obj, interceptor) {\n  interceptor(obj);\n  return obj;\n}\n","import _ from './underscore.js';\nimport isArray from './isArray.js';\n\n// Normalize a (deep) property `path` to array.\n// Like `_.iteratee`, this function can be customized.\nexport default function toPath(path) {\n  return isArray(path) ? path : [path];\n}\n_.toPath = toPath;\n","import _ from './underscore.js';\nimport './toPath.js';\n\n// Internal wrapper for `_.toPath` to enable minification.\n// Similar to `cb` for `_.iteratee`.\nexport default function toPath(path) {\n  return _.toPath(path);\n}\n","// Internal function to obtain a nested property in `obj` along `path`.\nexport default function deepGet(obj, path) {\n  var length = path.length;\n  for (var i = 0; i < length; i++) {\n    if (obj == null) return void 0;\n    obj = obj[path[i]];\n  }\n  return length ? obj : void 0;\n}\n","import toPath from './_toPath.js';\nimport deepGet from './_deepGet.js';\nimport isUndefined from './isUndefined.js';\n\n// Get the value of the (deep) property on `path` from `object`.\n// If any property in `path` does not exist or if the value is\n// `undefined`, return `defaultValue` instead.\n// The `path` is normalized through `_.toPath`.\nexport default function get(object, path, defaultValue) {\n  var value = deepGet(object, toPath(path));\n  return isUndefined(value) ? defaultValue : value;\n}\n","import _has from './_has.js';\nimport toPath from './_toPath.js';\n\n// Shortcut function for checking if an object has a given property directly on\n// itself (in other words, not on a prototype). Unlike the internal `has`\n// function, this public version can also traverse nested properties.\nexport default function has(obj, path) {\n  path = toPath(path);\n  var length = path.length;\n  for (var i = 0; i < length; i++) {\n    var key = path[i];\n    if (!_has(obj, key)) return false;\n    obj = obj[key];\n  }\n  return !!length;\n}\n","// Keep the identity function around for default iteratees.\nexport default function identity(value) {\n  return value;\n}\n","import extendOwn from './extendOwn.js';\nimport isMatch from './isMatch.js';\n\n// Returns a predicate for checking whether an object has a given set of\n// `key:value` pairs.\nexport default function matcher(attrs) {\n  attrs = extendOwn({}, attrs);\n  return function(obj) {\n    return isMatch(obj, attrs);\n  };\n}\n","import deepGet from './_deepGet.js';\nimport toPath from './_toPath.js';\n\n// Creates a function that, when passed an object, will traverse that object’s\n// properties down the given `path`, specified as an array of keys or indices.\nexport default function property(path) {\n  path = toPath(path);\n  return function(obj) {\n    return deepGet(obj, path);\n  };\n}\n","// Internal function that returns an efficient (for current engines) version\n// of the passed-in callback, to be repeatedly applied in other Underscore\n// functions.\nexport default function optimizeCb(func, context, argCount) {\n  if (context === void 0) return func;\n  switch (argCount == null ? 3 : argCount) {\n    case 1: return function(value) {\n      return func.call(context, value);\n    };\n    // The 2-argument case is omitted because we’re not using it.\n    case 3: return function(value, index, collection) {\n      return func.call(context, value, index, collection);\n    };\n    case 4: return function(accumulator, value, index, collection) {\n      return func.call(context, accumulator, value, index, collection);\n    };\n  }\n  return function() {\n    return func.apply(context, arguments);\n  };\n}\n","import identity from './identity.js';\nimport isFunction from './isFunction.js';\nimport isObject from './isObject.js';\nimport isArray from './isArray.js';\nimport matcher from './matcher.js';\nimport property from './property.js';\nimport optimizeCb from './_optimizeCb.js';\n\n// An internal function to generate callbacks that can be applied to each\n// element in a collection, returning the desired result — either `_.identity`,\n// an arbitrary callback, a property matcher, or a property accessor.\nexport default function baseIteratee(value, context, argCount) {\n  if (value == null) return identity;\n  if (isFunction(value)) return optimizeCb(value, context, argCount);\n  if (isObject(value) && !isArray(value)) return matcher(value);\n  return property(value);\n}\n","import _ from './underscore.js';\nimport baseIteratee from './_baseIteratee.js';\n\n// External wrapper for our callback generator. Users may customize\n// `_.iteratee` if they want additional predicate/iteratee shorthand styles.\n// This abstraction hides the internal-only `argCount` argument.\nexport default function iteratee(value, context) {\n  return baseIteratee(value, context, Infinity);\n}\n_.iteratee = iteratee;\n","import _ from './underscore.js';\nimport baseIteratee from './_baseIteratee.js';\nimport iteratee from './iteratee.js';\n\n// The function we call internally to generate a callback. It invokes\n// `_.iteratee` if overridden, otherwise `baseIteratee`.\nexport default function cb(value, context, argCount) {\n  if (_.iteratee !== iteratee) return _.iteratee(value, context);\n  return baseIteratee(value, context, argCount);\n}\n","import cb from './_cb.js';\nimport keys from './keys.js';\n\n// Returns the results of applying the `iteratee` to each element of `obj`.\n// In contrast to `_.map` it returns an object.\nexport default function mapObject(obj, iteratee, context) {\n  iteratee = cb(iteratee, context);\n  var _keys = keys(obj),\n      length = _keys.length,\n      results = {};\n  for (var index = 0; index < length; index++) {\n    var currentKey = _keys[index];\n    results[currentKey] = iteratee(obj[currentKey], currentKey, obj);\n  }\n  return results;\n}\n","// Predicate-generating function. Often useful outside of Underscore.\nexport default function noop(){}\n","import noop from './noop.js';\nimport get from './get.js';\n\n// Generates a function for a given object that returns a given property.\nexport default function propertyOf(obj) {\n  if (obj == null) return noop;\n  return function(path) {\n    return get(obj, path);\n  };\n}\n","import optimizeCb from './_optimizeCb.js';\n\n// Run a function **n** times.\nexport default function times(n, iteratee, context) {\n  var accum = Array(Math.max(0, n));\n  iteratee = optimizeCb(iteratee, context, 1);\n  for (var i = 0; i < n; i++) accum[i] = iteratee(i);\n  return accum;\n}\n","// Return a random integer between `min` and `max` (inclusive).\nexport default function random(min, max) {\n  if (max == null) {\n    max = min;\n    min = 0;\n  }\n  return min + Math.floor(Math.random() * (max - min + 1));\n}\n","// A (possibly faster) way to get the current timestamp as an integer.\nexport default Date.now || function() {\n  return new Date().getTime();\n};\n","import keys from './keys.js';\n\n// Internal helper to generate functions for escaping and unescaping strings\n// to/from HTML interpolation.\nexport default function createEscaper(map) {\n  var escaper = function(match) {\n    return map[match];\n  };\n  // Regexes for identifying a key that needs to be escaped.\n  var source = '(?:' + keys(map).join('|') + ')';\n  var testRegexp = RegExp(source);\n  var replaceRegexp = RegExp(source, 'g');\n  return function(string) {\n    string = string == null ? '' : '' + string;\n    return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;\n  };\n}\n","// Internal list of HTML entities for escaping.\nexport default {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;'\n};\n","import createEscaper from './_createEscaper.js';\nimport escapeMap from './_escapeMap.js';\n\n// Function for escaping strings to HTML interpolation.\nexport default createEscaper(escapeMap);\n","import createEscaper from './_createEscaper.js';\nimport unescapeMap from './_unescapeMap.js';\n\n// Function for unescaping strings from HTML interpolation.\nexport default createEscaper(unescapeMap);\n","import invert from './invert.js';\nimport escapeMap from './_escapeMap.js';\n\n// Internal list of HTML entities for unescaping.\nexport default invert(escapeMap);\n","import _ from './underscore.js';\n\n// By default, Underscore uses ERB-style template delimiters. Change the\n// following template settings to use alternative delimiters.\nexport default _.templateSettings = {\n  evaluate: /<%([\\s\\S]+?)%>/g,\n  interpolate: /<%=([\\s\\S]+?)%>/g,\n  escape: /<%-([\\s\\S]+?)%>/g\n};\n","import defaults from './defaults.js';\nimport _ from './underscore.js';\nimport './templateSettings.js';\n\n// When customizing `_.templateSettings`, if you don't want to define an\n// interpolation, evaluation or escaping regex, we need one that is\n// guaranteed not to match.\nvar noMatch = /(.)^/;\n\n// Certain characters need to be escaped so that they can be put into a\n// string literal.\nvar escapes = {\n  \"'\": \"'\",\n  '\\\\': '\\\\',\n  '\\r': 'r',\n  '\\n': 'n',\n  '\\u2028': 'u2028',\n  '\\u2029': 'u2029'\n};\n\nvar escapeRegExp = /\\\\|'|\\r|\\n|\\u2028|\\u2029/g;\n\nfunction escapeChar(match) {\n  return '\\\\' + escapes[match];\n}\n\nvar bareIdentifier = /^\\s*(\\w|\\$)+\\s*$/;\n\n// JavaScript micro-templating, similar to John Resig's implementation.\n// Underscore templating handles arbitrary delimiters, preserves whitespace,\n// and correctly escapes quotes within interpolated code.\n// NB: `oldSettings` only exists for backwards compatibility.\nexport default function template(text, settings, oldSettings) {\n  if (!settings && oldSettings) settings = oldSettings;\n  settings = defaults({}, settings, _.templateSettings);\n\n  // Combine delimiters into one regular expression via alternation.\n  var matcher = RegExp([\n    (settings.escape || noMatch).source,\n    (settings.interpolate || noMatch).source,\n    (settings.evaluate || noMatch).source\n  ].join('|') + '|$', 'g');\n\n  // Compile the template source, escaping string literals appropriately.\n  var index = 0;\n  var source = \"__p+='\";\n  text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n    source += text.slice(index, offset).replace(escapeRegExp, escapeChar);\n    index = offset + match.length;\n\n    if (escape) {\n      source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n    } else if (interpolate) {\n      source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n    } else if (evaluate) {\n      source += \"';\\n\" + evaluate + \"\\n__p+='\";\n    }\n\n    // Adobe VMs need the match returned to produce the correct offset.\n    return match;\n  });\n  source += \"';\\n\";\n\n  var argument = settings.variable;\n  if (argument) {\n    if (!bareIdentifier.test(argument)) throw new Error(argument);\n  } else {\n    // If a variable is not specified, place data values in local scope.\n    source = 'with(obj||{}){\\n' + source + '}\\n';\n    argument = 'obj';\n  }\n\n  source = \"var __t,__p='',__j=Array.prototype.join,\" +\n    \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n    source + 'return __p;\\n';\n\n  var render;\n  try {\n    render = new Function(argument, '_', source);\n  } catch (e) {\n    e.source = source;\n    throw e;\n  }\n\n  var template = function(data) {\n    return render.call(this, data, _);\n  };\n\n  // Provide the compiled source as a convenience for precompilation.\n  template.source = 'function(' + argument + '){\\n' + source + '}';\n\n  return template;\n}\n","import isFunction from './isFunction.js';\nimport toPath from './_toPath.js';\n\n// Traverses the children of `obj` along `path`. If a child is a function, it\n// is invoked with its parent as context. Returns the value of the final\n// child, or `fallback` if any child is undefined.\nexport default function result(obj, path, fallback) {\n  path = toPath(path);\n  var length = path.length;\n  if (!length) {\n    return isFunction(fallback) ? fallback.call(obj) : fallback;\n  }\n  for (var i = 0; i < length; i++) {\n    var prop = obj == null ? void 0 : obj[path[i]];\n    if (prop === void 0) {\n      prop = fallback;\n      i = length; // Ensure we don't continue iterating.\n    }\n    obj = isFunction(prop) ? prop.call(obj) : prop;\n  }\n  return obj;\n}\n","// Generate a unique integer id (unique within the entire client session).\n// Useful for temporary DOM ids.\nvar idCounter = 0;\nexport default function uniqueId(prefix) {\n  var id = ++idCounter + '';\n  return prefix ? prefix + id : id;\n}\n","import _ from './underscore.js';\n\n// Start chaining a wrapped Underscore object.\nexport default function chain(obj) {\n  var instance = _(obj);\n  instance._chain = true;\n  return instance;\n}\n","import baseCreate from './_baseCreate.js';\nimport isObject from './isObject.js';\n\n// Internal function to execute `sourceFunc` bound to `context` with optional\n// `args`. Determines whether to execute a function as a constructor or as a\n// normal function.\nexport default function executeBound(sourceFunc, boundFunc, context, callingContext, args) {\n  if (!(callingContext instanceof boundFunc)) return sourceFunc.apply(context, args);\n  var self = baseCreate(sourceFunc.prototype);\n  var result = sourceFunc.apply(self, args);\n  if (isObject(result)) return result;\n  return self;\n}\n","import restArguments from './restArguments.js';\nimport executeBound from './_executeBound.js';\nimport _ from './underscore.js';\n\n// Partially apply a function by creating a version that has had some of its\n// arguments pre-filled, without changing its dynamic `this` context. `_` acts\n// as a placeholder by default, allowing any combination of arguments to be\n// pre-filled. Set `_.partial.placeholder` for a custom placeholder argument.\nvar partial = restArguments(function(func, boundArgs) {\n  var placeholder = partial.placeholder;\n  var bound = function() {\n    var position = 0, length = boundArgs.length;\n    var args = Array(length);\n    for (var i = 0; i < length; i++) {\n      args[i] = boundArgs[i] === placeholder ? arguments[position++] : boundArgs[i];\n    }\n    while (position < arguments.length) args.push(arguments[position++]);\n    return executeBound(func, bound, this, this, args);\n  };\n  return bound;\n});\n\npartial.placeholder = _;\nexport default partial;\n","import restArguments from './restArguments.js';\nimport isFunction from './isFunction.js';\nimport executeBound from './_executeBound.js';\n\n// Create a function bound to a given object (assigning `this`, and arguments,\n// optionally).\nexport default restArguments(function(func, context, args) {\n  if (!isFunction(func)) throw new TypeError('Bind must be called on a function');\n  var bound = restArguments(function(callArgs) {\n    return executeBound(func, bound, context, this, args.concat(callArgs));\n  });\n  return bound;\n});\n","import createSizePropertyCheck from './_createSizePropertyCheck.js';\nimport getLength from './_getLength.js';\n\n// Internal helper for collection methods to determine whether a collection\n// should be iterated as an array or as an object.\n// Related: https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength\n// Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094\nexport default createSizePropertyCheck(getLength);\n","import getLength from './_getLength.js';\nimport isArrayLike from './_isArrayLike.js';\nimport isArray from './isArray.js';\nimport isArguments from './isArguments.js';\n\n// Internal implementation of a recursive `flatten` function.\nexport default function flatten(input, depth, strict, output) {\n  output = output || [];\n  if (!depth && depth !== 0) {\n    depth = Infinity;\n  } else if (depth <= 0) {\n    return output.concat(input);\n  }\n  var idx = output.length;\n  for (var i = 0, length = getLength(input); i < length; i++) {\n    var value = input[i];\n    if (isArrayLike(value) && (isArray(value) || isArguments(value))) {\n      // Flatten current level of array or arguments object.\n      if (depth > 1) {\n        flatten(value, depth - 1, strict, output);\n        idx = output.length;\n      } else {\n        var j = 0, len = value.length;\n        while (j < len) output[idx++] = value[j++];\n      }\n    } else if (!strict) {\n      output[idx++] = value;\n    }\n  }\n  return output;\n}\n","import restArguments from './restArguments.js';\nimport flatten from './_flatten.js';\nimport bind from './bind.js';\n\n// Bind a number of an object's methods to that object. Remaining arguments\n// are the method names to be bound. Useful for ensuring that all callbacks\n// defined on an object belong to it.\nexport default restArguments(function(obj, keys) {\n  keys = flatten(keys, false, false);\n  var index = keys.length;\n  if (index < 1) throw new Error('bindAll must be passed function names');\n  while (index--) {\n    var key = keys[index];\n    obj[key] = bind(obj[key], obj);\n  }\n  return obj;\n});\n","import has from './_has.js';\n\n// Memoize an expensive function by storing its results.\nexport default function memoize(func, hasher) {\n  var memoize = function(key) {\n    var cache = memoize.cache;\n    var address = '' + (hasher ? hasher.apply(this, arguments) : key);\n    if (!has(cache, address)) cache[address] = func.apply(this, arguments);\n    return cache[address];\n  };\n  memoize.cache = {};\n  return memoize;\n}\n","import restArguments from './restArguments.js';\n\n// Delays a function for the given number of milliseconds, and then calls\n// it with the arguments supplied.\nexport default restArguments(function(func, wait, args) {\n  return setTimeout(function() {\n    return func.apply(null, args);\n  }, wait);\n});\n","import partial from './partial.js';\nimport delay from './delay.js';\nimport _ from './underscore.js';\n\n// Defers a function, scheduling it to run after the current call stack has\n// cleared.\nexport default partial(delay, _, 1);\n","import now from './now.js';\n\n// Returns a function, that, when invoked, will only be triggered at most once\n// during a given window of time. Normally, the throttled function will run\n// as much as it can, without ever going more than once per `wait` duration;\n// but if you'd like to disable the execution on the leading edge, pass\n// `{leading: false}`. To disable execution on the trailing edge, ditto.\nexport default function throttle(func, wait, options) {\n  var timeout, context, args, result;\n  var previous = 0;\n  if (!options) options = {};\n\n  var later = function() {\n    previous = options.leading === false ? 0 : now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n\n  var throttled = function() {\n    var _now = now();\n    if (!previous && options.leading === false) previous = _now;\n    var remaining = wait - (_now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = _now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n\n  throttled.cancel = function() {\n    clearTimeout(timeout);\n    previous = 0;\n    timeout = context = args = null;\n  };\n\n  return throttled;\n}\n","import restArguments from './restArguments.js';\nimport now from './now.js';\n\n// When a sequence of calls of the returned function ends, the argument\n// function is triggered. The end of a sequence is defined by the `wait`\n// parameter. If `immediate` is passed, the argument function will be\n// triggered at the beginning of the sequence instead of at the end.\nexport default function debounce(func, wait, immediate) {\n  var timeout, previous, args, result, context;\n\n  var later = function() {\n    var passed = now() - previous;\n    if (wait > passed) {\n      timeout = setTimeout(later, wait - passed);\n    } else {\n      timeout = null;\n      if (!immediate) result = func.apply(context, args);\n      // This check is needed because `func` can recursively invoke `debounced`.\n      if (!timeout) args = context = null;\n    }\n  };\n\n  var debounced = restArguments(function(_args) {\n    context = this;\n    args = _args;\n    previous = now();\n    if (!timeout) {\n      timeout = setTimeout(later, wait);\n      if (immediate) result = func.apply(context, args);\n    }\n    return result;\n  });\n\n  debounced.cancel = function() {\n    clearTimeout(timeout);\n    timeout = args = context = null;\n  };\n\n  return debounced;\n}\n","import partial from './partial.js';\n\n// Returns the first function passed as an argument to the second,\n// allowing you to adjust arguments, run code before and after, and\n// conditionally execute the original function.\nexport default function wrap(func, wrapper) {\n  return partial(wrapper, func);\n}\n","// Returns a negated version of the passed-in predicate.\nexport default function negate(predicate) {\n  return function() {\n    return !predicate.apply(this, arguments);\n  };\n}\n","// Returns a function that is the composition of a list of functions, each\n// consuming the return value of the function that follows.\nexport default function compose() {\n  var args = arguments;\n  var start = args.length - 1;\n  return function() {\n    var i = start;\n    var result = args[start].apply(this, arguments);\n    while (i--) result = args[i].call(this, result);\n    return result;\n  };\n}\n","// Returns a function that will only be executed on and after the Nth call.\nexport default function after(times, func) {\n  return function() {\n    if (--times < 1) {\n      return func.apply(this, arguments);\n    }\n  };\n}\n","// Returns a function that will only be executed up to (but not including) the\n// Nth call.\nexport default function before(times, func) {\n  var memo;\n  return function() {\n    if (--times > 0) {\n      memo = func.apply(this, arguments);\n    }\n    if (times <= 1) func = null;\n    return memo;\n  };\n}\n","import partial from './partial.js';\nimport before from './before.js';\n\n// Returns a function that will be executed at most one time, no matter how\n// often you call it. Useful for lazy initialization.\nexport default partial(before, 2);\n","import cb from './_cb.js';\nimport keys from './keys.js';\n\n// Returns the first key on an object that passes a truth test.\nexport default function findKey(obj, predicate, context) {\n  predicate = cb(predicate, context);\n  var _keys = keys(obj), key;\n  for (var i = 0, length = _keys.length; i < length; i++) {\n    key = _keys[i];\n    if (predicate(obj[key], key, obj)) return key;\n  }\n}\n","import cb from './_cb.js';\nimport getLength from './_getLength.js';\n\n// Internal function to generate `_.findIndex` and `_.findLastIndex`.\nexport default function createPredicateIndexFinder(dir) {\n  return function(array, predicate, context) {\n    predicate = cb(predicate, context);\n    var length = getLength(array);\n    var index = dir > 0 ? 0 : length - 1;\n    for (; index >= 0 && index < length; index += dir) {\n      if (predicate(array[index], index, array)) return index;\n    }\n    return -1;\n  };\n}\n","import createPredicateIndexFinder from './_createPredicateIndexFinder.js';\n\n// Returns the first index on an array-like that passes a truth test.\nexport default createPredicateIndexFinder(1);\n","import createPredicateIndexFinder from './_createPredicateIndexFinder.js';\n\n// Returns the last index on an array-like that passes a truth test.\nexport default createPredicateIndexFinder(-1);\n","import cb from './_cb.js';\nimport getLength from './_getLength.js';\n\n// Use a comparator function to figure out the smallest index at which\n// an object should be inserted so as to maintain order. Uses binary search.\nexport default function sortedIndex(array, obj, iteratee, context) {\n  iteratee = cb(iteratee, context, 1);\n  var value = iteratee(obj);\n  var low = 0, high = getLength(array);\n  while (low < high) {\n    var mid = Math.floor((low + high) / 2);\n    if (iteratee(array[mid]) < value) low = mid + 1; else high = mid;\n  }\n  return low;\n}\n","import getLength from './_getLength.js';\nimport { slice } from './_setup.js';\nimport isNaN from './isNaN.js';\n\n// Internal function to generate the `_.indexOf` and `_.lastIndexOf` functions.\nexport default function createIndexFinder(dir, predicateFind, sortedIndex) {\n  return function(array, item, idx) {\n    var i = 0, length = getLength(array);\n    if (typeof idx == 'number') {\n      if (dir > 0) {\n        i = idx >= 0 ? idx : Math.max(idx + length, i);\n      } else {\n        length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;\n      }\n    } else if (sortedIndex && idx && length) {\n      idx = sortedIndex(array, item);\n      return array[idx] === item ? idx : -1;\n    }\n    if (item !== item) {\n      idx = predicateFind(slice.call(array, i, length), isNaN);\n      return idx >= 0 ? idx + i : -1;\n    }\n    for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {\n      if (array[idx] === item) return idx;\n    }\n    return -1;\n  };\n}\n","import sortedIndex from './sortedIndex.js';\nimport findIndex from './findIndex.js';\nimport createIndexFinder from './_createIndexFinder.js';\n\n// Return the position of the first occurrence of an item in an array,\n// or -1 if the item is not included in the array.\n// If the array is large and already in sort order, pass `true`\n// for **isSorted** to use binary search.\nexport default createIndexFinder(1, findIndex, sortedIndex);\n","import findLastIndex from './findLastIndex.js';\nimport createIndexFinder from './_createIndexFinder.js';\n\n// Return the position of the last occurrence of an item in an array,\n// or -1 if the item is not included in the array.\nexport default createIndexFinder(-1, findLastIndex);\n","import isArrayLike from './_isArrayLike.js';\nimport findIndex from './findIndex.js';\nimport findKey from './findKey.js';\n\n// Return the first value which passes a truth test.\nexport default function find(obj, predicate, context) {\n  var keyFinder = isArrayLike(obj) ? findIndex : findKey;\n  var key = keyFinder(obj, predicate, context);\n  if (key !== void 0 && key !== -1) return obj[key];\n}\n","import find from './find.js';\nimport matcher from './matcher.js';\n\n// Convenience version of a common use case of `_.find`: getting the first\n// object containing specific `key:value` pairs.\nexport default function findWhere(obj, attrs) {\n  return find(obj, matcher(attrs));\n}\n","import optimizeCb from './_optimizeCb.js';\nimport isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\n\n// The cornerstone for collection functions, an `each`\n// implementation, aka `forEach`.\n// Handles raw objects in addition to array-likes. Treats all\n// sparse array-likes as if they were dense.\nexport default function each(obj, iteratee, context) {\n  iteratee = optimizeCb(iteratee, context);\n  var i, length;\n  if (isArrayLike(obj)) {\n    for (i = 0, length = obj.length; i < length; i++) {\n      iteratee(obj[i], i, obj);\n    }\n  } else {\n    var _keys = keys(obj);\n    for (i = 0, length = _keys.length; i < length; i++) {\n      iteratee(obj[_keys[i]], _keys[i], obj);\n    }\n  }\n  return obj;\n}\n","import cb from './_cb.js';\nimport isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\n\n// Return the results of applying the iteratee to each element.\nexport default function map(obj, iteratee, context) {\n  iteratee = cb(iteratee, context);\n  var _keys = !isArrayLike(obj) && keys(obj),\n      length = (_keys || obj).length,\n      results = Array(length);\n  for (var index = 0; index < length; index++) {\n    var currentKey = _keys ? _keys[index] : index;\n    results[index] = iteratee(obj[currentKey], currentKey, obj);\n  }\n  return results;\n}\n","import isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\nimport optimizeCb from './_optimizeCb.js';\n\n// Internal helper to create a reducing function, iterating left or right.\nexport default function createReduce(dir) {\n  // Wrap code that reassigns argument variables in a separate function than\n  // the one that accesses `arguments.length` to avoid a perf hit. (#1991)\n  var reducer = function(obj, iteratee, memo, initial) {\n    var _keys = !isArrayLike(obj) && keys(obj),\n        length = (_keys || obj).length,\n        index = dir > 0 ? 0 : length - 1;\n    if (!initial) {\n      memo = obj[_keys ? _keys[index] : index];\n      index += dir;\n    }\n    for (; index >= 0 && index < length; index += dir) {\n      var currentKey = _keys ? _keys[index] : index;\n      memo = iteratee(memo, obj[currentKey], currentKey, obj);\n    }\n    return memo;\n  };\n\n  return function(obj, iteratee, memo, context) {\n    var initial = arguments.length >= 3;\n    return reducer(obj, optimizeCb(iteratee, context, 4), memo, initial);\n  };\n}\n","import createReduce from './_createReduce.js';\n\n// **Reduce** builds up a single result from a list of values, aka `inject`,\n// or `foldl`.\nexport default createReduce(1);\n","import createReduce from './_createReduce.js';\n\n// The right-associative version of reduce, also known as `foldr`.\nexport default createReduce(-1);\n","import cb from './_cb.js';\nimport each from './each.js';\n\n// Return all the elements that pass a truth test.\nexport default function filter(obj, predicate, context) {\n  var results = [];\n  predicate = cb(predicate, context);\n  each(obj, function(value, index, list) {\n    if (predicate(value, index, list)) results.push(value);\n  });\n  return results;\n}\n","import filter from './filter.js';\nimport negate from './negate.js';\nimport cb from './_cb.js';\n\n// Return all the elements for which a truth test fails.\nexport default function reject(obj, predicate, context) {\n  return filter(obj, negate(cb(predicate)), context);\n}\n","import cb from './_cb.js';\nimport isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\n\n// Determine whether all of the elements pass a truth test.\nexport default function every(obj, predicate, context) {\n  predicate = cb(predicate, context);\n  var _keys = !isArrayLike(obj) && keys(obj),\n      length = (_keys || obj).length;\n  for (var index = 0; index < length; index++) {\n    var currentKey = _keys ? _keys[index] : index;\n    if (!predicate(obj[currentKey], currentKey, obj)) return false;\n  }\n  return true;\n}\n","import cb from './_cb.js';\nimport isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\n\n// Determine if at least one element in the object passes a truth test.\nexport default function some(obj, predicate, context) {\n  predicate = cb(predicate, context);\n  var _keys = !isArrayLike(obj) && keys(obj),\n      length = (_keys || obj).length;\n  for (var index = 0; index < length; index++) {\n    var currentKey = _keys ? _keys[index] : index;\n    if (predicate(obj[currentKey], currentKey, obj)) return true;\n  }\n  return false;\n}\n","import isArrayLike from './_isArrayLike.js';\nimport values from './values.js';\nimport indexOf from './indexOf.js';\n\n// Determine if the array or object contains a given item (using `===`).\nexport default function contains(obj, item, fromIndex, guard) {\n  if (!isArrayLike(obj)) obj = values(obj);\n  if (typeof fromIndex != 'number' || guard) fromIndex = 0;\n  return indexOf(obj, item, fromIndex) >= 0;\n}\n","import restArguments from './restArguments.js';\nimport isFunction from './isFunction.js';\nimport map from './map.js';\nimport deepGet from './_deepGet.js';\nimport toPath from './_toPath.js';\n\n// Invoke a method (with arguments) on every item in a collection.\nexport default restArguments(function(obj, path, args) {\n  var contextPath, func;\n  if (isFunction(path)) {\n    func = path;\n  } else {\n    path = toPath(path);\n    contextPath = path.slice(0, -1);\n    path = path[path.length - 1];\n  }\n  return map(obj, function(context) {\n    var method = func;\n    if (!method) {\n      if (contextPath && contextPath.length) {\n        context = deepGet(context, contextPath);\n      }\n      if (context == null) return void 0;\n      method = context[path];\n    }\n    return method == null ? method : method.apply(context, args);\n  });\n});\n","import map from './map.js';\nimport property from './property.js';\n\n// Convenience version of a common use case of `_.map`: fetching a property.\nexport default function pluck(obj, key) {\n  return map(obj, property(key));\n}\n","import filter from './filter.js';\nimport matcher from './matcher.js';\n\n// Convenience version of a common use case of `_.filter`: selecting only\n// objects containing specific `key:value` pairs.\nexport default function where(obj, attrs) {\n  return filter(obj, matcher(attrs));\n}\n","import isArrayLike from './_isArrayLike.js';\nimport values from './values.js';\nimport cb from './_cb.js';\nimport each from './each.js';\n\n// Return the maximum element (or element-based computation).\nexport default function max(obj, iteratee, context) {\n  var result = -Infinity, lastComputed = -Infinity,\n      value, computed;\n  if (iteratee == null || typeof iteratee == 'number' && typeof obj[0] != 'object' && obj != null) {\n    obj = isArrayLike(obj) ? obj : values(obj);\n    for (var i = 0, length = obj.length; i < length; i++) {\n      value = obj[i];\n      if (value != null && value > result) {\n        result = value;\n      }\n    }\n  } else {\n    iteratee = cb(iteratee, context);\n    each(obj, function(v, index, list) {\n      computed = iteratee(v, index, list);\n      if (computed > lastComputed || computed === -Infinity && result === -Infinity) {\n        result = v;\n        lastComputed = computed;\n      }\n    });\n  }\n  return result;\n}\n","import isArrayLike from './_isArrayLike.js';\nimport values from './values.js';\nimport cb from './_cb.js';\nimport each from './each.js';\n\n// Return the minimum element (or element-based computation).\nexport default function min(obj, iteratee, context) {\n  var result = Infinity, lastComputed = Infinity,\n      value, computed;\n  if (iteratee == null || typeof iteratee == 'number' && typeof obj[0] != 'object' && obj != null) {\n    obj = isArrayLike(obj) ? obj : values(obj);\n    for (var i = 0, length = obj.length; i < length; i++) {\n      value = obj[i];\n      if (value != null && value < result) {\n        result = value;\n      }\n    }\n  } else {\n    iteratee = cb(iteratee, context);\n    each(obj, function(v, index, list) {\n      computed = iteratee(v, index, list);\n      if (computed < lastComputed || computed === Infinity && result === Infinity) {\n        result = v;\n        lastComputed = computed;\n      }\n    });\n  }\n  return result;\n}\n","import isArrayLike from './_isArrayLike.js';\nimport clone from './clone.js';\nimport values from './values.js';\nimport getLength from './_getLength.js';\nimport random from './random.js';\n\n// Sample **n** random values from a collection using the modern version of the\n// [Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher–Yates_shuffle).\n// If **n** is not specified, returns a single random element.\n// The internal `guard` argument allows it to work with `_.map`.\nexport default function sample(obj, n, guard) {\n  if (n == null || guard) {\n    if (!isArrayLike(obj)) obj = values(obj);\n    return obj[random(obj.length - 1)];\n  }\n  var sample = isArrayLike(obj) ? clone(obj) : values(obj);\n  var length = getLength(sample);\n  n = Math.max(Math.min(n, length), 0);\n  var last = length - 1;\n  for (var index = 0; index < n; index++) {\n    var rand = random(index, last);\n    var temp = sample[index];\n    sample[index] = sample[rand];\n    sample[rand] = temp;\n  }\n  return sample.slice(0, n);\n}\n","import sample from './sample.js';\n\n// Shuffle a collection.\nexport default function shuffle(obj) {\n  return sample(obj, Infinity);\n}\n","import cb from './_cb.js';\nimport pluck from './pluck.js';\nimport map from './map.js';\n\n// Sort the object's values by a criterion produced by an iteratee.\nexport default function sortBy(obj, iteratee, context) {\n  var index = 0;\n  iteratee = cb(iteratee, context);\n  return pluck(map(obj, function(value, key, list) {\n    return {\n      value: value,\n      index: index++,\n      criteria: iteratee(value, key, list)\n    };\n  }).sort(function(left, right) {\n    var a = left.criteria;\n    var b = right.criteria;\n    if (a !== b) {\n      if (a > b || a === void 0) return 1;\n      if (a < b || b === void 0) return -1;\n    }\n    return left.index - right.index;\n  }), 'value');\n}\n","import cb from './_cb.js';\nimport each from './each.js';\n\n// An internal function used for aggregate \"group by\" operations.\nexport default function group(behavior, partition) {\n  return function(obj, iteratee, context) {\n    var result = partition ? [[], []] : {};\n    iteratee = cb(iteratee, context);\n    each(obj, function(value, index) {\n      var key = iteratee(value, index, obj);\n      behavior(result, value, key);\n    });\n    return result;\n  };\n}\n","import group from './_group.js';\nimport has from './_has.js';\n\n// Groups the object's values by a criterion. Pass either a string attribute\n// to group by, or a function that returns the criterion.\nexport default group(function(result, value, key) {\n  if (has(result, key)) result[key].push(value); else result[key] = [value];\n});\n","import group from './_group.js';\n\n// Indexes the object's values by a criterion, similar to `_.groupBy`, but for\n// when you know that your index values will be unique.\nexport default group(function(result, value, key) {\n  result[key] = value;\n});\n","import group from './_group.js';\nimport has from './_has.js';\n\n// Counts instances of an object that group by a certain criterion. Pass\n// either a string attribute to count by, or a function that returns the\n// criterion.\nexport default group(function(result, value, key) {\n  if (has(result, key)) result[key]++; else result[key] = 1;\n});\n","import group from './_group.js';\n\n// Split a collection into two arrays: one whose elements all pass the given\n// truth test, and one whose elements all do not pass the truth test.\nexport default group(function(result, value, pass) {\n  result[pass ? 0 : 1].push(value);\n}, true);\n","import isArray from './isArray.js';\nimport { slice } from './_setup.js';\nimport isString from './isString.js';\nimport isArrayLike from './_isArrayLike.js';\nimport map from './map.js';\nimport identity from './identity.js';\nimport values from './values.js';\n\n// Safely create a real, live array from anything iterable.\nvar reStrSymbol = /[^\\ud800-\\udfff]|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff]/g;\nexport default function toArray(obj) {\n  if (!obj) return [];\n  if (isArray(obj)) return slice.call(obj);\n  if (isString(obj)) {\n    // Keep surrogate pair characters together.\n    return obj.match(reStrSymbol);\n  }\n  if (isArrayLike(obj)) return map(obj, identity);\n  return values(obj);\n}\n","import isArrayLike from './_isArrayLike.js';\nimport keys from './keys.js';\n\n// Return the number of elements in a collection.\nexport default function size(obj) {\n  if (obj == null) return 0;\n  return isArrayLike(obj) ? obj.length : keys(obj).length;\n}\n","// Internal `_.pick` helper function to determine whether `key` is an enumerable\n// property name of `obj`.\nexport default function keyInObj(value, key, obj) {\n  return key in obj;\n}\n","import restArguments from './restArguments.js';\nimport isFunction from './isFunction.js';\nimport optimizeCb from './_optimizeCb.js';\nimport allKeys from './allKeys.js';\nimport keyInObj from './_keyInObj.js';\nimport flatten from './_flatten.js';\n\n// Return a copy of the object only containing the allowed properties.\nexport default restArguments(function(obj, keys) {\n  var result = {}, iteratee = keys[0];\n  if (obj == null) return result;\n  if (isFunction(iteratee)) {\n    if (keys.length > 1) iteratee = optimizeCb(iteratee, keys[1]);\n    keys = allKeys(obj);\n  } else {\n    iteratee = keyInObj;\n    keys = flatten(keys, false, false);\n    obj = Object(obj);\n  }\n  for (var i = 0, length = keys.length; i < length; i++) {\n    var key = keys[i];\n    var value = obj[key];\n    if (iteratee(value, key, obj)) result[key] = value;\n  }\n  return result;\n});\n","import restArguments from './restArguments.js';\nimport isFunction from './isFunction.js';\nimport negate from './negate.js';\nimport map from './map.js';\nimport flatten from './_flatten.js';\nimport contains from './contains.js';\nimport pick from './pick.js';\n\n// Return a copy of the object without the disallowed properties.\nexport default restArguments(function(obj, keys) {\n  var iteratee = keys[0], context;\n  if (isFunction(iteratee)) {\n    iteratee = negate(iteratee);\n    if (keys.length > 1) context = keys[1];\n  } else {\n    keys = map(flatten(keys, false, false), String);\n    iteratee = function(value, key) {\n      return !contains(keys, key);\n    };\n  }\n  return pick(obj, iteratee, context);\n});\n","import { slice } from './_setup.js';\n\n// Returns everything but the last entry of the array. Especially useful on\n// the arguments object. Passing **n** will return all the values in\n// the array, excluding the last N.\nexport default function initial(array, n, guard) {\n  return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));\n}\n","import initial from './initial.js';\n\n// Get the first element of an array. Passing **n** will return the first N\n// values in the array. The **guard** check allows it to work with `_.map`.\nexport default function first(array, n, guard) {\n  if (array == null || array.length < 1) return n == null || guard ? void 0 : [];\n  if (n == null || guard) return array[0];\n  return initial(array, array.length - n);\n}\n","import { slice } from './_setup.js';\n\n// Returns everything but the first entry of the `array`. Especially useful on\n// the `arguments` object. Passing an **n** will return the rest N values in the\n// `array`.\nexport default function rest(array, n, guard) {\n  return slice.call(array, n == null || guard ? 1 : n);\n}\n","import rest from './rest.js';\n\n// Get the last element of an array. Passing **n** will return the last N\n// values in the array.\nexport default function last(array, n, guard) {\n  if (array == null || array.length < 1) return n == null || guard ? void 0 : [];\n  if (n == null || guard) return array[array.length - 1];\n  return rest(array, Math.max(0, array.length - n));\n}\n","import filter from './filter.js';\n\n// Trim out all falsy values from an array.\nexport default function compact(array) {\n  return filter(array, Boolean);\n}\n","import _flatten from './_flatten.js';\n\n// Flatten out an array, either recursively (by default), or up to `depth`.\n// Passing `true` or `false` as `depth` means `1` or `Infinity`, respectively.\nexport default function flatten(array, depth) {\n  return _flatten(array, depth, false);\n}\n","import restArguments from './restArguments.js';\nimport flatten from './_flatten.js';\nimport filter from './filter.js';\nimport contains from './contains.js';\n\n// Take the difference between one array and a number of other arrays.\n// Only the elements present in just the first array will remain.\nexport default restArguments(function(array, rest) {\n  rest = flatten(rest, true, true);\n  return filter(array, function(value){\n    return !contains(rest, value);\n  });\n});\n","import restArguments from './restArguments.js';\nimport difference from './difference.js';\n\n// Return a version of the array that does not contain the specified value(s).\nexport default restArguments(function(array, otherArrays) {\n  return difference(array, otherArrays);\n});\n","import isBoolean from './isBoolean.js';\nimport cb from './_cb.js';\nimport getLength from './_getLength.js';\nimport contains from './contains.js';\n\n// Produce a duplicate-free version of the array. If the array has already\n// been sorted, you have the option of using a faster algorithm.\n// The faster algorithm will not work with an iteratee if the iteratee\n// is not a one-to-one function, so providing an iteratee will disable\n// the faster algorithm.\nexport default function uniq(array, isSorted, iteratee, context) {\n  if (!isBoolean(isSorted)) {\n    context = iteratee;\n    iteratee = isSorted;\n    isSorted = false;\n  }\n  if (iteratee != null) iteratee = cb(iteratee, context);\n  var result = [];\n  var seen = [];\n  for (var i = 0, length = getLength(array); i < length; i++) {\n    var value = array[i],\n        computed = iteratee ? iteratee(value, i, array) : value;\n    if (isSorted && !iteratee) {\n      if (!i || seen !== computed) result.push(value);\n      seen = computed;\n    } else if (iteratee) {\n      if (!contains(seen, computed)) {\n        seen.push(computed);\n        result.push(value);\n      }\n    } else if (!contains(result, value)) {\n      result.push(value);\n    }\n  }\n  return result;\n}\n","import restArguments from './restArguments.js';\nimport uniq from './uniq.js';\nimport flatten from './_flatten.js';\n\n// Produce an array that contains the union: each distinct element from all of\n// the passed-in arrays.\nexport default restArguments(function(arrays) {\n  return uniq(flatten(arrays, true, true));\n});\n","import getLength from './_getLength.js';\nimport contains from './contains.js';\n\n// Produce an array that contains every item shared between all the\n// passed-in arrays.\nexport default function intersection(array) {\n  var result = [];\n  var argsLength = arguments.length;\n  for (var i = 0, length = getLength(array); i < length; i++) {\n    var item = array[i];\n    if (contains(result, item)) continue;\n    var j;\n    for (j = 1; j < argsLength; j++) {\n      if (!contains(arguments[j], item)) break;\n    }\n    if (j === argsLength) result.push(item);\n  }\n  return result;\n}\n","import max from './max.js';\nimport getLength from './_getLength.js';\nimport pluck from './pluck.js';\n\n// Complement of zip. Unzip accepts an array of arrays and groups\n// each array's elements on shared indices.\nexport default function unzip(array) {\n  var length = array && max(array, getLength).length || 0;\n  var result = Array(length);\n\n  for (var index = 0; index < length; index++) {\n    result[index] = pluck(array, index);\n  }\n  return result;\n}\n","import restArguments from './restArguments.js';\nimport unzip from './unzip.js';\n\n// Zip together multiple lists into a single array -- elements that share\n// an index go together.\nexport default restArguments(unzip);\n","import getLength  from './_getLength.js';\n\n// Converts lists into objects. Pass either a single array of `[key, value]`\n// pairs, or two parallel arrays of the same length -- one of keys, and one of\n// the corresponding values. Passing by pairs is the reverse of `_.pairs`.\nexport default function object(list, values) {\n  var result = {};\n  for (var i = 0, length = getLength(list); i < length; i++) {\n    if (values) {\n      result[list[i]] = values[i];\n    } else {\n      result[list[i][0]] = list[i][1];\n    }\n  }\n  return result;\n}\n","// Generate an integer Array containing an arithmetic progression. A port of\n// the native Python `range()` function. See\n// [the Python documentation](https://docs.python.org/library/functions.html#range).\nexport default function range(start, stop, step) {\n  if (stop == null) {\n    stop = start || 0;\n    start = 0;\n  }\n  if (!step) {\n    step = stop < start ? -1 : 1;\n  }\n\n  var length = Math.max(Math.ceil((stop - start) / step), 0);\n  var range = Array(length);\n\n  for (var idx = 0; idx < length; idx++, start += step) {\n    range[idx] = start;\n  }\n\n  return range;\n}\n","import { slice } from './_setup.js';\n\n// Chunk a single array into multiple arrays, each containing `count` or fewer\n// items.\nexport default function chunk(array, count) {\n  if (count == null || count < 1) return [];\n  var result = [];\n  var i = 0, length = array.length;\n  while (i < length) {\n    result.push(slice.call(array, i, i += count));\n  }\n  return result;\n}\n","import _ from './underscore.js';\n\n// Helper function to continue chaining intermediate results.\nexport default function chainResult(instance, obj) {\n  return instance._chain ? _(obj).chain() : obj;\n}\n","import _ from './underscore.js';\nimport each from './each.js';\nimport functions from './functions.js';\nimport { push } from './_setup.js';\nimport chainResult from './_chainResult.js';\n\n// Add your own custom functions to the Underscore object.\nexport default function mixin(obj) {\n  each(functions(obj), function(name) {\n    var func = _[name] = obj[name];\n    _.prototype[name] = function() {\n      var args = [this._wrapped];\n      push.apply(args, arguments);\n      return chainResult(this, func.apply(_, args));\n    };\n  });\n  return _;\n}\n","import _ from './underscore.js';\nimport each from './each.js';\nimport { ArrayProto } from './_setup.js';\nimport chainResult from './_chainResult.js';\n\n// Add all mutator `Array` functions to the wrapper.\neach(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n  var method = ArrayProto[name];\n  _.prototype[name] = function() {\n    var obj = this._wrapped;\n    if (obj != null) {\n      method.apply(obj, arguments);\n      if ((name === 'shift' || name === 'splice') && obj.length === 0) {\n        delete obj[0];\n      }\n    }\n    return chainResult(this, obj);\n  };\n});\n\n// Add all accessor `Array` functions to the wrapper.\neach(['concat', 'join', 'slice'], function(name) {\n  var method = ArrayProto[name];\n  _.prototype[name] = function() {\n    var obj = this._wrapped;\n    if (obj != null) obj = method.apply(obj, arguments);\n    return chainResult(this, obj);\n  };\n});\n\nexport default _;\n","// Default Export\n// ==============\n// In this module, we mix our bundled exports into the `_` object and export\n// the result. This is analogous to setting `module.exports = _` in CommonJS.\n// Hence, this module is also the entry point of our UMD bundle and the package\n// entry point for CommonJS and AMD users. In other words, this is (the source\n// of) the module you are interfacing with when you do any of the following:\n//\n// ```js\n// // CommonJS\n// var _ = require('underscore');\n//\n// // AMD\n// define(['underscore'], function(_) {...});\n//\n// // UMD in the browser\n// // _ is available as a global variable\n// ```\nimport * as allExports from './index.js';\nimport { mixin } from './index.js';\n\n// Add all of the Underscore functions to the wrapper object.\nvar _ = mixin(allExports);\n// Legacy Node.js API.\n_._ = _;\n// Export the Underscore API.\nexport default _;\n"],"names":["serverside","global","$","_","JSON","console","log","require","reArray","fieldTemplateSettings","evaluate","interpolate","valueTemplateSettings","isSet","value","isUndefined","isNull","hasOwnProperty","obj","prop","jsonform","util","escapeHTML","string","replace","escapeSelector","selector","slugify","str","fieldTemplate","inner","fileDisplayTemplate","inputFieldTemplate","type","elementTypes","evt","elt","valueIndicator","document","querySelector","id","innerText","target","data","node","range","min","max","step","indicator","schemaElement","formElement","minimum","exclusiveMinimum","maximum","exclusiveMaximum","el","find","spectrum","preferredFormat","showInput","setup","wysihtml5","this","textareaElement","removeAttr","window","jsonform_wysihtml5_setup","itv","setInterval","clearInterval","editor","ace","edit","get","idSelector","getSession","setNewLineMode","renderer","setShowPrintMargin","setTheme","aceTheme","aceMode","setMode","setTabSize","setValue","lazyChanged","debounce","val","getValue","change","on","trigger","jsonform_ace_setup","parent","ownerTree","_transloadit_generic_public_index","transloaditname","_transloadit_generic_elts","_transloadit_bound","formElt","domRoot","transloadit","autoSubmit","wait","onSuccess","assembly","results","values","flatten","each","result","field","input","nonEmptyKeys","filter","keys","meta","key","pick","stringify","unbind","delay","submit","onError","remove","preventDefault","nbRows","maxColumns","imageSelectorColumns","buttonTitle","imageSelectorTitle","prefix","imagePrefix","suffix","imageSuffix","width","imageWidth","height","imageHeight","buttonClass","imageButtonClass","options","length","Math","ceil","columns","stopPropagation","nodeName","toLowerCase","attr","indexOf","substring","addClass","html","match","removeClass","activeClass","choices","choiceshtml","items","choice","idx","template","name","include","title","titleMap","enableDrag","sortable","$nodeid","boundaries","getArrayBoundaries","click","children","maxItems","insertArrayItem","minItems","curItems","i","deleteArrayItem","draggable","bind","event","ui","fromIdx","toIdx","incr","parentEl","switchValuesWith","render","fromEl","toEl","detach","prepend","after","moveNodeTo","item","index","tabs","child","legend","escape","updateTabs","selIdx","activateFirstTab","undefined","parseInt","eq","containment","tolerance","newIdx","tabEl","onInsert","hide","parentID","tab_list","title_escaped","e","tab_id","map","option","childPos","Object","extend","active","activeChild","hasNonDefaultValue","disabled","first","$option","show","questionNode","parentNode","nextAll","next","qid","href","open","location","setTimeout","getObjKey","ignoreArrays","innerobj","keyparts","split","subkey","arrayMatch","lastIndex","exec","isArray","setObjKey","getSchemaKey","schema","schemaKey","schemaDef","$ref","Error","applyArrayPath","arrayPath","depth","p1","newIndex","getInitialValue","formObject","tpldata","usePreviousValues","getFormElement","elements","isString","form","properties","maxLength","substr","formNode","view","childTemplate","legendChild","prototype","clone","defaultValue","appendChild","push","removeChild","pop","moveValuesTo","getFormValues","resetValues","computeInitialValues","nodeValues","params","array","inputfield","serializeArray","param","setChildTemplate","ignoreDefaultValues","self","nbChildren","formData","formDesc","returnValue","listKey","uniqueId","keydash","isObject","getPreviousNumberOfItems","valueInLegend","arrayValue","childNumbers","arrayDepth","pos","truncateToArrayDepth","updateArrayPath","formArray","concat","checked","formSchema","eltSchema","cval","_jsonform_checkboxes_as_array","isNaN","Number","_jsonform_allowEmpty","parse","generate","setContent","enhance","nextSibling","replaceWith","before","append","updateElement","domNode","getElement","fieldtemplate","k","onBeforeRender","childrenhtml","fieldHtmlClass","handlers","handler","onevent","onChange","onInput","onClick","onKeyUp","onChangeHandler","domElement","getNodeBoundaries","initialNode","arrayKey","minLength","subBoundaries","formTree","eventhandlers","root","initialize","buildTree","element","buildFromLayout","context","onElementSchema","description","readOnly","readonly","allowEmpty","contains","without","required","format","itemsEnum","propName","iddot","hasRequiredField","forEachElement","callback","f","validate","noErrorDisplay","getFormValue","errors","validator","JSONFormValidator","createEnvironment","v","jsonFormErrors","displayErrors","stopEvent","brk","onSubmit","validated","onSubmitValid","parseElement","property","formelt","fn","errorSelectors","uri","errormarkerclass","errorType","message","join","firstError","scrollIntoView","behavior","jsonForm","defaults","submitEvent","activate","container","enableFields","$target","targetIndex","optionSelected","$select","targetIdx","getAttribute","hasClass","parents","tabClicked","$content","delegate","initializeTabs","toggleClass","slideToggle","jsonFormValue","JSONForm","fieldTypes","exports","jQuery","VERSION","Function","ArrayProto","Array","ObjProto","SymbolProto","Symbol","slice","toString","supportsArrayBuffer","ArrayBuffer","supportsDataView","DataView","nativeIsArray","nativeKeys","nativeCreate","create","nativeIsView","isView","_isNaN","_isFinite","isFinite","hasEnumBug","propertyIsEnumerable","nonEnumerableProps","MAX_ARRAY_INDEX","pow","restArguments","func","startIndex","arguments","rest","call","args","apply","isBoolean","isElement","nodeType","tagTester","tag","isFunction","nodelist","childNodes","Int8Array","hasStringTagBug","hasObjectTag","isIE11","Map","isDataView","getInt8","isArrayBuffer","buffer","has","isArguments","isSymbol","parseFloat","isNumber","constant","createSizePropertyCheck","getSizeProperty","collection","sizeProperty","shallowProperty","getByteLength","typedArrayPattern","isBufferLike","test","collectNonEnumProps","hash","l","emulatedSet","nonEnumIdx","constructor","proto","isEmpty","getLength","isMatch","object","attrs","_keys","_wrapped","toBufferView","bufferSource","Uint8Array","byteOffset","valueOf","toJSON","String","tagDataView","a","b","aStack","bStack","deepEq","className","areArrays","isTypedArray","aCtor","bCtor","isEqual","allKeys","ie11fingerprint","methods","weakMapMethods","forEachName","commonInit","mapTail","mapMethods","setMethods","pairs","invert","functions","names","sort","createAssigner","keysFunc","source","baseCreate","Ctor","props","extendOwn","tap","interceptor","toPath","path","deepGet","_has","identity","matcher","optimizeCb","argCount","accumulator","baseIteratee","iteratee","Infinity","cb","mapObject","currentKey","noop","propertyOf","times","n","accum","random","floor","Date","now","getTime","createEscaper","escaper","testRegexp","RegExp","replaceRegexp","escapeMap","templateSettings","noMatch","escapes","escapeRegExp","escapeChar","bareIdentifier","text","settings","oldSettings","offset","argument","variable","fallback","idCounter","chain","instance","_chain","executeBound","sourceFunc","boundFunc","callingContext","partial","boundArgs","placeholder","bound","position","TypeError","callArgs","strict","output","isArrayLike","j","len","memoize","hasher","cache","address","throttle","timeout","previous","later","leading","throttled","_now","remaining","clearTimeout","trailing","cancel","immediate","passed","debounced","_args","wrap","wrapper","negate","predicate","compose","start","memo","findKey","createPredicateIndexFinder","dir","sortedIndex","low","high","mid","createIndexFinder","predicateFind","findIndex","findLastIndex","findWhere","createReduce","initial","reducer","list","reject","every","some","fromIndex","guard","contextPath","method","pluck","where","computed","lastComputed","sample","last","rand","temp","shuffle","sortBy","criteria","left","right","group","partition","pass","reStrSymbol","toArray","size","keyInObj","compact","Boolean","_flatten","otherArrays","difference","uniq","isSorted","seen","arrays","intersection","argsLength","unzip","stop","chunk","count","chainResult","mixin","allExports"],"sourceRoot":""}